!function(ns){var NODE_CLIENT=1;ns.wrapper=function(goog,wd){var COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_UNCOMPILED_DEFINES,goog.global.CLOSURE_DEFINES,goog.isDef=function(e){return void 0!==e},goog.exportPath_=function(e,t,o){var r=e.split("."),n=o||goog.global;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(var i;r.length&&(i=r.shift());)!r.length&&goog.isDef(t)?n[i]=t:n=n[i]?n[i]:n[i]={}},goog.define=function(e,t){var o=t;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,e)?o=goog.global.CLOSURE_UNCOMPILED_DEFINES[e]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,e)&&(o=goog.global.CLOSURE_DEFINES[e])),goog.exportPath_(e,o)},goog.define("goog.DEBUG",!0),goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.define("goog.STRICT_MODE_COMPATIBLE",!1),goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG),goog.define("goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING",!1),goog.provide=function(e){if(!COMPILED&&goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');goog.constructNamespace_(e)},goog.constructNamespace_=function(e,t){if(!COMPILED){delete goog.implicitNamespaces_[e];for(var o=e;(o=o.substring(0,o.lastIndexOf(".")))&&!goog.getObjectByName(o);)goog.implicitNamespaces_[o]=!0}goog.exportPath_(e,t)},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(e){if(!goog.isString(e)||!e||-1==e.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+e+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=e,!COMPILED){if(goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e]}},goog.module.get=function(e){return goog.module.getInternal_(e)},goog.module.getInternal_=function(e){return COMPILED?void 0:goog.isProvided_(e)?e in goog.loadedModules_?goog.loadedModules_[e]:goog.getObjectByName(e):null},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_},goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw new Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.setTestOnly=function(e){if(goog.DISALLOW_TEST_ONLY_CODE)throw e=e||"",Error("Importing test-only code into non-debug environment"+(e?": "+e:"."))},goog.forwardDeclare=function(e){},COMPILED||(goog.isProvided_=function(e){return e in goog.loadedModules_||!goog.implicitNamespaces_[e]&&goog.isDefAndNotNull(goog.getObjectByName(e))},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(e,t){for(var o,r=e.split("."),n=t||goog.global;o=r.shift();){if(!goog.isDefAndNotNull(n[o]))return null;n=n[o]}return n},goog.globalize=function(e,t){var o=t||goog.global;for(var r in e)o[r]=e[r]},goog.addDependency=function(e,t,o,r){if(goog.DEPENDENCIES_ENABLED){for(var n,i,a=e.replace(/\\/g,"/"),s=goog.dependencies_,d=0;n=t[d];d++)s.nameToPath[n]=a,s.pathIsModule[a]=!!r;for(var l=0;i=o[l];l++)a in s.requires||(s.requires[a]={}),s.requires[a][i]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.logToConsole_=function(e){goog.global.console&&goog.global.console.error(e)},goog.require=function(e){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(e),goog.isProvided_(e))return goog.isInModuleLoader_()?goog.module.getInternal_(e):null;if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(t)return goog.included_[t]=!0,goog.writeScripts_(),null}var o="goog.require could not find: "+e;throw goog.logToConsole_(o),Error(o)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_?e.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e),e.instance_=new e)}},goog.instantiatedSingletons_=[],goog.define("goog.LOAD_MODULE_USING_EVAL",!0),goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG),goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var e=goog.global.document;return"undefined"!=typeof e&&"write"in e},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)return void(goog.basePath=goog.global.CLOSURE_BASE_PATH);if(goog.inHtmlDocument_())for(var e=goog.global.document,t=e.getElementsByTagName("SCRIPT"),o=t.length-1;o>=0;--o){var r=t[o],n=r.src,i=n.lastIndexOf("?"),a=-1==i?n.length:i;if("base.js"==n.substr(a-7,7))return void(goog.basePath=n.substr(0,a-7))}},goog.importScript_=function(e,t){var o=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;o(e,t)&&(goog.dependencies_.written[e]=!0)},goog.IS_OLD_IE_=!goog.global.atob&&goog.global.document&&goog.global.document.all,goog.importModule_=function(e){var t='goog.retrieveAndExecModule_("'+e+'");';goog.importScript_("",t)&&(goog.dependencies_.written[e]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(e,t){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(t+"\n//# sourceURL="+e+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+t+"\n;return exports});\n//# sourceURL="+e+"\n"},goog.loadQueuedModules_=function(){var e=goog.queuedModules_.length;if(e>0){var t=goog.queuedModules_;goog.queuedModules_=[];for(var o=0;e>o;o++){var r=t[o];goog.maybeProcessDeferredPath_(r)}}},goog.maybeProcessDeferredDep_=function(e){if(goog.isDeferredModule_(e)&&goog.allDepsAreAvailable_(e)){var t=goog.getPathFromDeps_(e);goog.maybeProcessDeferredPath_(goog.basePath+t)}},goog.isDeferredModule_=function(e){var t=goog.getPathFromDeps_(e);if(t&&goog.dependencies_.pathIsModule[t]){var o=goog.basePath+t;return o in goog.dependencies_.deferred}return!1},goog.allDepsAreAvailable_=function(e){var t=goog.getPathFromDeps_(e);if(t&&t in goog.dependencies_.requires)for(var o in goog.dependencies_.requires[t])if(!goog.isProvided_(o)&&!goog.isDeferredModule_(o))return!1;return!0},goog.maybeProcessDeferredPath_=function(e){if(e in goog.dependencies_.deferred){var t=goog.dependencies_.deferred[e];delete goog.dependencies_.deferred[e],goog.globalEval(t)}},goog.loadModule=function(e){var t=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1};var o;if(goog.isFunction(e))o=e.call(goog.global,{});else{if(!goog.isString(e))throw Error("Invalid module definition");o=goog.loadModuleFromSource_.call(goog.global,e)}var r=goog.moduleLoaderState_.moduleName;if(!goog.isString(r)||!r)throw Error('Invalid module name "'+r+'"');if(goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(r,o):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(o),goog.loadedModules_[r]=o,goog.moduleLoaderState_.declareTestMethods)for(var n in o)(0===n.indexOf("test",0)||"tearDown"==n||"setUp"==n||"setUpPage"==n||"tearDownPage"==n)&&(goog.global[n]=o[n])}finally{goog.moduleLoaderState_=t}},goog.loadModuleFromSource_=function(source){var exports={};return eval(arguments[0]),exports},goog.writeScriptSrcNode_=function(e){goog.global.document.write('<script type="text/javascript" src="'+e+'"></script>')},goog.appendScriptSrcNode_=function(e){var t=goog.global.document,o=t.createElement("script");o.type="text/javascript",o.src=e,o.defer=!1,o.async=!1,t.head.appendChild(o)},goog.writeScriptTag_=function(e,t){if(goog.inHtmlDocument_()){var o=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==o.readyState){var r=/\bdeps.js$/.test(e);if(r)return!1;throw Error('Cannot write "'+e+'" after document load')}var n=goog.IS_OLD_IE_;if(void 0===t)if(n){var i=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";o.write('<script type="text/javascript" src="'+e+'"'+i+"></script>")}else goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(e):goog.writeScriptSrcNode_(e);else o.write('<script type="text/javascript">'+t+"</script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(e,t){return"complete"==e.readyState&&goog.lastNonModuleScriptIndex_==t&&goog.loadQueuedModules_(),!0},goog.writeScripts_=function(){function e(n){if(!(n in r.written)){if(n in r.visited)return void(n in o||(o[n]=!0,t.push(n)));if(r.visited[n]=!0,n in r.requires)for(var i in r.requires[n])if(!goog.isProvided_(i)){if(!(i in r.nameToPath))throw Error("Undefined nameToPath for "+i);e(r.nameToPath[i])}n in o||(o[n]=!0,t.push(n))}}var t=[],o={},r=goog.dependencies_;for(var n in goog.included_)r.written[n]||e(n);for(var i=0;i<t.length;i++){var n=t[i];goog.dependencies_.written[n]=!0}var a=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(var s=!1,i=0;i<t.length;i++){var n=t[i];if(!n)throw goog.moduleLoaderState_=a,Error("Undefined script input");r.pathIsModule[n]?(s=!0,goog.importModule_(goog.basePath+n)):goog.importScript_(goog.basePath+n)}goog.moduleLoaderState_=a},goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.normalizePath_=function(e){for(var t=e.split("/"),o=0;o<t.length;)"."==t[o]?t.splice(o,1):o&&".."==t[o]&&t[o-1]&&".."!=t[o-1]?t.splice(--o,2):o++;return t.join("/")},goog.loadFileSync_=function(e){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(e);var t=new goog.global.XMLHttpRequest;return t.open("get",e,!1),t.send(),t.responseText},goog.retrieveAndExecModule_=function(e){if(!COMPILED){var t=e;e=goog.normalizePath_(e);var o=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,r=goog.loadFileSync_(e);if(null==r)throw new Error("load of "+e+"failed");var n=goog.wrapModule_(e,r),i=goog.IS_OLD_IE_;i?(goog.dependencies_.deferred[t]=n,goog.queuedModules_.push(t)):o(e,n)}},goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t},goog.isNull=function(e){return null===e},goog.isDefAndNotNull=function(e){return null!=e},goog.isArray=function(e){return"array"==goog.typeOf(e)},goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length},goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear},goog.isString=function(e){return"string"==typeof e},goog.isBoolean=function(e){return"boolean"==typeof e},goog.isNumber=function(e){return"number"==typeof e},goog.isFunction=function(e){return"function"==goog.typeOf(e)},goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(e){return!!e[goog.UID_PROPERTY_]},goog.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(t){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.cloneObject(e[r]);return o}return e},goog.bindNative_=function(e,t,o){return e.call.apply(e.bind,arguments)},goog.bindJs_=function(e,t,o){if(!e)throw new Error;if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(o,r),e.apply(t,o)}}return function(){return e.apply(t,arguments)}},goog.bind=function(e,t,o){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(e,t){var o=Array.prototype.slice.call(arguments,1);return function(){var t=o.slice();return t.push.apply(t,arguments),e.apply(this,t)}},goog.mixin=function(e,t){for(var o in t)e[o]=t[o]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,o=t.createElement("SCRIPT");o.type="text/javascript",o.defer=!1,o.appendChild(t.createTextNode(e)),t.body.appendChild(o),t.body.removeChild(o)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(e,t){var o,r=function(e){return goog.cssNameMapping_[e]||e},n=function(e){for(var t=e.split("-"),o=[],n=0;n<t.length;n++)o.push(r(t[n]));return o.join("-")};return o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:n:function(e){return e},t?e+"-"+o(t):o(e)},goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e,goog.cssNameMappingStyle_=t},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(e,t){return t&&(e=e.replace(/\{\$([^}]+)}/g,function(e,o){return o in t?t[o]:e})),e},goog.getMsgWithFallback=function(e,t){return e},goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)},goog.exportProperty=function(e,t,o){e[t]=o},goog.inherits=function(e,t){function o(){}o.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new o,e.prototype.constructor=e,e.base=function(e,o,r){for(var n=new Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[o].apply(e,n)}},goog.base=function(e,t,o){var r=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!r)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(r.superClass_){for(var n=new Array(arguments.length-1),i=1;i<arguments.length;i++)n[i-1]=arguments[i];return r.superClass_.constructor.apply(e,n)}for(var a=new Array(arguments.length-2),i=2;i<arguments.length;i++)a[i-2]=arguments[i];for(var s=!1,d=e.constructor;d;d=d.superClass_&&d.superClass_.constructor)if(d.prototype[t]===r)s=!0;else if(s)return d.prototype[t].apply(e,a);if(e[t]===r)return e.constructor.prototype[t].apply(e,a);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(e){e.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(e,t){var o=t.constructor,r=t.statics;o&&o!=Object.prototype.constructor||(o=function(){throw Error("cannot instantiate an interface (no constructor defined).")});var n=goog.defineClass.createSealingConstructor_(o,e);return e&&goog.inherits(n,e),delete t.constructor,delete t.statics,goog.defineClass.applyProperties_(n.prototype,t),null!=r&&(r instanceof Function?r(n):goog.defineClass.applyProperties_(n,r)),n},goog.defineClass.ClassDescriptor,goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG),goog.defineClass.createSealingConstructor_=function(e,t){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(t&&t.prototype&&t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return e;var o=function(){var t=e.apply(this,arguments)||this;return t[goog.UID_PROPERTY_]=t[goog.UID_PROPERTY_],this.constructor===o&&Object.seal(t),t};return o}return e},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.defineClass.applyProperties_=function(e,t){var o;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);for(var r=0;r<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;r++)o=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[r],Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},goog.tagUnsealableClass=function(e){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.provide("wd.core.view.EventQueue"),wd.core.view.EventQueue=function(){this.eventLists_=[],this.recursionDepth_=0},wd.core.view.EventQueue.prototype.queueEvents=function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o],n=r.getPath();null===t||n.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new wd.core.view.EventList(n)),t.add(r)}t&&this.eventLists_.push(t)},wd.core.view.EventQueue.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},wd.core.view.EventQueue.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},wd.core.view.EventQueue.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,o=0;o<this.eventLists_.length;o++){var r=this.eventLists_[o];if(r){var n=r.getPath();e(n)?(this.eventLists_[o].raise(),this.eventLists_[o]=null):t=!1}}t&&(this.eventLists_=[]),this.recursionDepth_--},wd.core.view.EventList=function(e){this.path_=e,this.events_=[]},wd.core.view.EventList.prototype.add=function(e){this.events_.push(e)},wd.core.view.EventList.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var o=t.getEventRunner();wd.core.util.logger&&wd.core.util.log("event: "+t.toString()),wd.core.util.exceptionGuard(o)}}},wd.core.view.EventList.prototype.getPath=function(){return this.path_},goog.provide("goog.string"),goog.provide("goog.string.Unicode"),goog.define("goog.string.DETECT_DOUBLE_ESCAPING",!1),goog.define("goog.string.FORCE_NON_DOM_HTML_UNESCAPING",!1),goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},goog.string.endsWith=function(e,t){var o=e.length-t.length;return o>=0&&e.indexOf(t,o)==o},goog.string.caseInsensitiveStartsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(0,t.length))},goog.string.caseInsensitiveEndsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(e.length-t.length,t.length))},goog.string.caseInsensitiveEquals=function(e,t){return e.toLowerCase()==t.toLowerCase()},goog.string.subs=function(e,t){for(var o=e.split("%s"),r="",n=Array.prototype.slice.call(arguments,1);n.length&&o.length>1;)r+=o.shift()+n.shift();return r+o.join("%s")},goog.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmptyOrWhitespace=function(e){return/^[\s\xa0]*$/.test(e)},goog.string.isEmptyString=function(e){return 0==e.length},goog.string.isEmpty=goog.string.isEmptyOrWhitespace,goog.string.isEmptyOrWhitespaceSafe=function(e){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(e))},goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe,goog.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},goog.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},goog.string.isNumeric=function(e){return!/[^0-9]/.test(e)},goog.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},goog.string.isSpace=function(e){return" "==e},goog.string.isUnicodeChar=function(e){return 1==e.length&&e>=" "&&"~">=e||e>=""&&"�">=e},goog.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(e,t){var o=String(e).toLowerCase(),r=String(t).toLowerCase();return r>o?-1:o==r?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var o=e.toLowerCase().match(goog.string.numerateCompareRegExp_),r=t.toLowerCase().match(goog.string.numerateCompareRegExp_),n=Math.min(o.length,r.length),i=0;n>i;i++){var a=o[i],s=r[i];if(a!=s){var d=parseInt(a,10);if(!isNaN(d)){var l=parseInt(s,10);if(!isNaN(l)&&d-l)return d-l}return s>a?-1:1}}return o.length!=r.length?o.length-r.length:t>e?-1:1},goog.string.urlEncode=function(e){return encodeURIComponent(String(e))},goog.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},goog.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},goog.string.htmlEscape=function(e,t){return t?(e=e.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING&&(e=e.replace(goog.string.E_RE_,"&#101;")),e):goog.string.ALL_RE_.test(e)?(-1!=e.indexOf("&")&&(e=e.replace(goog.string.AMP_RE_,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(goog.string.LT_RE_,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(goog.string.GT_RE_,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(goog.string.QUOT_RE_,"&quot;")),-1!=e.indexOf("'")&&(e=e.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;")),-1!=e.indexOf("\x00")&&(e=e.replace(goog.string.NULL_RE_,"&#0;")),goog.string.DETECT_DOUBLE_ESCAPING&&-1!=e.indexOf("e")&&(e=e.replace(goog.string.E_RE_,"&#101;")),e):e},goog.string.AMP_RE_=/&/g,goog.string.LT_RE_=/</g,goog.string.GT_RE_=/>/g,goog.string.QUOT_RE_=/"/g,goog.string.SINGLE_QUOTE_RE_=/'/g,goog.string.NULL_RE_=/\x00/g,goog.string.E_RE_=/e/g,goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/,goog.string.unescapeEntities=function(e){return goog.string.contains(e,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(e):goog.string.unescapePureXmlEntities_(e):e},goog.string.unescapeEntitiesWithDocument=function(e,t){return goog.string.contains(e,"&")?goog.string.unescapeEntitiesUsingDom_(e,t):e},goog.string.unescapeEntitiesUsingDom_=function(e,t){var o,r={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};return o=t?t.createElement("div"):goog.global.document.createElement("div"),e.replace(goog.string.HTML_ENTITY_PATTERN_,function(e,t){var n=r[e];if(n)return n;if("#"==t.charAt(0)){var i=Number("0"+t.substr(1));isNaN(i)||(n=String.fromCharCode(i))}return n||(o.innerHTML=e+" ",n=o.firstChild.nodeValue.slice(0,-1)),r[e]=n})},goog.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var o=Number("0"+t.substr(1));if(!isNaN(o))return String.fromCharCode(o)}return e}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(e,t){return goog.string.newLineToBr(e.replace(/  /g," &#160;"),t)},goog.string.preserveSpaces=function(e){return e.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(e,t){for(var o=t.length,r=0;o>r;r++){var n=1==o?t:t.charAt(r);if(e.charAt(0)==n&&e.charAt(e.length-1)==n)return e.substring(1,e.length-1)}return e},goog.string.truncate=function(e,t,o){return o&&(e=goog.string.unescapeEntities(e)),e.length>t&&(e=e.substring(0,t-3)+"..."),o&&(e=goog.string.htmlEscape(e)),e},goog.string.truncateMiddle=function(e,t,o,r){if(o&&(e=goog.string.unescapeEntities(e)),r&&e.length>t){r>t&&(r=t);var n=e.length-r,i=t-r;e=e.substring(0,i)+"..."+e.substring(n)}else if(e.length>t){var a=Math.floor(t/2),s=e.length-a;a+=t%2,e=e.substring(0,a)+"..."+e.substring(s)}return o&&(e=goog.string.htmlEscape(e)),e},goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(e){if(e=String(e),e.quote)return e.quote();for(var t=['"'],o=0;o<e.length;o++){var r=e.charAt(o),n=r.charCodeAt(0);t[o+1]=goog.string.specialEscapeChars_[r]||(n>31&&127>n?r:goog.string.escapeChar(r))}return t.push('"'),t.join("")},goog.string.escapeString=function(e){for(var t=[],o=0;o<e.length;o++)t[o]=goog.string.escapeChar(e.charAt(o));return t.join("")},goog.string.escapeChar=function(e){if(e in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[e];if(e in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[e]=goog.string.specialEscapeChars_[e];var t=e,o=e.charCodeAt(0);return o>31&&127>o?t=e:(256>o?(t="\\x",(16>o||o>256)&&(t+="0")):(t="\\u",4096>o&&(t+="0")),t+=o.toString(16).toUpperCase()),goog.string.jsEscapeCache_[e]=t},goog.string.contains=function(e,t){return-1!=e.indexOf(t)},goog.string.caseInsensitiveContains=function(e,t){return goog.string.contains(e.toLowerCase(),t.toLowerCase())},goog.string.countOf=function(e,t){return e&&t?e.split(t).length-1:0},goog.string.removeAt=function(e,t,o){var r=e;return t>=0&&t<e.length&&o>0&&(r=e.substr(0,t)+e.substr(t+o,e.length-t-o)),r},goog.string.remove=function(e,t){var o=new RegExp(goog.string.regExpEscape(t),"");return e.replace(o,"")},goog.string.removeAll=function(e,t){var o=new RegExp(goog.string.regExpEscape(t),"g");return e.replace(o,"")},goog.string.regExpEscape=function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(e,t){return new Array(t+1).join(e)},goog.string.padNumber=function(e,t,o){var r=goog.isDef(o)?e.toFixed(o):String(e),n=r.indexOf(".");return-1==n&&(n=r.length),goog.string.repeat("0",Math.max(0,t-n))+r},goog.string.makeSafe=function(e){return null==e?"":String(e)},goog.string.buildString=function(e){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){var e=2147483648;return Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^goog.now()).toString(36)},goog.string.compareVersions=function(e,t){for(var o=0,r=goog.string.trim(String(e)).split("."),n=goog.string.trim(String(t)).split("."),i=Math.max(r.length,n.length),a=0;0==o&&i>a;a++){var s=r[a]||"",d=n[a]||"",l=new RegExp("(\\d*)(\\D*)","g"),g=new RegExp("(\\d*)(\\D*)","g");do{var u=l.exec(s)||["","",""],c=g.exec(d)||["","",""];if(0==u[0].length&&0==c[0].length)break;var p=0==u[1].length?0:parseInt(u[1],10),h=0==c[1].length?0:parseInt(c[1],10);o=goog.string.compareElements_(p,h)||goog.string.compareElements_(0==u[2].length,0==c[2].length)||goog.string.compareElements_(u[2],c[2])}while(0==o)}return o},goog.string.compareElements_=function(e,t){return t>e?-1:e>t?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(e){for(var t=0,o=0;o<e.length;++o)t=31*t+e.charCodeAt(o),t%=goog.string.HASHCODE_MAX_;return t},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(e){var t=Number(e);return 0==t&&goog.string.isEmptyOrWhitespace(e)?NaN:t},goog.string.isLowerCamelCase=function(e){return/^[a-z]+([A-Z][a-z]*)*$/.test(e)},goog.string.isUpperCamelCase=function(e){return/^([A-Z][a-z]*)+$/.test(e)},goog.string.toCamelCase=function(e){return String(e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})},goog.string.toSelectorCase=function(e){return String(e).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(e,t){var o=goog.isString(t)?goog.string.regExpEscape(t):"\\s";o=o?"|["+o+"]+":"";var r=new RegExp("(^"+o+")([a-z])","g");return e.replace(r,function(e,t,o){return t+o.toUpperCase()})},goog.string.capitalize=function(e){return String(e.charAt(0)).toUpperCase()+String(e.substr(1)).toLowerCase()},goog.string.parseInt=function(e){return isFinite(e)&&(e=String(e)),goog.isString(e)?/^\s*-?0x/i.test(e)?parseInt(e,16):parseInt(e,10):NaN},goog.string.splitLimit=function(e,t,o){for(var r=e.split(t),n=[];o>0&&r.length;)n.push(r.shift()),o--;return r.length&&n.push(r.join(t)),n},goog.string.editDistance=function(e,t){var o=[],r=[];if(e==t)return 0;if(!e.length||!t.length)return Math.max(e.length,t.length);for(var n=0;n<t.length+1;n++)o[n]=n;for(var n=0;n<e.length;n++){r[0]=n+1;for(var i=0;i<t.length;i++){var a=e[n]!=t[i];r[i+1]=Math.min(r[i]+1,o[i+1]+1,o[i]+a)}for(var i=0;i<o.length;i++)o[i]=r[i]}return r[t.length]},goog.provide("wd.core.util.ServerValues"),wd.core.util.ServerValues.generateWithValues=function(e){return e=e||{},e.timestamp=e.timestamp||(new Date).getTime(),e},wd.core.util.ServerValues.resolveDeferredValue=function(e,t){return e&&"object"==typeof e?(wd.core.util.assert(".sv"in e,"Unexpected leaf node or priority contents"),t[e[".sv"]]):e},wd.core.util.ServerValues.resolveDeferredValueTree=function(e,t){var o=new wd.core.SparseSnapshotTree;return e.forEachTree(new wd.core.util.Path(""),function(e,r){o.remember(e,wd.core.util.ServerValues.resolveDeferredValueSnapshot(r,t))}),o},wd.core.util.ServerValues.resolveDeferredValueSnapshot=function(e,t){var o,r=e.getPriority().val(),n=wd.core.util.ServerValues.resolveDeferredValue(r,t);if(e.isLeafNode()){var i=e,a=wd.core.util.ServerValues.resolveDeferredValue(i.getValue(),t);return a!==i.getValue()||n!==i.getPriority().val()?new wd.core.snap.LeafNode(a,wd.core.snap.NodeFromJSON(n)):e}var s=e;return o=s,n!==s.getPriority().val()&&(o=o.updatePriority(new wd.core.snap.LeafNode(n))),s.forEachChild(wd.core.snap.PriorityIndex,function(e,r){var n=wd.core.util.ServerValues.resolveDeferredValueSnapshot(r,t);n!==r&&(o=o.updateImmediateChild(e,n))}),o},goog.provide("goog.dom.NodeType"),goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.provide("goog.debug.Error"),goog.debug.Error=function(e){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var t=(new Error).stack;t&&(this.stack=t)}e&&(this.message=String(e)),this.reportErrorToServer=!0},goog.inherits(goog.debug.Error,Error),
goog.debug.Error.prototype.name="CustomError",goog.provide("goog.asserts"),goog.provide("goog.asserts.AssertionError"),goog.require("goog.debug.Error"),goog.require("goog.dom.NodeType"),goog.require("goog.string"),goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG),goog.asserts.AssertionError=function(e,t){t.unshift(e),goog.debug.Error.call(this,goog.string.subs.apply(null,t)),t.shift(),this.messagePattern=e},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(e){throw e},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.doAssertFailure_=function(e,t,o,r){var n="Assertion failed";if(o){n+=": "+o;var i=r}else e&&(n+=": "+e,i=t);var a=new goog.asserts.AssertionError(""+n,i||[]);goog.asserts.errorHandler_(a)},goog.asserts.setErrorHandler=function(e){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=e)},goog.asserts.assert=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!e&&goog.asserts.doAssertFailure_("",null,t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.fail=function(e,t){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(e)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertString=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(e)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertFunction=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(e)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertObject=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(e)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertArray=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(e)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertBoolean=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(e)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertElement=function(e,t,o){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(e)&&e.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertInstanceof=function(e,t,o,r){return!goog.asserts.ENABLE_ASSERTS||e instanceof t||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(t),goog.asserts.getType_(e)],o,Array.prototype.slice.call(arguments,3)),e},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var e in Object.prototype)goog.asserts.fail(e+" should not be enumerable in Object.prototype.")},goog.asserts.getType_=function(e){return e instanceof Function?e.displayName||e.name||"unknown type name":e instanceof Object?e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e):null===e?"null":typeof e},goog.provide("goog.array"),goog.provide("goog.array.ArrayLike"),goog.require("goog.asserts"),goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE),goog.define("goog.array.ASSUME_NATIVE_FUNCTIONS",!1),goog.array.ArrayLike,goog.array.peek=function(e){return e[e.length-1]},goog.array.last=goog.array.peek,goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(e,t,o)}:function(e,t,o){var r=null==o?0:0>o?Math.max(0,e.length+o):o;if(goog.isString(e))return goog.isString(t)&&1==t.length?e.indexOf(t,r):-1;for(var n=r;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(e,t,o){goog.asserts.assert(null!=e.length);var r=null==o?e.length-1:o;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(e,t,r)}:function(e,t,o){var r=null==o?e.length-1:o;if(0>r&&(r=Math.max(0,e.length+r)),goog.isString(e))return goog.isString(t)&&1==t.length?e.lastIndexOf(t,r):-1;for(var n=r;n>=0;n--)if(n in e&&e[n]===t)return n;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(e,t,o){goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)i in n&&t.call(o,n[i],i,e)},goog.array.forEachRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;i>=0;--i)i in n&&t.call(o,n[i],i,e)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.filter.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=[],i=0,a=goog.isString(e)?e.split(""):e,s=0;r>s;s++)if(s in a){var d=a[s];t.call(o,d,s,e)&&(n[i++]=d)}return n},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.map.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=new Array(r),i=goog.isString(e)?e.split(""):e,a=0;r>a;a++)a in i&&(n[a]=t.call(o,i[a],a,e));return n},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(e,t,o,r){return goog.asserts.assert(null!=e.length),r&&(t=goog.bind(t,r)),goog.array.ARRAY_PROTOTYPE_.reduce.call(e,t,o)}:function(e,t,o,r){var n=o;return goog.array.forEach(e,function(o,i){n=t.call(r,n,o,i,e)}),n},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(e,t,o,r){return goog.asserts.assert(null!=e.length),r&&(t=goog.bind(t,r)),goog.array.ARRAY_PROTOTYPE_.reduceRight.call(e,t,o)}:function(e,t,o,r){var n=o;return goog.array.forEachRight(e,function(o,i){n=t.call(r,n,o,i,e)}),n},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.some.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)if(i in n&&t.call(o,n[i],i,e))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.every.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)if(i in n&&!t.call(o,n[i],i,e))return!1;return!0},goog.array.count=function(e,t,o){var r=0;return goog.array.forEach(e,function(e,n,i){t.call(o,e,n,i)&&++r},o),r},goog.array.find=function(e,t,o){var r=goog.array.findIndex(e,t,o);return 0>r?null:goog.isString(e)?e.charAt(r):e[r]},goog.array.findIndex=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.findRight=function(e,t,o){var r=goog.array.findIndexRight(e,t,o);return 0>r?null:goog.isString(e)?e.charAt(r):e[r]},goog.array.findIndexRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;i>=0;i--)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.contains=function(e,t){return goog.array.indexOf(e,t)>=0},goog.array.isEmpty=function(e){return 0==e.length},goog.array.clear=function(e){if(!goog.isArray(e))for(var t=e.length-1;t>=0;t--)delete e[t];e.length=0},goog.array.insert=function(e,t){goog.array.contains(e,t)||e.push(t)},goog.array.insertAt=function(e,t,o){goog.array.splice(e,o,0,t)},goog.array.insertArrayAt=function(e,t,o){goog.partial(goog.array.splice,e,o,0).apply(null,t)},goog.array.insertBefore=function(e,t,o){var r;2==arguments.length||(r=goog.array.indexOf(e,o))<0?e.push(t):goog.array.insertAt(e,t,r)},goog.array.remove=function(e,t){var o,r=goog.array.indexOf(e,t);return(o=r>=0)&&goog.array.removeAt(e,r),o},goog.array.removeAt=function(e,t){return goog.asserts.assert(null!=e.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1).length},goog.array.removeIf=function(e,t,o){var r=goog.array.findIndex(e,t,o);return r>=0?(goog.array.removeAt(e,r),!0):!1},goog.array.removeAllIf=function(e,t,o){var r=0;return goog.array.forEachRight(e,function(n,i){t.call(o,n,i,e)&&goog.array.removeAt(e,i)&&r++}),r},goog.array.concat=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.join=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(e){var t=e.length;if(t>0){for(var o=new Array(t),r=0;t>r;r++)o[r]=e[r];return o}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(e,t){for(var o=1;o<arguments.length;o++){var r=arguments[o];if(goog.isArrayLike(r)){var n=e.length||0,i=r.length||0;e.length=n+i;for(var a=0;i>a;a++)e[n+a]=r[a]}else e.push(r)}},goog.array.splice=function(e,t,o,r){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(e,goog.array.slice(arguments,1))},goog.array.slice=function(e,t,o){return goog.asserts.assert(null!=e.length),arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(e,t):goog.array.ARRAY_PROTOTYPE_.slice.call(e,t,o)},goog.array.removeDuplicates=function(e,t,o){for(var r=t||e,n=function(e){return goog.isObject(l)?"o"+goog.getUid(l):(typeof l).charAt(0)+l},i=o||n,a={},s=0,d=0;d<e.length;){var l=e[d++],g=i(l);Object.prototype.hasOwnProperty.call(a,g)||(a[g]=!0,r[s++]=l)}r.length=s},goog.array.binarySearch=function(e,t,o){return goog.array.binarySearch_(e,o||goog.array.defaultCompare,!1,t)},goog.array.binarySelect=function(e,t,o){return goog.array.binarySearch_(e,t,!0,void 0,o)},goog.array.binarySearch_=function(e,t,o,r,n){for(var i,a=0,s=e.length;s>a;){var d,l=a+s>>1;d=o?t.call(n,e[l],l,e):t(r,e[l]),d>0?a=l+1:(s=l,i=!d)}return i?a:~a},goog.array.sort=function(e,t){e.sort(t||goog.array.defaultCompare)},goog.array.stableSort=function(e,t){function o(e,t){return n(e.value,t.value)||e.index-t.index}for(var r=0;r<e.length;r++)e[r]={index:r,value:e[r]};var n=t||goog.array.defaultCompare;goog.array.sort(e,o);for(var r=0;r<e.length;r++)e[r]=e[r].value},goog.array.sortByKey=function(e,t,o){var r=o||goog.array.defaultCompare;goog.array.sort(e,function(e,o){return r(t(e),t(o))})},goog.array.sortObjectsByKey=function(e,t,o){goog.array.sortByKey(e,function(e){return e[t]},o)},goog.array.isSorted=function(e,t,o){for(var r=t||goog.array.defaultCompare,n=1;n<e.length;n++){var i=r(e[n-1],e[n]);if(i>0||0==i&&o)return!1}return!0},goog.array.equals=function(e,t,o){if(!goog.isArrayLike(e)||!goog.isArrayLike(t)||e.length!=t.length)return!1;for(var r=e.length,n=o||goog.array.defaultCompareEquality,i=0;r>i;i++)if(!n(e[i],t[i]))return!1;return!0},goog.array.compare3=function(e,t,o){for(var r=o||goog.array.defaultCompare,n=Math.min(e.length,t.length),i=0;n>i;i++){var a=r(e[i],t[i]);if(0!=a)return a}return goog.array.defaultCompare(e.length,t.length)},goog.array.defaultCompare=function(e,t){return e>t?1:t>e?-1:0},goog.array.inverseDefaultCompare=function(e,t){return-goog.array.defaultCompare(e,t)},goog.array.defaultCompareEquality=function(e,t){return e===t},goog.array.binaryInsert=function(e,t,o){var r=goog.array.binarySearch(e,t,o);return 0>r?(goog.array.insertAt(e,t,-(r+1)),!0):!1},goog.array.binaryRemove=function(e,t,o){var r=goog.array.binarySearch(e,t,o);return r>=0?goog.array.removeAt(e,r):!1},goog.array.bucket=function(e,t,o){for(var r={},n=0;n<e.length;n++){var i=e[n],a=t.call(o,i,n,e);if(goog.isDef(a)){var s=r[a]||(r[a]=[]);s.push(i)}}return r},goog.array.toObject=function(e,t,o){var r={};return goog.array.forEach(e,function(n,i){r[t.call(o,n,i,e)]=n}),r},goog.array.range=function(e,t,o){var r=[],n=0,i=e,a=o||1;if(void 0!==t&&(n=e,i=t),0>a*(i-n))return[];if(a>0)for(var s=n;i>s;s+=a)r.push(s);else for(var s=n;s>i;s+=a)r.push(s);return r},goog.array.repeat=function(e,t){for(var o=[],r=0;t>r;r++)o[r]=e;return o},goog.array.flatten=function(e){for(var t=8192,o=[],r=0;r<arguments.length;r++){var n=arguments[r];if(goog.isArray(n))for(var i=0;i<n.length;i+=t)for(var a=goog.array.slice(n,i,i+t),s=goog.array.flatten.apply(null,a),d=0;d<s.length;d++)o.push(s[d]);else o.push(n)}return o},goog.array.rotate=function(e,t){return goog.asserts.assert(null!=e.length),e.length&&(t%=e.length,t>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(e,e.splice(-t,t)):0>t&&goog.array.ARRAY_PROTOTYPE_.push.apply(e,e.splice(0,-t))),e},goog.array.moveItem=function(e,t,o){goog.asserts.assert(t>=0&&t<e.length),goog.asserts.assert(o>=0&&o<e.length);var r=goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1);goog.array.ARRAY_PROTOTYPE_.splice.call(e,o,0,r[0])},goog.array.zip=function(e){if(!arguments.length)return[];for(var t=[],o=0;!0;o++){for(var r=[],n=0;n<arguments.length;n++){var i=arguments[n];if(o>=i.length)return t;r.push(i[o])}t.push(r)}},goog.array.shuffle=function(e,t){for(var o=t||Math.random,r=e.length-1;r>0;r--){var n=Math.floor(o()*(r+1)),i=e[r];e[r]=e[n],e[n]=i}},goog.array.copyByIndex=function(e,t){var o=[];return goog.array.forEach(t,function(t){o.push(e[t])}),o},goog.provide("goog.object"),goog.object.forEach=function(e,t,o){for(var r in e)t.call(o,e[r],r,e)},goog.object.filter=function(e,t,o){var r={};for(var n in e)t.call(o,e[n],n,e)&&(r[n]=e[n]);return r},goog.object.map=function(e,t,o){var r={};for(var n in e)r[n]=t.call(o,e[n],n,e);return r},goog.object.some=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return!0;return!1},goog.object.every=function(e,t,o){for(var r in e)if(!t.call(o,e[r],r,e))return!1;return!0},goog.object.getCount=function(e){var t=0;for(var o in e)t++;return t},goog.object.getAnyKey=function(e){for(var t in e)return t},goog.object.getAnyValue=function(e){for(var t in e)return e[t]},goog.object.contains=function(e,t){return goog.object.containsValue(e,t)},goog.object.getValues=function(e){var t=[],o=0;for(var r in e)t[o++]=e[r];return t},goog.object.getKeys=function(e){var t=[],o=0;for(var r in e)t[o++]=r;return t},goog.object.getValueByKeys=function(e,t){for(var o=goog.isArrayLike(t),r=o?t:arguments,n=o?0:1;n<r.length&&(e=e[r[n]],goog.isDef(e));n++);return e},goog.object.containsKey=function(e,t){return t in e},goog.object.containsValue=function(e,t){for(var o in e)if(e[o]==t)return!0;return!1},goog.object.findKey=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return r;return void 0},goog.object.findValue=function(e,t,o){var r=goog.object.findKey(e,t,o);return r&&e[r]},goog.object.isEmpty=function(e){for(var t in e)return!1;return!0},goog.object.clear=function(e){for(var t in e)delete e[t]},goog.object.remove=function(e,t){var o;return(o=t in e)&&delete e[t],o},goog.object.add=function(e,t,o){if(t in e)throw Error('The object already contains the key "'+t+'"');goog.object.set(e,t,o)},goog.object.get=function(e,t,o){return t in e?e[t]:o},goog.object.set=function(e,t,o){e[t]=o},goog.object.setIfUndefined=function(e,t,o){return t in e?e[t]:e[t]=o},goog.object.setWithReturnValueIfNotSet=function(e,t,o){if(t in e)return e[t];var r=o();return e[t]=r,r},goog.object.equals=function(e,t){for(var o in e)if(!(o in t)||e[o]!==t[o])return!1;for(var o in t)if(!(o in e))return!1;return!0},goog.object.clone=function(e){var t={};for(var o in e)t[o]=e[o];return t},goog.object.unsafeClone=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.object.unsafeClone(e[r]);return o}return e},goog.object.transpose=function(e){var t={};for(var o in e)t[e[o]]=o;return t},goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.object.extend=function(e,t){for(var o,r,n=1;n<arguments.length;n++){r=arguments[n];for(o in r)e[o]=r[o];for(var i=0;i<goog.object.PROTOTYPE_FIELDS_.length;i++)o=goog.object.PROTOTYPE_FIELDS_[i],Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}},goog.object.create=function(e){var t=arguments.length;if(1==t&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(t%2)throw Error("Uneven number of arguments");for(var o={},r=0;t>r;r+=2)o[arguments[r]]=arguments[r+1];return o},goog.object.createSet=function(e){var t=arguments.length;if(1==t&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var o={},r=0;t>r;r++)o[arguments[r]]=!0;return o},goog.object.createImmutableView=function(e){var t=e;return Object.isFrozen&&!Object.isFrozen(e)&&(t=Object.create(e),Object.freeze(t)),t},goog.object.isImmutableView=function(e){return!!Object.isFrozen&&Object.isFrozen(e)},goog.provide("wd.util.obj"),wd.util.obj.contains=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},wd.util.obj.get=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0},wd.util.obj.foreach=function(e,t){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t(o,e[o])},wd.util.obj.clone=function(e){var t={};return wd.util.obj.foreach(e,function(e,o){t[e]=o}),t},goog.provide("wd.core.stats.StatsCollection"),goog.require("wd.util.obj"),goog.require("goog.array"),goog.require("goog.object"),wd.core.stats.StatsCollection=function(){this.counters_={}},wd.core.stats.StatsCollection.prototype.incrementCounter=function(e,t){goog.isDef(t)||(t=1),wd.util.obj.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},wd.core.stats.StatsCollection.prototype.get=function(){return goog.object.clone(this.counters_)},goog.provide("wd.core.stats.StatsListener"),wd.core.stats.StatsListener=function(e){this.collection_=e,this.last_=null},wd.core.stats.StatsListener.prototype.get=function(){var e=this.collection_.get(),t=goog.object.clone(e);if(this.last_)for(var o in this.last_)t[o]=t[o]-this.last_[o];return this.last_=e,t},goog.provide("wd.core.stats.StatsReporter");var FIRST_STATS_MIN_TIME=1e4,FIRST_STATS_MAX_TIME=3e4,REPORT_STATS_INTERVAL=3e5;wd.core.stats.StatsReporter=function(e,t){this.statsToReport_={},this.statsListener_=new wd.core.stats.StatsListener(e),this.server_=t;var o=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeout(goog.bind(this.reportStats_,this),Math.floor(o))},wd.core.stats.StatsReporter.prototype.includeStat=function(e){this.statsToReport_[e]=!0},wd.core.stats.StatsReporter.prototype.reportStats_=function(){var e=this.statsListener_.get(),t={},o=!1;for(var r in e)e[r]>0&&wd.util.obj.contains(this.statsToReport_,r)&&(t[r]=e[r],o=!0);o&&this.server_.reportStats(t),setTimeout(goog.bind(this.reportStats_,this),Math.floor(2*Math.random()*REPORT_STATS_INTERVAL))},goog.provide("wd.core.stats.StatsManager"),goog.require("wd.core.stats.StatsCollection"),goog.require("wd.core.stats.StatsListener"),goog.require("wd.core.stats.StatsReporter"),wd.core.stats.StatsManager={},wd.core.stats.StatsManager.collections_={},wd.core.stats.StatsManager.reporters_={},wd.core.stats.StatsManager.getCollection=function(e){var t=e.toString();return wd.core.stats.StatsManager.collections_[t]||(wd.core.stats.StatsManager.collections_[t]=new wd.core.stats.StatsCollection),wd.core.stats.StatsManager.collections_[t]},wd.core.stats.StatsManager.getOrCreateReporter=function(e,t){var o=e.toString();return wd.core.stats.StatsManager.reporters_[o]||(wd.core.stats.StatsManager.reporters_[o]=t()),wd.core.stats.StatsManager.reporters_[o]},goog.provide("wd.core.storage.DOMStorageWrapper"),goog.require("wd.util.obj"),goog.scope(function(){wd.core.storage.DOMStorageWrapper=function(e){this.domStorage_=e,this.prefix_="wilddog:"};var e=wd.core.storage.DOMStorageWrapper;e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),wd.util.json.stringify(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:wd.util.json.eval(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.isInMemoryStorage=!1,e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()}}),goog.provide("wd.core.storage.MemoryStorage"),goog.require("wd.util.obj"),goog.scope(function(){var e=wd.util.obj;wd.core.storage.MemoryStorage=function(){this.cache_={}};var t=wd.core.storage.MemoryStorage;t.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},t.prototype.get=function(t){return e.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(e){delete this.cache_[e]},t.prototype.isInMemoryStorage=!0}),goog.provide("wd.core.storage"),goog.require("wd.core.storage.DOMStorageWrapper"),goog.require("wd.core.storage.MemoryStorage"),wd.core.storage.createStoragefor=function(e){try{if("undefined"!=typeof window&&"undefined"!=typeof window[e]){var t=window[e];return t.setItem("wilddog:sentinel","cache"),t.removeItem("wilddog:sentinel"),new wd.core.storage.DOMStorageWrapper(t)}}catch(o){}return new wd.core.storage.MemoryStorage},wd.core.storage.PersistentStorage=wd.core.storage.createStoragefor("localStorage"),wd.core.storage.SessionStorage=wd.core.storage.createStoragefor("sessionStorage"),goog.provide("wd.core.RepoInfo"),goog.require("wd.core.storage"),wd.core.RepoInfo=function(e,t,o,r,n){this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.secure=t,this.namespace=o,this.webSocketOnly=r,this.persistenceKey=n||"",this.internalHost=wd.core.storage.PersistentStorage.get("host:"+e)||this.host},wd.core.RepoInfo.prototype.needsQueryParam=function(){return this.host!==this.internalHost},wd.core.RepoInfo.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},wd.core.RepoInfo.prototype.isDemoHost=function(){return"wilddogio-demo.com"===this.domain},wd.core.RepoInfo.prototype.isCustomHost=function(){return"wilddogio.com"!==this.domain&&"wilddogio-demo.com"!==this.domain},wd.core.RepoInfo.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&wd.core.storage.PersistentStorage.set("host:"+this.host,this.internalHost))},wd.core.RepoInfo.prototype.toString=function(){var e=(this.secure?"https://":"http://")+this.host;return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},goog.provide("goog.crypt.Hash"),goog.crypt.Hash=function(){this.blockSize=-1},goog.crypt.Hash.prototype.reset=goog.abstractMethod,goog.crypt.Hash.prototype.update=goog.abstractMethod,goog.crypt.Hash.prototype.digest=goog.abstractMethod,goog.provide("goog.crypt.Sha1"),goog.require("goog.crypt.Hash"),goog.crypt.Sha1=function(){goog.crypt.Sha1.base(this,"constructor"),this.blockSize=64,this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.inbuf_=0,this.total_=0,this.reset()},goog.inherits(goog.crypt.Sha1,goog.crypt.Hash),goog.crypt.Sha1.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},goog.crypt.Sha1.prototype.compress_=function(e,t){t||(t=0);var o=this.W_;if(goog.isString(e))for(var r=0;16>r;r++)o[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(var r=0;16>r;r++)o[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(var r=16;80>r;r++){var n=o[r-3]^o[r-8]^o[r-14]^o[r-16];o[r]=4294967295&(n<<1|n>>>31)}for(var i,a,s=this.chain_[0],d=this.chain_[1],l=this.chain_[2],g=this.chain_[3],u=this.chain_[4],r=0;80>r;r++){40>r?20>r?(i=g^d&(l^g),a=1518500249):(i=d^l^g,a=1859775393):60>r?(i=d&l|g&(d|l),a=2400959708):(i=d^l^g,a=3395469782);var n=(s<<5|s>>>27)+i+u+a+o[r]&4294967295;u=g,g=l,l=4294967295&(d<<30|d>>>2),d=s,s=n}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+d&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+g&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},goog.crypt.Sha1.prototype.update=function(e,t){if(null!=e){goog.isDef(t)||(t=e.length);for(var o=t-this.blockSize,r=0,n=this.buf_,i=this.inbuf_;t>r;){if(0==i)for(;o>=r;)this.compress_(e,r),r+=this.blockSize;if(goog.isString(e)){for(;t>r;)if(n[i]=e.charCodeAt(r),++i,++r,i==this.blockSize){this.compress_(n),i=0;break}}else for(;t>r;)if(n[i]=e[r],++i,++r,i==this.blockSize){this.compress_(n),i=0;break}}this.inbuf_=i,this.total_+=t}},goog.crypt.Sha1.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var o=this.blockSize-1;o>=56;o--)this.buf_[o]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,o=0;5>o;o++)for(var n=24;n>=0;n-=8)e[r]=this.chain_[o]>>n&255,++r;return e},goog.provide("wd.constants");var CLIENT_VERSION="0.4.3";goog.provide("goog.json"),goog.provide("goog.json.Replacer"),goog.provide("goog.json.Reviver"),goog.provide("goog.json.Serializer"),goog.define("goog.json.USE_NATIVE_JSON",!1),goog.json.isValid=function(e){if(/^\s*$/.test(e))return!1;var t=/\\["\\\/bfnrtu]/g,o=/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,n=/^[\],:{}\s\u2028\u2029]*$/;return n.test(e.replace(t,"@").replace(o,"]").replace(r,""))},goog.json.parse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){var o=String(s);if(goog.json.isValid(o))try{return eval("("+o+")")}catch(ex){}throw Error("Invalid JSON string: "+o)},goog.json.unsafeParse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){return eval("("+s+")")},goog.json.Replacer,goog.json.Reviver,goog.json.serialize=goog.json.USE_NATIVE_JSON?goog.global.JSON.stringify:function(e,t){return new goog.json.Serializer(t).serialize(e)},goog.json.Serializer=function(e){this.replacer_=e},goog.json.Serializer.prototype.serialize=function(e){var t=[];return this.serializeInternal(e,t),t.join("")},goog.json.Serializer.prototype.serializeInternal=function(e,t){if(null==e)return void t.push("null");if("object"==typeof e){if(goog.isArray(e))return void this.serializeArray(e,t);if(!(e instanceof String||e instanceof Number||e instanceof Boolean))return void this.serializeObject_(e,t);e=e.valueOf()}switch(typeof e){case"string":this.serializeString_(e,t);break;case"number":this.serializeNumber_(e,t);break;case"boolean":t.push(e);break;case"function":break;default:throw Error("Unknown type: "+typeof e)}},goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},goog.json.Serializer.charsToReplace_=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,goog.json.Serializer.prototype.serializeString_=function(e,t){t.push('"',e.replace(goog.json.Serializer.charsToReplace_,function(e){var t=goog.json.Serializer.charToJsonCharCache_[e];return t||(t="\\u"+(65536|e.charCodeAt(0)).toString(16).substr(1),goog.json.Serializer.charToJsonCharCache_[e]=t),t}),'"')},goog.json.Serializer.prototype.serializeNumber_=function(e,t){t.push(isFinite(e)&&!isNaN(e)?e:"null")},goog.json.Serializer.prototype.serializeArray=function(e,t){var o=e.length;t.push("[");for(var r="",n=0;o>n;n++){t.push(r);var i=e[n];this.serializeInternal(this.replacer_?this.replacer_.call(e,String(n),i):i,t),r=","}t.push("]")},goog.json.Serializer.prototype.serializeObject_=function(e,t){t.push("{");var o="";for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=e[r];"function"!=typeof n&&(t.push(o),this.serializeString_(r,t),t.push(":"),this.serializeInternal(this.replacer_?this.replacer_.call(e,r,n):n,t),o=",")}t.push("}")},goog.provide("wd.util"),goog.require("wd.util.obj"),wd.util.querystring=function(e){var t=[];return wd.util.obj.foreach(e,function(e,o){goog.isArray(o)?goog.array.forEach(o,function(o){t.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}),t.length?"&"+t.join("&"):""},wd.util.querystringDecode=function(e){var t={},o=e.replace(/^\?/,"").split("&");return goog.array.forEach(o,function(e){if(e){var o=e.split("=");t[o[0]]=o[1]}}),t},goog.provide("wd.util.json"),goog.require("goog.json"),wd.util.json.eval=function(e){return"undefined"!=typeof JSON&&goog.isDef(JSON.parse)?JSON.parse(e):goog.json.parse(e)},wd.util.json.stringify=function(e){return"undefined"!=typeof JSON&&goog.isDef(JSON.stringify)?JSON.stringify(e):goog.json.serialize(e)},goog.provide("wd.core.SnapshotHolder"),wd.core.SnapshotHolder=function(){this.rootNode_=wd.core.snap.EMPTY_NODE},wd.core.SnapshotHolder.prototype.getNode=function(e){return this.rootNode_.getChild(e)},wd.core.SnapshotHolder.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},goog.DEBUG&&(wd.core.SnapshotHolder.prototype.toString=function(){return this.rootNode_.toString()}),goog.provide("goog.crypt"),goog.require("goog.array"),goog.require("goog.asserts"),goog.crypt.stringToByteArray=function(e){for(var t=[],o=0,r=0;r<e.length;r++){for(var n=e.charCodeAt(r);n>255;)t[o++]=255&n,n>>=8;t[o++]=n}return t},goog.crypt.byteArrayToString=function(e){var t=8192;if(e.length<t)return String.fromCharCode.apply(null,e);for(var o="",r=0;r<e.length;r+=t){var n=goog.array.slice(e,r,r+t);o+=String.fromCharCode.apply(null,n)}return o},goog.crypt.byteArrayToHex=function(e){return goog.array.map(e,function(e){var t=e.toString(16);return t.length>1?t:"0"+t}).join("")},goog.crypt.hexToByteArray=function(e){goog.asserts.assert(e.length%2==0,"Key string length must be multiple of 2");for(var t=[],o=0;o<e.length;o+=2)t.push(parseInt(e.substring(o,o+2),16));return t},goog.crypt.stringToUtf8ByteArray=function(e){e=e.replace(/\r\n/g,"\n");for(var t=[],o=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);128>n?t[o++]=n:2048>n?(t[o++]=n>>6|192,t[o++]=63&n|128):(t[o++]=n>>12|224,t[o++]=n>>6&63|128,t[o++]=63&n|128)}return t},goog.crypt.utf8ByteArrayToString=function(e){for(var t=[],o=0,r=0;o<e.length;){var n=e[o++];if(128>n)t[r++]=String.fromCharCode(n);else if(n>191&&224>n){var i=e[o++];t[r++]=String.fromCharCode((31&n)<<6|63&i)}else{var i=e[o++],a=e[o++];t[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return t.join("")},goog.crypt.xorByteArray=function(e,t){goog.asserts.assert(e.length==t.length,"XOR array lengths must match");for(var o=[],r=0;r<e.length;r++)o.push(e[r]^t[r]);return o},goog.provide("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.util.getNativeUserAgentString_=function(){var e=goog.labs.userAgent.util.getNavigator_();if(e){var t=e.userAgent;if(t)return t}return""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(e){goog.labs.userAgent.util.userAgent_=e||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(e){
var t=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(t,e)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(e){var t=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(t,e)},goog.labs.userAgent.util.extractVersionTuples=function(e){for(var t,o=new RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),r=[];t=o.exec(e);)r.push([t[1],t[2],t[3]||void 0]);return r},goog.provide("goog.labs.userAgent.platform"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")},goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()},goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")},goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")},goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")},goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")},goog.labs.userAgent.platform.getVersion=function(){var e,t=goog.labs.userAgent.util.getUserAgent(),o="";if(goog.labs.userAgent.platform.isWindows()){e=/Windows (?:NT|Phone) ([0-9.]+)/;var r=e.exec(t);o=r?r[1]:"0.0"}else if(goog.labs.userAgent.platform.isIos()){e=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/;var r=e.exec(t);o=r&&r[1].replace(/_/g,".")}else if(goog.labs.userAgent.platform.isMacintosh()){e=/Mac OS X ([0-9_.]+)/;var r=e.exec(t);o=r?r[1].replace(/_/g,"."):"10"}else if(goog.labs.userAgent.platform.isAndroid()){e=/Android\s+([^\);]+)(\)|;)/;var r=e.exec(t);o=r&&r[1]}else if(goog.labs.userAgent.platform.isChromeOS()){e=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/;var r=e.exec(t);o=r&&r[1]}return o||""},goog.labs.userAgent.platform.isVersionOrHigher=function(e){return goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),e)>=0},goog.provide("goog.labs.userAgent.browser"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.object"),goog.require("goog.string"),goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")||goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.matchIE_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))},goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")},goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")},goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchOpera_()&&!goog.labs.userAgent.browser.matchIE_()},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_,goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){function e(e){var t=goog.array.find(e,n);return r[t]||""}var t=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(t);var o=goog.labs.userAgent.util.extractVersionTuples(t),r={};goog.array.forEach(o,function(e){var t=e[0],o=e[1];r[t]=o});var n=goog.partial(goog.object.containsKey,r);if(goog.labs.userAgent.browser.isOpera())return e(["Version","Opera","OPR"]);if(goog.labs.userAgent.browser.isChrome())return e(["Chrome","CriOS"]);var i=o[2];return i&&i[1]||""},goog.labs.userAgent.browser.isVersionOrHigher=function(e){return goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),e)>=0},goog.labs.userAgent.browser.getIEVersion_=function(e){var t=/rv: *([\d\.]*)/.exec(e);if(t&&t[1])return t[1];var o=/Edge\/([\d\.]+)/.exec(e);if(o)return o[1];var r="",n=/MSIE +([\d\.]+)/.exec(e);if(n&&n[1]){var i=/Trident\/(\d.\d)/.exec(e);if("7.0"==n[1])if(i&&i[1])switch(i[1]){case"4.0":r="8.0";break;case"5.0":r="9.0";break;case"6.0":r="10.0";break;case"7.0":r="11.0"}else r="7.0";else r=n[1]}return r},goog.provide("goog.labs.userAgent.engine"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isEdge=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.getVersion=function(){var e=goog.labs.userAgent.util.getUserAgent();if(e){var t=goog.labs.userAgent.util.extractVersionTuples(e),o=goog.labs.userAgent.engine.getEngineTuple_(t);if(o)return"Gecko"==o[0]?goog.labs.userAgent.engine.getVersionForKey_(t,"Firefox"):o[1];var r,n=t[0];if(n&&(r=n[2])){var i=/Trident\/([^\s;]+)/.exec(r);if(i)return i[1]}}return""},goog.labs.userAgent.engine.getEngineTuple_=function(e){if(!goog.labs.userAgent.engine.isEdge())return e[1];for(var t=0;t<e.length;t++){var o=e[t];if("Edge"==o[0])return o}},goog.labs.userAgent.engine.isVersionOrHigher=function(e){return goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),e)>=0},goog.labs.userAgent.engine.getVersionForKey_=function(e,t){var o=goog.array.find(e,function(e){return t==e[0]});return o&&o[1]||""},goog.provide("goog.userAgent"),goog.require("goog.labs.userAgent.browser"),goog.require("goog.labs.userAgent.engine"),goog.require("goog.labs.userAgent.platform"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.define("goog.userAgent.ASSUME_IE",!1),goog.define("goog.userAgent.ASSUME_GECKO",!1),goog.define("goog.userAgent.ASSUME_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_OPERA",!1),goog.define("goog.userAgent.ASSUME_ANY_VERSION",!1),goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigator=function(){return goog.global.navigator||null},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var e=goog.userAgent.getNavigator();return e&&e.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.define("goog.userAgent.ASSUME_MAC",!1),goog.define("goog.userAgent.ASSUME_WINDOWS",!1),goog.define("goog.userAgent.ASSUME_LINUX",!1),goog.define("goog.userAgent.ASSUME_X11",!1),goog.define("goog.userAgent.ASSUME_ANDROID",!1),goog.define("goog.userAgent.ASSUME_IPHONE",!1),goog.define("goog.userAgent.ASSUME_IPAD",!1),goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh(),goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows(),goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()},goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_(),goog.userAgent.isX11_=function(){var e=goog.userAgent.getNavigator();return!!e&&goog.string.contains(e.appVersion||"","X11")},goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_(),goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid(),goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone(),goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.determineVersion_=function(){if(goog.userAgent.OPERA&&goog.global.opera){var e=goog.global.opera.version;return goog.isFunction(e)?e():e}var t="",o=goog.userAgent.getVersionRegexResult_();if(o&&(t=o?o[1]:""),goog.userAgent.IE&&!goog.labs.userAgent.engine.isEdge()){var r=goog.userAgent.getDocumentMode_();if(r>parseFloat(t))return String(r)}return t},goog.userAgent.getVersionRegexResult_=function(){var e=goog.userAgent.getUserAgentString();return goog.userAgent.GECKO?/rv\:([^\);]+)(\)|;)/.exec(e):goog.userAgent.IE&&goog.labs.userAgent.engine.isEdge()?/Edge\/([\d\.]+)/.exec(e):goog.userAgent.IE?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):goog.userAgent.WEBKIT?/WebKit\/(\S+)/.exec(e):void 0},goog.userAgent.getDocumentMode_=function(){var e=goog.global.document;return e?e.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(e,t){return goog.string.compareVersions(e,t)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(e){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[e]||(goog.userAgent.isVersionOrHigherCache_[e]=goog.string.compareVersions(goog.userAgent.VERSION,e)>=0)},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(e){return goog.userAgent.IE&&(goog.labs.userAgent.engine.isEdge()||goog.userAgent.DOCUMENT_MODE>=e)},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var e=goog.global.document,t=goog.userAgent.getDocumentMode_();return!e||!goog.userAgent.IE||!t&&goog.labs.userAgent.engine.isEdge()?void 0:t||("CSS1Compat"==e.compatMode?parseInt(goog.userAgent.VERSION,10):5)}(),goog.provide("goog.crypt.base64"),goog.require("goog.crypt"),goog.require("goog.userAgent"),goog.crypt.base64.byteToCharMap_=null,goog.crypt.base64.charToByteMap_=null,goog.crypt.base64.byteToCharMapWebSafe_=null,goog.crypt.base64.charToByteMapWebSafe_=null,goog.crypt.base64.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.ENCODED_VALS_BASE+"+/=",goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_.",goog.crypt.base64.HAS_NATIVE_SUPPORT=goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA||"function"==typeof goog.global.atob,goog.crypt.base64.encodeByteArray=function(e,t){if(!goog.isArrayLike(e))throw Error("encodeByteArray takes an array as a parameter");goog.crypt.base64.init_();for(var o=t?goog.crypt.base64.byteToCharMapWebSafe_:goog.crypt.base64.byteToCharMap_,r=[],n=0;n<e.length;n+=3){var i=e[n],a=n+1<e.length,s=a?e[n+1]:0,d=n+2<e.length,l=d?e[n+2]:0,g=i>>2,u=(3&i)<<4|s>>4,c=(15&s)<<2|l>>6,p=63&l;d||(p=64,a||(c=64)),r.push(o[g],o[u],o[c],o[p])}return r.join("")},goog.crypt.base64.encodeString=function(e,t){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!t?goog.global.btoa(e):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(e),t)},goog.crypt.base64.decodeString=function(e,t){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!t?goog.global.atob(e):goog.crypt.byteArrayToString(goog.crypt.base64.decodeStringToByteArray(e,t))},goog.crypt.base64.decodeStringToByteArray=function(e,t){goog.crypt.base64.init_();for(var o=t?goog.crypt.base64.charToByteMapWebSafe_:goog.crypt.base64.charToByteMap_,r=[],n=0;n<e.length;){var i=o[e.charAt(n++)],a=n<e.length,s=a?o[e.charAt(n)]:0;++n;var d=n<e.length,l=d?o[e.charAt(n)]:64;++n;var g=n<e.length,u=g?o[e.charAt(n)]:64;if(++n,null==i||null==s||null==l||null==u)throw Error();var c=i<<2|s>>4;if(r.push(c),64!=l){var p=s<<4&240|l>>2;if(r.push(p),64!=u){var h=l<<6&192|u;r.push(h)}}}return r},goog.crypt.base64.init_=function(){if(!goog.crypt.base64.byteToCharMap_){goog.crypt.base64.byteToCharMap_={},goog.crypt.base64.charToByteMap_={},goog.crypt.base64.byteToCharMapWebSafe_={},goog.crypt.base64.charToByteMapWebSafe_={};for(var e=0;e<goog.crypt.base64.ENCODED_VALS.length;e++)goog.crypt.base64.byteToCharMap_[e]=goog.crypt.base64.ENCODED_VALS.charAt(e),goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[e]]=e,goog.crypt.base64.byteToCharMapWebSafe_[e]=goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(e),goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.byteToCharMapWebSafe_[e]]=e,e>=goog.crypt.base64.ENCODED_VALS_BASE.length&&(goog.crypt.base64.charToByteMap_[goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(e)]=e,goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.ENCODED_VALS.charAt(e)]=e)}},goog.provide("wd.core.util"),goog.require("wd.constants"),goog.require("wd.core.RepoInfo"),goog.require("wd.core.storage"),goog.require("wd.util.json"),goog.require("goog.crypt.Sha1"),goog.require("goog.crypt.base64"),goog.require("goog.object"),goog.require("goog.string"),wd.core.util.LUIDGenerator=function(){var e=1;return function(){return e++}}(),wd.core.util.assert=function(e,t){if(!e)throw wd.core.util.assertionError(t)},wd.core.util.assertionError=function(e){return new Error("Wilddog ("+Wilddog.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},wd.core.util.assertWeak=function(e,t){e||wd.core.util.error(t)},wd.core.util.base64Encode=function(e){var t=wd.util.utf8.stringToByteArray(e);return goog.crypt.base64.encodeByteArray(t,!0)},wd.core.util.base64Decode=function(e){try{return NODE_CLIENT?new Buffer(e,"base64").toString("utf8"):"undefined"!=typeof atob?atob(e):goog.crypt.base64.decodeString(e,!0)}catch(t){wd.core.util.log("base64Decode failed: ",t)}return null},wd.core.util.sha1=function(e){var t=wd.util.utf8.stringToByteArray(e),o=new goog.crypt.Sha1;o.update(t);var r=o.digest();return goog.crypt.base64.encodeByteArray(r)},wd.core.util.buildLogMessage_=function(e){for(var t="",o=0;o<arguments.length;o++)t+=goog.isArrayLike(arguments[o])?wd.core.util.buildLogMessage_.apply(null,arguments[o]):"object"==typeof arguments[o]?wd.util.json.stringify(arguments[o]):arguments[o],t+=" ";return t},wd.core.util.logger=null,wd.core.util.firstLog_=!0,wd.core.util.log=function(e){if(wd.core.util.firstLog_===!0&&(wd.core.util.firstLog_=!1,null===wd.core.util.logger&&wd.core.storage.SessionStorage.get("logging_enabled")===!0&&Wilddog.enableLogging(!0)),wd.core.util.logger){var t=wd.core.util.buildLogMessage_.apply(null,arguments);wd.core.util.logger(t)}},wd.core.util.logWrapper=function(e){return function(){wd.core.util.log(e,arguments)}},wd.core.util.error=function(e){if("undefined"!=typeof console){var t="WILDDOG INTERNAL ERROR: "+wd.core.util.buildLogMessage_.apply(null,arguments);"undefined"!=typeof console.error?console.error(t):console.log(t)}},wd.core.util.fatal=function(e){var t=wd.core.util.buildLogMessage_.apply(null,arguments);throw new Error("WILDDOG FATAL ERROR: "+t)},wd.core.util.warn=function(e){if("undefined"!=typeof console){var t="WILDDOG WARNING: "+wd.core.util.buildLogMessage_.apply(null,arguments);"undefined"!=typeof console.warn?console.warn(t):console.log(t)}},wd.core.util.warnIfPageIsSecure=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&wd.core.util.warn("Insecure Wilddog access from a secure page. Please use https in calls to new Wilddog().")},wd.core.util.warnAboutUnsupportedMethod=function(e){wd.core.util.warn(e+" is unsupported and will likely change soon.  Please do not use.")},wd.core.util.parseRepoInfo=function(e){var t=wd.core.util.parseURL(e),o=t.subdomain;"wilddog"===t.domain&&wd.core.util.fatal(t.host+" is no longer supported. Please use <YOUR WILDDOG>.wilddogio.com instead"),o||wd.core.util.fatal("Cannot parse Wilddog url. Please use https://<YOUR WILDDOG>.wilddogio.com"),t.secure||wd.core.util.warnIfPageIsSecure();var r="ws"===t.scheme||"wss"===t.scheme;return{repoInfo:new wd.core.RepoInfo(t.host,t.secure,o,r),path:new wd.core.util.Path(t.pathString)}},wd.core.util.parseURL=function(e){var t="",o="",r="",n="",i=!0,a="https",s=443;if(goog.isString(e)){var d=e.indexOf("//");d>=0&&(a=e.substring(0,d-1),e=e.substring(d+2));var l=e.indexOf("/");-1===l&&(l=e.length),t=e.substring(0,l),n=wd.core.util.decodePath(e.substring(l));var g=t.split(".");3===g.length?(o=g[1],r=g[0].toLowerCase()):2===g.length&&(o=g[0]),d=t.indexOf(":"),d>=0&&(i="https"===a||"wss"===a,s=goog.string.parseInt(t.substring(d+1)))}return{host:t,port:s,domain:o,subdomain:r,secure:i,scheme:a,pathString:n}},wd.core.util.decodePath=function(e){for(var t="",o=e.split("/"),r=0;r<o.length;r++)if(o[r].length>0){var n=o[r];try{n=goog.string.urlDecode(n)}catch(i){}t+="/"+n}return t},wd.core.util.isInvalidJSONNumber=function(e){return goog.isNumber(e)&&(e!=e||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY)},wd.core.util.executeWhenDOMReady=function(e){if(NODE_CLIENT||"complete"===document.readyState)e();else{var t=!1,o=function(){return document.body?void(t||(t=!0,e())):void setTimeout(o,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&o()}),window.attachEvent("onload",o))}},wd.core.util.MIN_NAME="[MIN_NAME]",wd.core.util.MAX_NAME="[MAX_NAME]",wd.core.util.nameCompare=function(e,t){if(e===t)return 0;if(e===wd.core.util.MIN_NAME||t===wd.core.util.MAX_NAME)return-1;if(t===wd.core.util.MIN_NAME||e===wd.core.util.MAX_NAME)return 1;var o=wd.core.util.tryParseInt(e),r=wd.core.util.tryParseInt(t);return null!==o?null!==r?o-r==0?e.length-t.length:o-r:-1:null!==r?1:t>e?-1:1},wd.core.util.stringCompare=function(e,t){return e===t?0:t>e?-1:1},wd.core.util.requireKey=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+wd.util.json.stringify(t))},wd.core.util.ObjectToUniqueKey=function(e){if("object"!=typeof e||null===e)return wd.util.json.stringify(e);var t=[];for(var o in e)t.push(o);t.sort();for(var r="{",n=0;n<t.length;n++)0!==n&&(r+=","),r+=wd.util.json.stringify(t[n]),r+=":",r+=wd.core.util.ObjectToUniqueKey(e[t[n]]);return r+="}"},wd.core.util.splitStringBySize=function(e,t){if(e.length<=t)return[e];for(var o=[],r=0;r<e.length;r+=t)r+t>e?o.push(e.substring(r,e.length)):o.push(e.substring(r,r+t));return o},wd.core.util.each=function(e,t){if(goog.isArray(e))for(var o=0;o<e.length;++o)t(o,e[o]);else goog.object.forEach(e,t)},wd.core.util.bindCallback=function(e,t){return t?goog.bind(e,t):e},wd.core.util.doubleToIEEE754String=function(e){wd.core.util.assert(!wd.core.util.isInvalidJSONNumber(e),"Invalid JSON number");var t,o,r,n,i,a,s,d=11,l=52,g=(1<<d-1)-1;for(0===e?(o=0,r=0,t=1/e===-(1/0)?1:0):(t=0>e,e=Math.abs(e),e>=Math.pow(2,1-g)?(n=Math.min(Math.floor(Math.log(e)/Math.LN2),g),o=n+g,r=Math.round(e*Math.pow(2,l-n)-Math.pow(2,l))):(o=0,r=Math.round(e/Math.pow(2,1-g-l)))),a=[],i=l;i;i-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(i=d;i;i-=1)a.push(o%2?1:0),o=Math.floor(o/2);a.push(t?1:0),a.reverse(),s=a.join("");var u="";for(i=0;64>i;i+=8){var c=parseInt(s.substr(i,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},wd.core.util.isChromeExtensionContentScript=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},wd.core.util.isWindowsStoreApp=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},wd.core.util.errorForServerCode=function(e){var t="Unknown Error";"too_big"===e?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?t="Client doesn't have permission to access the desired data.":"unavailable"==e&&(t="The service is unavailable");var o=new Error(e+": "+t);return o.code=e.toUpperCase(),o},wd.core.util.INTEGER_REGEXP_=new RegExp("^-?\\d{1,10}$"),wd.core.util.tryParseInt=function(e){if(wd.core.util.INTEGER_REGEXP_.test(e)){var t=Number(e);if(t>=-2147483648&&2147483647>=t)return t}return null},wd.core.util.exceptionGuard=function(e){try{e()}catch(t){setTimeout(function(){var e=t.stack||"";throw wd.core.util.warn("Exception was thrown by user callback.",e),t},Math.floor(0))}},wd.core.util.callUserCallback=function(e,t){if(goog.isFunction(e)){var o=Array.prototype.slice.call(arguments,1),r=o.slice();wd.core.util.exceptionGuard(function(){e.apply(null,r)})}},wd.core.util.beingCrawled=function(){var e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},goog.provide("wd.util.jwt"),goog.require("wd.core.util"),goog.require("wd.util.json"),goog.require("wd.util.obj"),goog.require("goog.crypt.base64"),goog.require("goog.json"),wd.util.jwt.decode=function(e){var t={},o={},r={},n="";try{var i=e.split(".");t=wd.util.json.eval(wd.core.util.base64Decode(i[0])||""),o=wd.util.json.eval(wd.core.util.base64Decode(i[1])||""),n=i[2],r=o.d||{},delete o.d}catch(a){}return{header:t,claims:o,data:r,signature:n}},wd.util.jwt.isValidTimestamp=function(e){var t,o,r=wd.util.jwt.decode(e).claims,n=Math.floor((new Date).getTime()/1e3);return"object"==typeof r&&(r.hasOwnProperty("nbf")?t=wd.util.obj.get(r,"nbf"):r.hasOwnProperty("iat")&&(t=wd.util.obj.get(r,"iat")),o=r.hasOwnProperty("exp")?wd.util.obj.get(r,"exp"):t+86400),n&&t&&o&&n>=t&&o>=n},wd.util.jwt.issuedAtTime=function(e){var t=wd.util.jwt.decode(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?wd.util.obj.get(t,"iat"):null},wd.util.jwt.isValidFormat=function(e){return!0},wd.util.jwt.isAdmin=function(e){var t=wd.util.jwt.decode(e).claims;return"object"==typeof t&&wd.util.obj.get(t,"admin")===!0},goog.provide("wd.core.ReadonlyRestClient"),goog.require("wd.core.util"),goog.require("wd.util"),goog.require("wd.util.json"),goog.require("wd.util.jwt"),goog.require("wd.util.obj"),wd.core.ReadonlyRestClient=goog.defineClass(null,{constructor:function(e,t){this.log_=wd.core.util.logWrapper("p:rest:"),this.repoInfo_=e,this.onDataUpdate_=t,this.credential_=null,this.listens_={}},listen:function(e,t,o,r){var n=e.path.toString();this.log_("Listen called for "+n+" "+e.queryIdentifier());var i=wd.core.ReadonlyRestClient.getListenId_(e,o),a=new Object;this.listens_[i]=a;var s=e.getQueryParams().toRestQueryStringParameters(),d=this;this.restRequest_(n+".json",s,function(e,t){var s=t;if(404===e&&(s=null,e=null),null===e&&d.onDataUpdate_(n,s,!1,o),wd.util.obj.get(d.listens_,i)===a){var l;l=e?401==e?"permission_denied":"rest_error:"+e:"ok",r(l,null)}})},unlisten:function(e,t){var o=wd.core.ReadonlyRestClient.getListenId_(e,t);delete this.listens_[o]},auth:function(e,t,o){this.credential_=e;var r=wd.util.jwt.decode(e),n=r.data,i=r.claims&&r.claims.exp;t&&t("ok",{auth:n,expires:i})},unauth:function(e){this.credential_=null,e("ok",null)},onDisconnectPut:function(e,t,o){},onDisconnectMerge:function(e,t,o){},onDisconnectCancel:function(e,t){},put:function(e,t,o,r){},merge:function(e,t,o,r){},reportStats:function(e){},restRequest_:function(e,t,o){t=t||{},t.format="export",this.credential_&&(t.auth=this.credential_);var r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?"+wd.util.querystring(t);this.log_("Sending REST request for "+r);var n=new XMLHttpRequest,i=this;n.onreadystatechange=function(){if(o&&4===n.readyState){i.log_("REST Response for "+r+" received. status:",n.status,"response:",n.responseText);var e=null;if(n.status>=200&&n.status<300){try{e=wd.util.json.eval(n.responseText)}catch(t){wd.core.util.warn("Failed to parse JSON response for "+r+": "+n.responseText)}o(null,e)}else 401!==n.status&&404!==n.status&&wd.core.util.warn("Got unsuccessful REST response for "+r+" Status: "+n.status),o(n.status);o=null}},n.open("GET",r,!0),n.send()},statics:{getListenId_:function(e,t){return goog.isDef(t)?"tag$"+t:(wd.core.util.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())}}}),goog.provide("wd.core.util.SortedMap"),goog.require("goog.array"),wd.Comparator,wd.core.util.SortedMap=goog.defineClass(null,{constructor:function(e,t){this.comparator_=e,this.root_=t?t:wd.core.util.SortedMap.EMPTY_NODE_},insert:function(e,t){return new wd.core.util.SortedMap(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,wd.LLRBNode.BLACK,null,null))},remove:function(e){return new wd.core.util.SortedMap(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,wd.LLRBNode.BLACK,null,null))},get:function(e){for(var t,o=this.root_;!o.isEmpty();){if(t=this.comparator_(e,o.key),0===t)return o.value;0>t?o=o.left:t>0&&(o=o.right)}return null},getPredecessorKey:function(e){for(var t,o=this.root_,r=null;!o.isEmpty();){if(t=this.comparator_(e,o.key),0===t){if(o.left.isEmpty())return r?r.key:null;for(o=o.left;!o.right.isEmpty();)o=o.right;return o.key}0>t?o=o.left:t>0&&(r=o,o=o.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},isEmpty:function(){return this.root_.isEmpty()},count:function(){return this.root_.count()},minKey:function(){return this.root_.minKey()},maxKey:function(){return this.root_.maxKey()},inorderTraversal:function(e){return this.root_.inorderTraversal(e)},reverseTraversal:function(e){return this.root_.reverseTraversal(e)},getIterator:function(e){return new wd.core.util.SortedMapIterator(this.root_,null,this.comparator_,!1,e)},getIteratorFrom:function(e,t){return new wd.core.util.SortedMapIterator(this.root_,e,this.comparator_,!1,t)},getReverseIteratorFrom:function(e,t){return new wd.core.util.SortedMapIterator(this.root_,e,this.comparator_,!0,t)},getReverseIterator:function(e){return new wd.core.util.SortedMapIterator(this.root_,null,this.comparator_,!0,e)}}),wd.core.util.SortedMapIterator=goog.defineClass(null,{constructor:function(e,t,o,r,n){this.resultGenerator_=n||null,this.isReverse_=r,this.nodeStack_=[];for(var i=1;!e.isEmpty();)if(i=t?o(e.key,t):1,r&&(i*=-1),0>i)e=this.isReverse_?e.left:e.right;else{if(0===i){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}},getNext:function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},hasNext:function(){return this.nodeStack_.length>0},peek:function(){if(0===this.nodeStack_.length)return null;var e=goog.array.peek(this.nodeStack_);return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}),wd.LLRBNode=goog.defineClass(null,{constructor:function(e,t,o,r,n){this.key=e,this.value=t,this.color=null!=o?o:wd.LLRBNode.RED,this.left=null!=r?r:wd.core.util.SortedMap.EMPTY_NODE_,this.right=null!=n?n:wd.core.util.SortedMap.EMPTY_NODE_},statics:{RED:!0,BLACK:!1},copy:function(e,t,o,r,n){return new wd.LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=o?o:this.color,null!=r?r:this.left,null!=n?n:this.right)},count:function(){return this.left.count()+1+this.right.count()},isEmpty:function(){return!1},inorderTraversal:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},reverseTraversal:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},min_:function(){return this.left.isEmpty()?this:this.left.min_()},minKey:function(){return this.min_().key},maxKey:function(){return this.right.isEmpty()?this.key:this.right.maxKey()},insert:function(e,t,o){var r,n;return n=this,r=o(e,n.key),n=0>r?n.copy(null,null,null,n.left.insert(e,t,o),null):0===r?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,o)),n.fixUp_()},removeMin_:function(){var e;return this.left.isEmpty()?wd.core.util.SortedMap.EMPTY_NODE_:(e=this,e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_())},remove:function(e,t){var o,r;if(o=this,t(e,o.key)<0)o.left.isEmpty()||o.left.isRed_()||o.left.left.isRed_()||(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),o.right.isEmpty()||o.right.isRed_()||o.right.left.isRed_()||(o=o.moveRedRight_()),0===t(e,o.key)){if(o.right.isEmpty())return wd.core.util.SortedMap.EMPTY_NODE_;r=o.right.min_(),o=o.copy(r.key,r.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,t));
}return o.fixUp_()},isRed_:function(){return this.color},fixUp_:function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},moveRedLeft_:function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e},moveRedRight_:function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e},rotateLeft_:function(){var e;return e=this.copy(null,null,wd.LLRBNode.RED,null,this.right.left),this.right.copy(null,null,this.color,e,null)},rotateRight_:function(){var e;return e=this.copy(null,null,wd.LLRBNode.RED,this.left.right,null),this.left.copy(null,null,this.color,null,e)},colorFlip_:function(){var e,t;return e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null),this.copy(null,null,!this.color,e,t)},checkMaxDepth_:function(){var e;return e=this.check_(),Math.pow(2,e)<=this.count()+1?!0:!1},check_:function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if(e=this.left.check_(),e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}),wd.LLRBEmptyNode=goog.defineClass(null,{constructor:function(){},copy:function(){return this},insert:function(e,t,o){return new wd.LLRBNode(e,t,null)},remove:function(e,t){return this},count:function(){return 0},isEmpty:function(){return!0},inorderTraversal:function(e){return!1},reverseTraversal:function(e){return!1},minKey:function(){return null},maxKey:function(){return null},check_:function(){return 0},isRed_:function(){return!1}}),wd.core.util.SortedMap.EMPTY_NODE_=new wd.LLRBEmptyNode,goog.provide("wd.core.snap.comparators"),wd.core.snap.NAME_ONLY_COMPARATOR=function(e,t){return wd.core.util.nameCompare(e.name,t.name)},wd.core.snap.NAME_COMPARATOR=function(e,t){return wd.core.util.nameCompare(e,t)},goog.provide("wd.core.snap.Index"),goog.provide("wd.core.snap.PriorityIndex"),goog.provide("wd.core.snap.SubKeyIndex"),goog.require("wd.core.snap.comparators"),goog.require("wd.core.util"),wd.core.snap.Index=function(){},wd.core.snap.Index.FallbackType,wd.core.snap.Index.Fallback={},wd.core.snap.Index.prototype.compare=goog.abstractMethod,wd.core.snap.Index.prototype.isDefinedOn=goog.abstractMethod,wd.core.snap.Index.prototype.getCompare=function(){return goog.bind(this.compare,this)},wd.core.snap.Index.prototype.indexedValueChanged=function(e,t){var o=new wd.core.snap.NamedNode(wd.core.util.MIN_NAME,e),r=new wd.core.snap.NamedNode(wd.core.util.MIN_NAME,t);return 0!==this.compare(o,r)},wd.core.snap.Index.prototype.minPost=function(){return wd.core.snap.NamedNode.MIN},wd.core.snap.Index.prototype.maxPost=goog.abstractMethod,wd.core.snap.Index.prototype.makePost=goog.abstractMethod,wd.core.snap.Index.prototype.toString=goog.abstractMethod,wd.core.snap.SubKeyIndex=function(e){wd.core.snap.Index.call(this),this.indexKey_=e},goog.inherits(wd.core.snap.SubKeyIndex,wd.core.snap.Index),wd.core.snap.SubKeyIndex.prototype.extractChild=function(e){return e.getImmediateChild(this.indexKey_)},wd.core.snap.SubKeyIndex.prototype.isDefinedOn=function(e){return!e.getImmediateChild(this.indexKey_).isEmpty()},wd.core.snap.SubKeyIndex.prototype.compare=function(e,t){var o=this.extractChild(e.node),r=this.extractChild(t.node),n=o.compareTo(r);return 0===n?wd.core.util.nameCompare(e.name,t.name):n},wd.core.snap.SubKeyIndex.prototype.makePost=function(e,t){var o=wd.core.snap.NodeFromJSON(e),r=wd.core.snap.EMPTY_NODE.updateImmediateChild(this.indexKey_,o);return new wd.core.snap.NamedNode(t,r)},wd.core.snap.SubKeyIndex.prototype.maxPost=function(){var e=wd.core.snap.EMPTY_NODE.updateImmediateChild(this.indexKey_,wd.core.snap.MAX_NODE);return new wd.core.snap.NamedNode(wd.core.util.MAX_NAME,e)},wd.core.snap.SubKeyIndex.prototype.toString=function(){return this.indexKey_},wd.core.snap.PriorityIndex_=function(){wd.core.snap.Index.call(this)},goog.inherits(wd.core.snap.PriorityIndex_,wd.core.snap.Index),wd.core.snap.PriorityIndex_.prototype.compare=function(e,t){var o=e.node.getPriority(),r=t.node.getPriority(),n=o.compareTo(r);return 0===n?wd.core.util.nameCompare(e.name,t.name):n},wd.core.snap.PriorityIndex_.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},wd.core.snap.PriorityIndex_.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},wd.core.snap.PriorityIndex_.prototype.minPost=function(){return wd.core.snap.NamedNode.MIN},wd.core.snap.PriorityIndex_.prototype.maxPost=function(){return new wd.core.snap.NamedNode(wd.core.util.MAX_NAME,new wd.core.snap.LeafNode("[PRIORITY-POST]",wd.core.snap.MAX_NODE))},wd.core.snap.PriorityIndex_.prototype.makePost=function(e,t){var o=wd.core.snap.NodeFromJSON(e);return new wd.core.snap.NamedNode(t,new wd.core.snap.LeafNode("[PRIORITY-POST]",o))},wd.core.snap.PriorityIndex_.prototype.toString=function(){return".priority"},wd.core.snap.PriorityIndex=new wd.core.snap.PriorityIndex_,wd.core.snap.KeyIndex_=function(){wd.core.snap.Index.call(this)},goog.inherits(wd.core.snap.KeyIndex_,wd.core.snap.Index),wd.core.snap.KeyIndex_.prototype.compare=function(e,t){return wd.core.util.nameCompare(e.name,t.name)},wd.core.snap.KeyIndex_.prototype.isDefinedOn=function(e){throw wd.core.util.assertionError("KeyIndex.isDefinedOn not expected to be called.")},wd.core.snap.KeyIndex_.prototype.indexedValueChanged=function(e,t){return!1},wd.core.snap.KeyIndex_.prototype.minPost=function(){return wd.core.snap.NamedNode.MIN},wd.core.snap.KeyIndex_.prototype.maxPost=function(){return new wd.core.snap.NamedNode(wd.core.util.MAX_NAME,wd.core.snap.EMPTY_NODE)},wd.core.snap.KeyIndex_.prototype.makePost=function(e,t){return wd.core.util.assert(goog.isString(e),"KeyIndex indexValue must always be a string."),new wd.core.snap.NamedNode(e,wd.core.snap.EMPTY_NODE)},wd.core.snap.KeyIndex_.prototype.toString=function(){return".key"},wd.core.snap.KeyIndex=new wd.core.snap.KeyIndex_,wd.core.snap.ValueIndex_=function(){wd.core.snap.Index.call(this)},goog.inherits(wd.core.snap.ValueIndex_,wd.core.snap.Index),wd.core.snap.ValueIndex_.prototype.compare=function(e,t){var o=e.node.compareTo(t.node);return 0===o?wd.core.util.nameCompare(e.name,t.name):o},wd.core.snap.ValueIndex_.prototype.isDefinedOn=function(e){return!0},wd.core.snap.ValueIndex_.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},wd.core.snap.ValueIndex_.prototype.minPost=function(){return wd.core.snap.NamedNode.MIN},wd.core.snap.ValueIndex_.prototype.maxPost=function(){return wd.core.snap.NamedNode.MAX},wd.core.snap.ValueIndex_.prototype.makePost=function(e,t){var o=wd.core.snap.NodeFromJSON(e);return new wd.core.snap.NamedNode(t,o)},wd.core.snap.ValueIndex_.prototype.toString=function(){return".value"},wd.core.snap.ValueIndex=new wd.core.snap.ValueIndex_,goog.provide("wd.core.snap.Node"),goog.provide("wd.core.snap.NamedNode"),wd.core.snap.Node=function(){},wd.core.snap.Node.prototype.isLeafNode,wd.core.snap.Node.prototype.getPriority,wd.core.snap.Node.prototype.updatePriority,wd.core.snap.Node.prototype.getImmediateChild,wd.core.snap.Node.prototype.getChild,wd.core.snap.Node.prototype.getPredecessorChildName,wd.core.snap.Node.prototype.updateImmediateChild,wd.core.snap.Node.prototype.updateChild,wd.core.snap.Node.prototype.hasChild,wd.core.snap.Node.prototype.isEmpty,wd.core.snap.Node.prototype.numChildren,wd.core.snap.Node.prototype.val,wd.core.snap.Node.prototype.hash,wd.core.snap.Node.prototype.compareTo,wd.core.snap.Node.prototype.equals,wd.core.snap.Node.prototype.withIndex,wd.core.snap.Node.prototype.isIndexed,wd.core.snap.NamedNode=function(e,t){this.name=e,this.node=t},wd.core.snap.NamedNode.Wrap=function(e,t){return new wd.core.snap.NamedNode(e,t)},goog.provide("wd.core.snap.IndexMap"),goog.require("wd.core.snap.Index"),goog.require("wd.core.util"),wd.core.snap.IndexMap=function(e,t){this.indexes_=e,this.indexSet_=t},wd.core.snap.IndexMap.prototype.get=function(e){var t=wd.util.obj.get(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t===wd.core.snap.Index.Fallback?null:t},wd.core.snap.IndexMap.prototype.hasIndex=function(e){return goog.object.contains(this.indexSet_,e.toString())},wd.core.snap.IndexMap.prototype.addIndex=function(e,t){wd.core.util.assert(e!==wd.core.snap.KeyIndex,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var o=[],r=!1,n=t.getIterator(wd.core.snap.NamedNode.Wrap),i=n.getNext();i;)r=r||e.isDefinedOn(i.node),o.push(i),i=n.getNext();var a;a=r?wd.core.snap.buildChildSet(o,e.getCompare()):wd.core.snap.Index.Fallback;var s=e.toString(),d=goog.object.clone(this.indexSet_);d[s]=e;var l=goog.object.clone(this.indexes_);return l[s]=a,new wd.core.snap.IndexMap(l,d)},wd.core.snap.IndexMap.prototype.addToIndexes=function(e,t){var o=this,r=goog.object.map(this.indexes_,function(r,n){var i=wd.util.obj.get(o.indexSet_,n);if(wd.core.util.assert(i,"Missing index implementation for "+n),r===wd.core.snap.Index.Fallback){if(i.isDefinedOn(e.node)){for(var a=[],s=t.getIterator(wd.core.snap.NamedNode.Wrap),d=s.getNext();d;)d.name!=e.name&&a.push(d),d=s.getNext();return a.push(e),wd.core.snap.buildChildSet(a,i.getCompare())}return wd.core.snap.Index.Fallback}var l=t.get(e.name),g=r;return l&&(g=g.remove(new wd.core.snap.NamedNode(e.name,l))),g.insert(e,e.node)});return new wd.core.snap.IndexMap(r,this.indexSet_)},wd.core.snap.IndexMap.prototype.removeFromIndexes=function(e,t){var o=goog.object.map(this.indexes_,function(o){if(o===wd.core.snap.Index.Fallback)return o;var r=t.get(e.name);return r?o.remove(new wd.core.snap.NamedNode(e.name,r)):o});return new wd.core.snap.IndexMap(o,this.indexSet_)},wd.core.snap.IndexMap.Default=new wd.core.snap.IndexMap({".priority":wd.core.snap.Index.Fallback},{".priority":wd.core.snap.PriorityIndex}),goog.provide("wd.core.snap.LeafNode"),goog.require("wd.core.snap.Node"),goog.require("wd.core.util"),wd.core.snap.LeafNode=function(e,t){this.value_=e,wd.core.util.assert(goog.isDef(this.value_)&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),this.priorityNode_=t||wd.core.snap.EMPTY_NODE,wd.core.snap.validatePriorityNode(this.priorityNode_),this.lazyHash_=null},wd.core.snap.LeafNode.prototype.isLeafNode=function(){return!0},wd.core.snap.LeafNode.prototype.getPriority=function(){return this.priorityNode_},wd.core.snap.LeafNode.prototype.updatePriority=function(e){return new wd.core.snap.LeafNode(this.value_,e)},wd.core.snap.LeafNode.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:wd.core.snap.EMPTY_NODE},wd.core.snap.LeafNode.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:wd.core.snap.EMPTY_NODE},wd.core.snap.LeafNode.prototype.hasChild=function(){return!1},wd.core.snap.LeafNode.prototype.getPredecessorChildName=function(e,t){return null},wd.core.snap.LeafNode.prototype.updateImmediateChild=function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:wd.core.snap.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},wd.core.snap.LeafNode.prototype.updateChild=function(e,t){var o=e.getFront();return null===o?t:t.isEmpty()&&".priority"!==o?this:(wd.core.util.assert(".priority"!==o||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(o,wd.core.snap.EMPTY_NODE.updateChild(e.popFront(),t)))},wd.core.snap.LeafNode.prototype.isEmpty=function(){return!1},wd.core.snap.LeafNode.prototype.numChildren=function(){return 0},wd.core.snap.LeafNode.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},wd.core.snap.LeafNode.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+wd.core.snap.priorityHashText(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?wd.core.util.doubleToIEEE754String(this.value_):this.value_,this.lazyHash_=wd.core.util.sha1(e)}return this.lazyHash_},wd.core.snap.LeafNode.prototype.getValue=function(){return this.value_},wd.core.snap.LeafNode.prototype.compareTo=function(e){return e===wd.core.snap.EMPTY_NODE?1:e instanceof wd.core.snap.ChildrenNode?-1:(wd.core.util.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},wd.core.snap.LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"],wd.core.snap.LeafNode.prototype.compareToLeafNode_=function(e){var t=typeof e.value_,o=typeof this.value_,r=goog.array.indexOf(wd.core.snap.LeafNode.VALUE_TYPE_ORDER,t),n=goog.array.indexOf(wd.core.snap.LeafNode.VALUE_TYPE_ORDER,o);return wd.core.util.assert(r>=0,"Unknown leaf type: "+t),wd.core.util.assert(n>=0,"Unknown leaf type: "+o),r===n?"object"===o?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:n-r},wd.core.snap.LeafNode.prototype.withIndex=function(){return this},wd.core.snap.LeafNode.prototype.isIndexed=function(){return!0},wd.core.snap.LeafNode.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},goog.DEBUG&&(wd.core.snap.LeafNode.prototype.toString=function(){return wd.util.json.stringify(this.val(!0))}),goog.provide("wd.core.snap.ChildrenNode"),goog.require("wd.core.snap.IndexMap"),goog.require("wd.core.snap.LeafNode"),goog.require("wd.core.snap.NamedNode"),goog.require("wd.core.snap.Node"),goog.require("wd.core.snap.PriorityIndex"),goog.require("wd.core.snap.comparators"),goog.require("wd.core.util"),goog.require("wd.core.util.SortedMap"),wd.core.snap.ChildrenNode=function(e,t,o){this.children_=e,this.priorityNode_=t,this.priorityNode_&&wd.core.snap.validatePriorityNode(this.priorityNode_),e.isEmpty()&&wd.core.util.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority"),this.indexMap_=o,this.lazyHash_=null},wd.core.snap.ChildrenNode.prototype.isLeafNode=function(){return!1},wd.core.snap.ChildrenNode.prototype.getPriority=function(){return this.priorityNode_||wd.core.snap.EMPTY_NODE},wd.core.snap.ChildrenNode.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new wd.core.snap.ChildrenNode(this.children_,e,this.indexMap_)},wd.core.snap.ChildrenNode.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?wd.core.snap.EMPTY_NODE:t},wd.core.snap.ChildrenNode.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},wd.core.snap.ChildrenNode.prototype.hasChild=function(e){return null!==this.children_.get(e)},wd.core.snap.ChildrenNode.prototype.updateImmediateChild=function(e,t){if(wd.core.util.assert(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var o,r,n,i=new wd.core.snap.NamedNode(e,t);return t.isEmpty()?(o=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_)),n=o.isEmpty()?wd.core.snap.EMPTY_NODE:this.priorityNode_,new wd.core.snap.ChildrenNode(o,n,r)},wd.core.snap.ChildrenNode.prototype.updateChild=function(e,t){var o=e.getFront();if(null===o)return t;wd.core.util.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(o).updateChild(e.popFront(),t);return this.updateImmediateChild(o,r)},wd.core.snap.ChildrenNode.prototype.isEmpty=function(){return this.children_.isEmpty()},wd.core.snap.ChildrenNode.prototype.numChildren=function(){return this.children_.count()},wd.core.snap.ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,wd.core.snap.ChildrenNode.prototype.val=function(e){if(this.isEmpty())return null;var t={},o=0,r=0,n=!0;if(this.forEachChild(wd.core.snap.PriorityIndex,function(i,a){t[i]=a.val(e),o++,n&&wd.core.snap.ChildrenNode.INTEGER_REGEXP_.test(i)?r=Math.max(r,Number(i)):n=!1}),!e&&n&&2*o>r){var i=[];for(var a in t)i[a]=t[a];return i}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},wd.core.snap.ChildrenNode.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+wd.core.snap.priorityHashText(this.getPriority().val())+":"),this.forEachChild(wd.core.snap.PriorityIndex,function(t,o){var r=o.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":wd.core.util.sha1(e)}return this.lazyHash_},wd.core.snap.ChildrenNode.prototype.getPredecessorChildName=function(e,t,o){var r=this.resolveIndex_(o);if(r){var n=r.getPredecessorKey(new wd.core.snap.NamedNode(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)},wd.core.snap.ChildrenNode.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var o=t.minKey();return o&&o.name}return this.children_.minKey()},wd.core.snap.ChildrenNode.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new wd.core.snap.NamedNode(t,this.children_.get(t)):null},wd.core.snap.ChildrenNode.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var o=t.maxKey();return o&&o.name}return this.children_.maxKey()},wd.core.snap.ChildrenNode.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new wd.core.snap.NamedNode(t,this.children_.get(t)):null},wd.core.snap.ChildrenNode.prototype.forEachChild=function(e,t){var o=this.resolveIndex_(e);return o?o.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},wd.core.snap.ChildrenNode.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},wd.core.snap.ChildrenNode.prototype.getIteratorFrom=function(e,t){var o=this.resolveIndex_(t);if(o)return o.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,wd.core.snap.NamedNode.Wrap),n=r.peek();null!=n&&t.compare(n,e)<0;)r.getNext(),n=r.peek();return r},wd.core.snap.ChildrenNode.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},wd.core.snap.ChildrenNode.prototype.getReverseIteratorFrom=function(e,t){var o=this.resolveIndex_(t);if(o)return o.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,wd.core.snap.NamedNode.Wrap),n=r.peek();null!=n&&t.compare(n,e)>0;)r.getNext(),n=r.peek();return r},wd.core.snap.ChildrenNode.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===wd.core.snap.MAX_NODE?-1:0},wd.core.snap.ChildrenNode.prototype.withIndex=function(e){if(e===wd.core.snap.KeyIndex||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new wd.core.snap.ChildrenNode(this.children_,this.priorityNode_,t)},wd.core.snap.ChildrenNode.prototype.isIndexed=function(e){return e===wd.core.snap.KeyIndex||this.indexMap_.hasIndex(e)},wd.core.snap.ChildrenNode.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var o=this.getIterator(wd.core.snap.PriorityIndex),r=t.getIterator(wd.core.snap.PriorityIndex),n=o.getNext(),i=r.getNext();n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=o.getNext(),i=r.getNext()}return null===n&&null===i}return!1}return!1},wd.core.snap.ChildrenNode.prototype.resolveIndex_=function(e){return e===wd.core.snap.KeyIndex?null:this.indexMap_.get(e.toString())},goog.DEBUG&&(wd.core.snap.ChildrenNode.prototype.toString=function(){return wd.util.json.stringify(this.val(!0))}),goog.provide("wd.core.snap"),goog.require("wd.core.snap.ChildrenNode"),goog.require("wd.core.snap.IndexMap"),goog.require("wd.core.snap.LeafNode"),goog.require("wd.core.util");var USE_HINZE=!0;wd.core.snap.NodeFromJSON=function(e,t){if(null===e)return wd.core.snap.EMPTY_NODE;var o=null;if("object"==typeof e&&".priority"in e?o=e[".priority"]:"undefined"!=typeof t&&(o=t),wd.core.util.assert(null===o||"string"==typeof o||"number"==typeof o||"object"==typeof o&&".sv"in o,"Invalid priority type found: "+typeof o),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){var r=e;return new wd.core.snap.LeafNode(r,wd.core.snap.NodeFromJSON(o))}if(e instanceof Array||!USE_HINZE){var n=wd.core.snap.EMPTY_NODE,i=e;return goog.object.forEach(i,function(e,t){if(wd.util.obj.contains(i,t)&&"."!==t.substring(0,1)){var o=wd.core.snap.NodeFromJSON(e);(o.isLeafNode()||!o.isEmpty())&&(n=n.updateImmediateChild(t,o))}}),n.updatePriority(wd.core.snap.NodeFromJSON(o))}var a=[],s=!1,d=e;if(wd.util.obj.foreach(d,function(e,t){if("string"!=typeof e||"."!==e.substring(0,1)){var o=wd.core.snap.NodeFromJSON(d[e]);o.isEmpty()||(s=s||!o.getPriority().isEmpty(),a.push(new wd.core.snap.NamedNode(e,o)))}}),0==a.length)return wd.core.snap.EMPTY_NODE;var l=wd.core.snap.buildChildSet(a,wd.core.snap.NAME_ONLY_COMPARATOR,function(e){return e.name},wd.core.snap.NAME_COMPARATOR);if(s){var g=wd.core.snap.buildChildSet(a,wd.core.snap.PriorityIndex.getCompare());return new wd.core.snap.ChildrenNode(l,wd.core.snap.NodeFromJSON(o),new wd.core.snap.IndexMap({".priority":g},{".priority":wd.core.snap.PriorityIndex}))}return new wd.core.snap.ChildrenNode(l,wd.core.snap.NodeFromJSON(o),wd.core.snap.IndexMap.Default)};var LOG_2=Math.log(2);wd.core.snap.Base12Num=function(e){var t=function(e){return parseInt(Math.log(e)/LOG_2,10)},o=function(e){return parseInt(Array(e+1).join("1"),2)};this.count=t(e+1),this.current_=this.count-1;var r=o(this.count);this.bits_=e+1&r},wd.core.snap.Base12Num.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},wd.core.snap.buildChildSet=function(e,t,o,r){e.sort(t);var n=function(t,r){var i=r-t;if(0==i)return null;if(1==i){var a=e[t],s=o?o(a):a;return new wd.LLRBNode(s,a.node,wd.LLRBNode.BLACK,null,null)}var d=parseInt(i/2,10)+t,l=n(t,d),g=n(d+1,r);return a=e[d],s=o?o(a):a,new wd.LLRBNode(s,a.node,wd.LLRBNode.BLACK,l,g)},i=function(t){for(var r=null,i=null,a=e.length,s=function(t,r){var i=a-t,s=a;a-=t;var l=n(i+1,s),g=e[i],u=o?o(g):g;d(new wd.LLRBNode(u,g.node,r,null,l))},d=function(e){r?(r.left=e,r=e):(i=e,r=e)},l=0;l<t.count;++l){var g=t.nextBitIsOne(),u=Math.pow(2,t.count-(l+1));g?s(u,wd.LLRBNode.BLACK):(s(u,wd.LLRBNode.BLACK),s(u,wd.LLRBNode.RED))}return i},a=new wd.core.snap.Base12Num(e.length),s=i(a);return null!==s?new wd.core.util.SortedMap(r||t,s):new wd.core.util.SortedMap(r||t)},wd.core.snap.priorityHashText=function(e){return"number"==typeof e?"number:"+wd.core.util.doubleToIEEE754String(e):"string:"+e},wd.core.snap.validatePriorityNode=function(e){if(e.isLeafNode()){var t=e.val();wd.core.util.assert("string"==typeof t||"number"==typeof t||"object"==typeof t&&wd.util.obj.contains(t,".sv"),"Priority must be a string or number.")}else wd.core.util.assert(e===wd.core.snap.MAX_NODE||e.isEmpty(),"priority of unexpected type.");wd.core.util.assert(e===wd.core.snap.MAX_NODE||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},wd.core.snap.EMPTY_NODE=new wd.core.snap.ChildrenNode(new wd.core.util.SortedMap(wd.core.snap.NAME_COMPARATOR),null,wd.core.snap.IndexMap.Default),wd.core.snap.MAX_NODE_=function(){wd.core.snap.ChildrenNode.call(this,new wd.core.util.SortedMap(wd.core.snap.NAME_COMPARATOR),wd.core.snap.EMPTY_NODE,wd.core.snap.IndexMap.Default)},goog.inherits(wd.core.snap.MAX_NODE_,wd.core.snap.ChildrenNode),wd.core.snap.MAX_NODE_.prototype.compareTo=function(e){return e===this?0:1},wd.core.snap.MAX_NODE_.prototype.equals=function(e){return e===this},wd.core.snap.MAX_NODE_.prototype.getPriority=function(){return this},wd.core.snap.MAX_NODE_.prototype.getImmediateChild=function(e){return wd.core.snap.EMPTY_NODE},wd.core.snap.MAX_NODE_.prototype.isEmpty=function(){return!1},wd.core.snap.MAX_NODE=new wd.core.snap.MAX_NODE_,wd.core.snap.NamedNode.MIN=new wd.core.snap.NamedNode(wd.core.util.MIN_NAME,wd.core.snap.EMPTY_NODE),wd.core.snap.NamedNode.MAX=new wd.core.snap.NamedNode(wd.core.util.MAX_NAME,wd.core.snap.MAX_NODE),goog.provide("wd.core.util.Path"),goog.provide("wd.core.util.ValidationPath"),wd.core.util.Path=goog.defineClass(null,{constructor:function(e,t){if(1==arguments.length){this.pieces_=e.split("/");for(var o=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[o]=this.pieces_[r],o++);this.pieces_.length=o,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t},getFront:function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},getLength:function(){return this.pieces_.length-this.pieceNum_},popFront:function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new wd.core.util.Path(this.pieces_,e)},getBack:function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},toString:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},toUrlEncodedString:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+goog.string.urlEncode(this.pieces_[t]));return e||"/"},slice:function(e){var t=e||0;return this.pieces_.slice(this.pieceNum_+t)},parent:function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],t=this.pieceNum_;t<this.pieces_.length-1;t++)e.push(this.pieces_[t]);return new wd.core.util.Path(e,0)},child:function(e){for(var t=[],o=this.pieceNum_;o<this.pieces_.length;o++)t.push(this.pieces_[o]);if(e instanceof wd.core.util.Path)for(o=e.pieceNum_;o<e.pieces_.length;o++)t.push(e.pieces_[o]);else{var r=e.split("/");for(o=0;o<r.length;o++)r[o].length>0&&t.push(r[o])}return new wd.core.util.Path(t,0)},isEmpty:function(){return this.pieceNum_>=this.pieces_.length},statics:{relativePath:function(e,t){var o=e.getFront(),r=t.getFront();if(null===o)return t;if(o===r)return wd.core.util.Path.relativePath(e.popFront(),t.popFront());throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}},equals:function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,o=e.pieceNum_;t<=this.pieces_.length;t++,o++)if(this.pieces_[t]!==e.pieces_[o])return!1;return!0},contains:function(e){var t=this.pieceNum_,o=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[o])return!1;++t,++o}return!0}}),wd.core.util.Path.Empty=new wd.core.util.Path(""),wd.core.util.ValidationPath=goog.defineClass(null,{constructor:function(e,t){this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length),this.errorPrefix_=t;for(var o=0;o<this.parts_.length;o++)this.byteLength_+=wd.util.utf8.stringLength(this.parts_[o]);this.checkValid_()},statics:{MAX_PATH_DEPTH:32,MAX_PATH_LENGTH_BYTES:768},push:function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=wd.util.utf8.stringLength(e),this.checkValid_()},pop:function(){var e=this.parts_.pop();this.byteLength_-=wd.util.utf8.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},checkValid_:function(){if(this.byteLength_>wd.core.util.ValidationPath.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+wd.core.util.ValidationPath.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>wd.core.util.ValidationPath.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+wd.core.util.ValidationPath.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},toErrorString:function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"}}),goog.provide("wd.util.utf8"),goog.require("wd.core.util"),wd.util.utf8.stringToByteArray=function(e){for(var t=[],o=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n>=55296&&56319>=n){var i=n-55296;r++,wd.core.util.assert(r<e.length,"Surrogate pair missing trail surrogate.");var a=e.charCodeAt(r)-56320;n=65536+(i<<10)+a}128>n?t[o++]=n:2048>n?(t[o++]=n>>6|192,t[o++]=63&n|128):65536>n?(t[o++]=n>>12|224,t[o++]=n>>6&63|128,t[o++]=63&n|128):(t[o++]=n>>18|240,t[o++]=n>>12&63|128,t[o++]=n>>6&63|128,t[o++]=63&n|128)}return t},wd.util.utf8.stringLength=function(e){for(var t=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);128>r?t++:2048>r?t+=2:r>=55296&&56319>=r?(t+=4,o++):t+=3}return t},goog.provide("wd.util.validation"),wd.util.validation.validateArgCount=function(e,t,o,r){var n;if(t>r?n="at least "+t:r>o&&(n=0===o?"none":"no more than "+o),n){var i=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+n+".";throw new Error(i)}},wd.util.validation.errorPrefix=function(e,t,o){var r="";switch(t){case 1:r=o?"first":"First";break;case 2:r=o?"second":"Second";break;case 3:r=o?"third":"Third";break;case 4:r=o?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var n=e+" failed: ";return n+=r+" argument "},wd.util.validation.validateNamespace=function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid wilddog namespace.")},wd.util.validation.validateCallback=function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isFunction(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid function.")},wd.util.validation.validateContextObject=function(e,t,o,r){if(!(r&&!goog.isDef(o)||goog.isObject(o)&&null!==o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid context object.")},goog.provide("wd.core.util.validation"),goog.require("wd.core.util"),goog.require("wd.core.util.Path"),goog.require("wd.core.util.ValidationPath"),goog.require("wd.util.obj"),goog.require("wd.util.utf8"),goog.require("wd.util.validation"),wd.core.util.validation={INVALID_KEY_REGEX_:/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_:/[\[\].#$\u0000-\u001F\u007F]/,MAX_LEAF_SIZE_:10485760,isValidKey:function(e){return goog.isString(e)&&0!==e.length&&!wd.core.util.validation.INVALID_KEY_REGEX_.test(e)},isValidPathString:function(e){return goog.isString(e)&&0!==e.length&&!wd.core.util.validation.INVALID_PATH_REGEX_.test(e)},isValidRootPathString:function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),wd.core.util.validation.isValidPathString(e)},isValidPriority:function(e){return null===e||goog.isString(e)||goog.isNumber(e)&&!wd.core.util.isInvalidJSONNumber(e)||goog.isObject(e)&&wd.util.obj.contains(e,".sv")},validateWilddogDataArg:function(e,t,o,r,n){(!n||goog.isDef(o))&&wd.core.util.validation.validateWilddogData(wd.util.validation.errorPrefix(e,t,n),o,r)},validateWilddogData:function(e,t,o){if(o instanceof wd.core.util.Path&&(o=new wd.core.util.ValidationPath(o,e)),!goog.isDef(t))throw new Error(e+"contains undefined "+o.toErrorString());if(goog.isFunction(t))throw new Error(e+"contains a function "+o.toErrorString()+" with contents: "+t.toString());if(wd.core.util.isInvalidJSONNumber(t))throw new Error(e+"contains "+t.toString()+" "+o.toErrorString());if(goog.isString(t)&&t.length>wd.core.util.validation.MAX_LEAF_SIZE_/3&&wd.util.utf8.stringLength(t)>wd.core.util.validation.MAX_LEAF_SIZE_)throw new Error(e+"contains a string greater than "+wd.core.util.validation.MAX_LEAF_SIZE_+" utf8 bytes "+o.toErrorString()+" ('"+t.substring(0,50)+"...')");if(goog.isObject(t)){var r=!1,n=!1;if(wd.util.obj.foreach(t,function(t,i){if(".value"===t)r=!0;else if(".priority"!==t&&".sv"!==t&&(n=!0,!wd.core.util.validation.isValidKey(t)))throw new Error(e+" contains an invalid key ("+t+") "+o.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');
o.push(t),wd.core.util.validation.validateWilddogData(e,i,o),o.pop()}),r&&n)throw new Error(e+' contains ".value" child '+o.toErrorString()+" in addition to actual children.")}},validateWilddogMergeDataArg:function(e,t,o,r,n){if(!n||goog.isDef(o)){if(!goog.isObject(o)||goog.isArray(o))throw new Error(wd.util.validation.errorPrefix(e,t,n)+" must be an Object containing the children to replace.");if(wd.util.obj.contains(o,".value"))throw new Error(wd.util.validation.errorPrefix(e,t,n)+' must not contain ".value".  To overwrite with a leaf value, just use .set() instead.');wd.core.util.validation.validateWilddogDataArg(e,t,o,r,n)}},validatePriority:function(e,t,o,r){if(!r||goog.isDef(o)){if(wd.core.util.isInvalidJSONNumber(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"is "+o.toString()+", but must be a valid Wilddog priority (a string, finite number, server value, or null).");if(!wd.core.util.validation.isValidPriority(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid Wilddog priority (a string, finite number, server value, or null).")}},validateEventType:function(e,t,o,r){if(!r||goog.isDef(o))switch(o){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(wd.util.validation.errorPrefix(e,t,r)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},validateKey:function(e,t,o,r){if((!r||goog.isDef(o))&&!wd.core.util.validation.isValidKey(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+'was an invalid key: "'+o+'".  Wilddog keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},validatePathString:function(e,t,o,r){if((!r||goog.isDef(o))&&!wd.core.util.validation.isValidPathString(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+'was an invalid path: "'+o+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},validateRootPathString:function(e,t,o,r){o&&(o=o.replace(/^\/*\.info(\/|$)/,"/")),wd.core.util.validation.validatePathString(e,t,o,r)},validateWritablePath:function(e,t){if(".info"===t.getFront())throw new Error(e+" failed: Can't modify data under /.info/")},validateUrl:function(e,t,o){var r=o.path.toString();if(!goog.isString(o.repoInfo.host)||0===o.repoInfo.host.length||!wd.core.util.validation.isValidKey(o.repoInfo.namespace)||0!==r.length&&!wd.core.util.validation.isValidRootPathString(r))throw new Error(wd.util.validation.errorPrefix(e,t,!1)+'must be a valid wilddog URL and the path can\'t contain ".", "#", "$", "[", or "]".')},validateCredential:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid credential (a string).")},validateBoolean:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isBoolean(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a boolean.")},validateString:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid string.")},validateObject:function(e,t,o,r){if(!(r&&!goog.isDef(o)||goog.isObject(o)&&null!==o))throw new Error(wd.util.validation.errorPrefix(e,t,r)+"must be a valid object.")},validateObjectContainsKey:function(e,t,o,r,n,i){if(!n||goog.isDef(o)){if(!goog.isObject(o)||null===o||!wd.util.obj.contains(o,r))throw new Error(wd.util.validation.errorPrefix(e,t,n)+'must contain the key "'+r+'"');if(i){var a=wd.util.obj.get(o,r);if("string"===i&&!goog.isString(a)||"boolean"===i&&!goog.isBoolean(a)||"function"===i&&!goog.isFunction(a)||"object"===i&&!goog.isObject(a))throw new Error(wd.util.validation.errorPrefix(e,t,n)+'must contain the key "'+r+'" with type "'+i+'"')}}}},goog.provide("wd.api.DataSnapshot"),goog.require("wd.core.snap"),goog.require("wd.core.util.SortedMap"),goog.require("wd.core.util.validation"),wd.api.DataSnapshot=function(e,t,o){this.node_=e,this.query_=t,this.index_=o},wd.api.DataSnapshot.prototype.val=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.val",0,0,arguments.length),this.node_.val()},goog.exportProperty(wd.api.DataSnapshot.prototype,"val",wd.api.DataSnapshot.prototype.val),wd.api.DataSnapshot.prototype.exportVal=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},goog.exportProperty(wd.api.DataSnapshot.prototype,"exportVal",wd.api.DataSnapshot.prototype.exportVal),wd.api.DataSnapshot.prototype.exists=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},goog.exportProperty(wd.api.DataSnapshot.prototype,"exists",wd.api.DataSnapshot.prototype.exists),wd.api.DataSnapshot.prototype.child=function(e){wd.util.validation.validateArgCount("Wilddog.DataSnapshot.child",0,1,arguments.length),goog.isNumber(e)&&(e=String(e)),wd.core.util.validation.validatePathString("Wilddog.DataSnapshot.child",1,e,!1);var t=new wd.core.util.Path(e),o=this.query_.child(t);return new wd.api.DataSnapshot(this.node_.getChild(t),o,wd.core.snap.PriorityIndex)},goog.exportProperty(wd.api.DataSnapshot.prototype,"child",wd.api.DataSnapshot.prototype.child),wd.api.DataSnapshot.prototype.hasChild=function(e){wd.util.validation.validateArgCount("Wilddog.DataSnapshot.hasChild",1,1,arguments.length),wd.core.util.validation.validatePathString("Wilddog.DataSnapshot.hasChild",1,e,!1);var t=new wd.core.util.Path(e);return!this.node_.getChild(t).isEmpty()},goog.exportProperty(wd.api.DataSnapshot.prototype,"hasChild",wd.api.DataSnapshot.prototype.hasChild),wd.api.DataSnapshot.prototype.getPriority=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},goog.exportProperty(wd.api.DataSnapshot.prototype,"getPriority",wd.api.DataSnapshot.prototype.getPriority),wd.api.DataSnapshot.prototype.forEach=function(e){if(wd.util.validation.validateArgCount("Wilddog.DataSnapshot.forEach",1,1,arguments.length),wd.util.validation.validateCallback("Wilddog.DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var t=this.node_,o=this;return!!t.forEachChild(this.index_,function(t,r){return e(new wd.api.DataSnapshot(r,o.query_.child(t),wd.core.snap.PriorityIndex))})},goog.exportProperty(wd.api.DataSnapshot.prototype,"forEach",wd.api.DataSnapshot.prototype.forEach),wd.api.DataSnapshot.prototype.hasChildren=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.hasChildren",0,0,arguments.length),this.node_.isLeafNode()?!1:!this.node_.isEmpty()},goog.exportProperty(wd.api.DataSnapshot.prototype,"hasChildren",wd.api.DataSnapshot.prototype.hasChildren),wd.api.DataSnapshot.prototype.name=function(){return wd.core.util.warn("Wilddog.DataSnapshot.name() being deprecated. Please use Wilddog.DataSnapshot.key() instead."),wd.util.validation.validateArgCount("Wilddog.DataSnapshot.name",0,0,arguments.length),this.key()},goog.exportProperty(wd.api.DataSnapshot.prototype,"name",wd.api.DataSnapshot.prototype.name),wd.api.DataSnapshot.prototype.key=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.key",0,0,arguments.length),this.query_.key()},goog.exportProperty(wd.api.DataSnapshot.prototype,"key",wd.api.DataSnapshot.prototype.key),wd.api.DataSnapshot.prototype.numChildren=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},goog.exportProperty(wd.api.DataSnapshot.prototype,"numChildren",wd.api.DataSnapshot.prototype.numChildren),wd.api.DataSnapshot.prototype.ref=function(){return wd.util.validation.validateArgCount("Wilddog.DataSnapshot.ref",0,0,arguments.length),this.query_},goog.exportProperty(wd.api.DataSnapshot.prototype,"ref",wd.api.DataSnapshot.prototype.ref),goog.provide("wd.login.Constants"),wd.login.Constants={SESSION_PERSISTENCE_KEY_PREFIX:"session",DEFAULT_SERVER_HOST:"auth.wilddog.com",SERVER_HOST:"auth.wilddog.com",API_VERSION:"v1",POPUP_PATH_TO_CHANNEL:"/auth/channel",POPUP_RELAY_FRAME_NAME:"__winchan_relay_frame",POPUP_CLOSE_CMD:"die",JSONP_CALLBACK_NAMESPACE:"__wilddog_auth_jsonp",REDIR_REQUEST_ID_KEY:"redirect_request_id",REDIR_REQUEST_COMPLETION_KEY:"__wilddog_request_key",REDIR_CLIENT_OPTIONS_KEY:"redirect_client_options",INTERNAL_REDIRECT_SENTINAL_PATH:"/blank/page.html",CLIENT_OPTION_SESSION_PERSISTENCE:"remember",CLIENT_OPTION_REDIRECT_TO:"redirectTo"},goog.provide("wd.login.RequestInfo"),goog.require("wd.login.Constants"),wd.login.RequestInfo=function(e,t,o){this.clientOptions=e||{},this.transportOptions=t||{},this.serverParams=o||{},this.clientOptions[wd.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]||(this.clientOptions[wd.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="default")},wd.login.RequestInfo.CLIENT_OPTIONS=[wd.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE,wd.login.Constants.CLIENT_OPTION_REDIRECT_TO],wd.login.RequestInfo.fromParams=function(e){var t={},o={};return wd.util.obj.foreach(e||{},function(e,r){goog.array.contains(wd.login.RequestInfo.CLIENT_OPTIONS,e)?t[e]=r:o[e]=r}),new wd.login.RequestInfo(t,{},o)},goog.provide("wd.login.transports.util"),goog.require("wd.login.Constants"),goog.require("wd.util"),wd.login.transports.util.findRelay=function(){var e,t=(window.location,window.opener.frames);for(e=t.length-1;e>=0;e--)try{if(t[e].location.protocol===window.location.protocol&&t[e].location.host===window.location.host&&t[e].name===wd.login.Constants.POPUP_RELAY_FRAME_NAME)return t[e]}catch(o){}return null},wd.login.transports.util.addListener=function(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1)},wd.login.transports.util.removeListener=function(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1)},wd.login.transports.util.extractOrigin=function(e){/^https?:\/\//.test(e)||(e=window.location.href);var t=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(e);return t?t[1]:e},wd.login.transports.util.extractRedirectCompletionHash=function(e){var t="";try{e=e.replace("#","");var o=wd.util.querystringDecode(e);o&&wd.util.obj.contains(o,wd.login.Constants.REDIR_REQUEST_COMPLETION_KEY)&&(t=wd.util.obj.get(o,wd.login.Constants.REDIR_REQUEST_COMPLETION_KEY))}catch(r){}return t},wd.login.transports.util.replaceRedirectCompletionHash=function(){try{var e=new RegExp("&"+wd.login.Constants.REDIR_REQUEST_COMPLETION_KEY+"=([a-zA-z0-9]*)");document.location.hash=document.location.hash.replace(e,"")}catch(t){}},wd.login.transports.util.getBaseUrl=function(){var e=wd.core.util.parseURL(wd.login.Constants.SERVER_HOST);return e.scheme+"://"+e.host+"/"+wd.login.Constants.API_VERSION},wd.login.transports.util.getPopupChannelUrl=function(e){return wd.login.transports.util.getBaseUrl()+"/"+e+wd.login.Constants.POPUP_PATH_TO_CHANNEL},goog.provide("wd.login.Transport"),wd.login.Transport=function(e){},wd.login.Transport.isAvailable=function(){},wd.login.Transport.prototype.open=function(e,t,o){},wd.login.Transport.prototype.classification=function(){},goog.provide("wd.login.transports.Redirect"),goog.require("wd.constants"),goog.require("wd.core.storage"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.util"),goog.require("wd.util"),wd.login.transports.Redirect=function(e){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=e},wd.login.transports.Redirect.prototype.open=function(e,t,o){wd.core.storage.SessionStorage.set(wd.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),wd.core.storage.SessionStorage.set(wd.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),t.requestId=this.requestId_,t.redirectTo=t.redirectTo||window.location.href,e+=(/\?/.test(e)?"":"?")+wd.util.querystring(t),window.location=e},wd.login.transports.Redirect.isAvailable=function(){return!NODE_CLIENT&&!wd.login.util.environment.isLocalFile()&&!wd.login.util.environment.isMobileCordova()},wd.login.transports.Redirect.prototype.classification=function(){return"redirect"},goog.provide("wd.login.util.environment"),wd.login.util.environment.isMobileWrapper=function(){return wd.login.util.environment.isMobileCordova()||wd.login.util.environment.isMobileWindows()||wd.login.util.environment.isIosWebview()},wd.login.util.environment.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(navigator.userAgent)},wd.login.util.environment.isMobileWindows=function(){return"undefined"!=typeof navigator&&(!!navigator.userAgent.match(/Windows Phone/)||!!window.Windows&&/^ms-appx:/.test(location.href))},wd.login.util.environment.isMobileFirefox=function(){return"undefined"!=typeof navigator&&(-1!==navigator.userAgent.indexOf("Fennec/")||-1!==navigator.userAgent.indexOf("Firefox/")&&-1!==navigator.userAgent.indexOf("Android"))},wd.login.util.environment.isIosWebview=function(){return"undefined"!=typeof navigator&&"undefined"!=typeof window&&!!(navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)||navigator.userAgent.match(/CriOS/)||navigator.userAgent.match(/Twitter for iPhone/)||navigator.userAgent.match(/FBAN\/FBIOS/)||window.navigator.standalone)},wd.login.util.environment.isHeadlessBrowser=function(){return"undefined"!=typeof navigator&&!!navigator.userAgent.match(/PhantomJS/)},wd.login.util.environment.isLocalFile=function(){return"undefined"!=typeof location&&/^file:\//.test(location.href)},wd.login.util.environment.isIE=function(){return"undefined"!=typeof navigator&&!(!navigator.userAgent.match(/MSIE/)&&!navigator.userAgent.match(/Trident/))},wd.login.util.environment.isModernIE=function(){if("undefined"==typeof navigator)return!1;var e,t=navigator.userAgent;if("Microsoft Internet Explorer"===navigator.appName){if(e=t.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/),e&&e.length>1)return parseFloat(e[1])>=8}else if(t.indexOf("Trident")>-1&&(e=t.match(/rv:([0-9]{2,2}[\.0-9]{0,})/),e&&e.length>1))return parseFloat(e[1])>=8;return!1},goog.provide("wd.login.Errors");var errors={NETWORK_ERROR:"Unable to contact the Wilddog server.",SERVER_ERROR:"An unknown server error occurred.",TRANSPORT_UNAVAILABLE:"There are no login transports available for the requested method.",REQUEST_INTERRUPTED:"The browser redirected the page before the login request could complete.",USER_CANCELLED:"The user cancelled authentication."};wd.login.Errors.get=function(e){var t=wd.util.obj.get(errors,e),o=new Error(t,e);return o.code=e,o},goog.provide("wd.login.transports.NodeHttp"),goog.require("wd.login.Constants"),goog.require("wd.login.Errors"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.util"),goog.require("wd.login.util.environment"),goog.require("wd.util"),goog.require("wd.util.json"),wd.login.transports.NodeHttp=function(e){e.method||(e.method="GET"),e.headers||(e.headers={}),e.headers.content_type||(e.headers.content_type="application/json"),e.headers.content_type=e.headers.content_type.toLowerCase(),this.options=e},wd.login.transports.NodeHttp.prototype.open=function(e,t,o){var r,n=wd.core.util.parseURL(e),i="http"===n.scheme?require("http"):require("https"),a=this.options.method,s={Accept:"application/json;text/plain"};goog.object.extend(s,this.options.headers);var d={host:n.host.split(":")[0],port:n.port,path:n.pathString,method:this.options.method.toUpperCase()};if("GET"===a)d.path+=(/\?/.test(d.path)?"":"?")+wd.util.querystring(t),r=null;else{var l=this.options.headers.content_type;"application/json"===l&&(r=wd.util.json.stringify(t)),"application/x-www-form-urlencoded"===l&&(r=wd.util.querystring(t)),s["Content-Length"]=Buffer.byteLength(r,"utf8")}d.headers=s;var g=i.request(d,function(e){var t="";e.setEncoding("utf8"),e.on("data",function(e){t+=e}),e.on("end",function(){try{t=wd.util.json.eval(t+"")}catch(e){}o&&(o(null,t),o=null)})});"GET"!==a&&g.write(r),g.on("error",function(e){o(e&&e.code&&("ENOTFOUND"===e.code||"ENETDOWN"===e.code)?wd.login.Errors.get("NETWORK_ERROR"):wd.login.Errors.get("SERVER_ERROR")),o=null}),g.end()},wd.login.transports.NodeHttp.isAvailable=function(){return NODE_CLIENT},wd.login.transports.NodeHttp.prototype.classification=function(){return"json"},goog.provide("wd.login.SessionManager"),goog.require("wd.core.storage"),goog.require("wd.login.Constants"),goog.require("wd.util.json"),goog.require("wd.util.jwt"),wd.login.SessionManager=function(e,t){this.persistenceKey_=[wd.login.Constants.SESSION_PERSISTENCE_KEY_PREFIX,e.persistenceKey,e.namespace].join(":"),this.stores_=t},wd.login.SessionManager.prototype.set=function(e,t){if(!t){if(!this.stores_.length)throw new Error("wd.login.SessionManager : No storage options available!");t=this.stores_[0]}t.set(this.persistenceKey_,e)},wd.login.SessionManager.prototype.get=function(){var e=goog.array.map(this.stores_,goog.bind(this.getFromStore_,this));return e=goog.array.filter(e,function(e){return null!==e}),goog.array.sort(e,function(e,t){return wd.util.jwt.issuedAtTime(t.token)-wd.util.jwt.issuedAtTime(e.token)}),e.length>0?e.shift():null},wd.login.SessionManager.prototype.getFromStore_=function(e){try{var t=e.get(this.persistenceKey_);if(t&&t.token)return t}catch(o){}return null},wd.login.SessionManager.prototype.clear=function(e){var t=(e?[e]:this.stores_,this);goog.array.forEach(this.stores_,function(e){e.remove(t.persistenceKey_)})},goog.provide("wd.login.transports.Popup"),goog.require("wd.core.util"),goog.require("wd.login.Constants"),goog.require("wd.login.Errors"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.util"),goog.require("wd.login.util.environment"),goog.require("wd.util"),goog.require("wd.util.json"),wd.login.transports.Popup=function(e){(!e.window_features||wd.login.util.environment.isMobileFirefox())&&(e.window_features=void 0),e.window_name||(e.window_name="_blank"),this.options=e},wd.login.transports.Popup.prototype.open=function(e,t,o){function r(e){if(i&&(document.body.removeChild(i),i=void 0),u&&(u=clearInterval(u)),wd.login.transports.util.removeListener(window,"message",n),wd.login.transports.util.removeListener(window,"unload",r),g&&!e)try{g.close()}catch(t){a.postMessage(wd.login.Constants.POPUP_CLOSE_CMD,l)}g=a=void 0}function n(e){if(e.origin===l)try{var t=wd.util.json.eval(e.data);"ready"===t.a?a.postMessage(c,l):"error"===t.a?(r(!1),o&&(o(t.d),o=null)):"response"===t.a&&(r(t.forceKeepWindowOpen),o&&(o(null,t.d),o=null))}catch(n){}}var i,a,s=this,d=wd.login.util.environment.isModernIE();if(!this.options.relay_url)return o(new Error("invalid arguments: origin of url and relay_url must match"));var l=wd.login.transports.util.extractOrigin(e);if(l!==wd.login.transports.util.extractOrigin(s.options.relay_url))return void(o&&setTimeout(function(){o(new Error("invalid arguments: origin of url and relay_url must match"))},0));d&&(i=document.createElement("iframe"),i.setAttribute("src",s.options.relay_url),i.style.display="none",i.setAttribute("name",wd.login.Constants.POPUP_RELAY_FRAME_NAME),document.body.appendChild(i),a=i.contentWindow),e+=(/\?/.test(e)?"":"?")+wd.util.querystring(t);var g=window.open(e,s.options.window_name,s.options.window_features);a||(a=g);var u=setInterval(function(){return g&&g.closed?(r(!1),void(o&&(o(wd.login.Errors.get("USER_CANCELLED")),o=null))):void 0},500),c=wd.util.json.stringify({a:"request",d:t});wd.login.transports.util.addListener(window,"unload",r),wd.login.transports.util.addListener(window,"message",n)},wd.login.transports.Popup.isAvailable=function(){return!NODE_CLIENT&&"postMessage"in window&&!wd.login.util.environment.isLocalFile()&&!wd.login.util.environment.isMobileWrapper()&&!wd.login.util.environment.isHeadlessBrowser()},wd.login.transports.Popup.prototype.classification=function(){return"popup"},goog.provide("wd.login.transports.JSONP"),goog.require("wd.login.Constants"),goog.require("wd.login.Errors"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.util"),goog.require("wd.util"),goog.require("wd.util.json"),wd.login.transports.JSONP=function(e){e.callback_parameter||(e.callback_parameter="callback"),this.options=e,window[wd.login.Constants.JSONP_CALLBACK_NAMESPACE]=window[wd.login.Constants.JSONP_CALLBACK_NAMESPACE]||{}},wd.login.transports.JSONP.prototype.open=function(e,t,o){function r(e){o&&(o(wd.login.Errors.get("REQUEST_INTERRUPTED")),o=null)}function n(){setTimeout(function(){window[wd.login.Constants.JSONP_CALLBACK_NAMESPACE][a]=void 0,goog.object.isEmpty(window[wd.login.Constants.JSONP_CALLBACK_NAMESPACE])&&(window[wd.login.Constants.JSONP_CALLBACK_NAMESPACE]=void 0);try{var e=document.getElementById(a);e&&e.parentNode.removeChild(e)}catch(t){}},1),wd.login.transports.util.removeListener(window,"beforeunload",r)}function i(e){o&&(o(null,e),o=null),n()}var a="fn"+(new Date).getTime()+Math.floor(99999*Math.random());t[this.options.callback_parameter]=wd.login.Constants.JSONP_CALLBACK_NAMESPACE+"."+a,e+=(/\?/.test(e)?"":"?")+wd.util.querystring(t),wd.login.transports.util.addListener(window,"beforeunload",r),window[wd.login.Constants.JSONP_CALLBACK_NAMESPACE][a]=i,this.writeScriptTag_(a,e,o)},wd.login.transports.JSONP.prototype.writeScriptTag_=function(e,t,o){setTimeout(function(){try{var r=document.createElement("script");r.type="text/javascript",r.id=e,r.async=!0,r.src=t,r.onerror=function(){var t=document.getElementById(e);null!==t&&t.parentNode.removeChild(t),o&&o(wd.login.Errors.get("NETWORK_ERROR"))};var n,i=document.getElementsByTagName("head");n=!i||goog.array.isEmpty(i)?document.documentElement:i[0],n.appendChild(r)}catch(a){o&&o(wd.login.Errors.get("NETWORK_ERROR"))}},0)},wd.login.transports.JSONP.isAvailable=function(){return!NODE_CLIENT},wd.login.transports.JSONP.prototype.classification=function(){return"json"},goog.provide("wd.core.util.EventEmitter"),goog.require("wd.core.util"),goog.require("goog.array"),wd.core.util.EventEmitter=goog.defineClass(null,{constructor:function(e){wd.core.util.assert(goog.isArray(e)&&e.length>0,"Requires a non-empty array"),this.allowedEvents_=e,this.listeners_={}},getInitialEvent:goog.abstractMethod,trigger:function(e,t){for(var o=this.listeners_[e]||[],r=0;r<o.length;r++)o[r].callback.apply(o[r].context,Array.prototype.slice.call(arguments,1))},on:function(e,t,o){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:o});var r=this.getInitialEvent(e);r&&t.apply(o,r)},off:function(e,t,o){this.validateEventType_(e);for(var r=this.listeners_[e]||[],n=0;n<r.length;n++)if(r[n].callback===t&&(!o||o===r[n].context))return void r.splice(n,1)},validateEventType_:function(e){wd.core.util.assert(goog.array.find(this.allowedEvents_,function(t){return t===e}),"Unknown event: "+e)}}),goog.provide("wd.login.transports.XHR"),goog.require("wd.login.Constants"),goog.require("wd.login.Errors"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.util"),goog.require("wd.login.util.environment"),goog.require("wd.util"),goog.require("wd.util.json"),wd.login.transports.XHR=function(e){e.method||(e.method="GET"),e.headers||(e.headers={}),e.headers.content_type||(e.headers.content_type="application/json"),e.headers.content_type=e.headers.content_type.toLowerCase(),this.options=e},wd.login.transports.XHR.prototype.open=function(e,t,o){function r(e){o&&(o(wd.login.Errors.get("REQUEST_INTERRUPTED")),o=null)}var n,i=new XMLHttpRequest,a=this.options.method.toUpperCase();if(wd.login.transports.util.addListener(window,"beforeunload",r),i.onreadystatechange=function(){if(o&&4===i.readyState){var e;if(i.status>=200&&i.status<300){try{e=wd.util.json.eval(i.responseText)}catch(t){}o(null,e)}else o(i.status>=500&&i.status<600?wd.login.Errors.get("SERVER_ERROR"):wd.login.Errors.get("NETWORK_ERROR"));o=null,wd.login.transports.util.removeListener(window,"beforeunload",r)}},"GET"===a)e+=(/\?/.test(e)?"":"?")+wd.util.querystring(t),n=null;else{var s=this.options.headers.content_type;"application/json"===s&&(n=wd.util.json.stringify(t)),"application/x-www-form-urlencoded"===s&&(n=wd.util.querystring(t))}i.open(a,e,!0);var d={"X-Requested-With":"XMLHttpRequest",Accept:"application/json;text/plain"};goog.object.extend(d,this.options.headers);for(var l in d)i.setRequestHeader(l,d[l]);i.send(n)},wd.login.transports.XHR.isAvailable=function(){return!(NODE_CLIENT||!window.XMLHttpRequest||wd.login.util.environment.isIE()&&!wd.login.util.environment.isModernIE())},wd.login.transports.XHR.prototype.classification=function(){return"json"},goog.provide("wd.login.transports.CordovaInAppBrowser"),goog.require("wd.core.util"),goog.require("wd.login.Constants"),goog.require("wd.login.Errors"),goog.require("wd.login.RequestInfo"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.XHR"),goog.require("wd.login.transports.util"),goog.require("wd.login.util.environment"),goog.require("wd.util"),goog.require("wd.util.json"),wd.login.transports.CordovaInAppBrowser=function(e){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=e},wd.login.transports.CordovaInAppBrowser.prototype.open=function(e,t,o){function r(e){try{var t=document.createElement("a");return t.href=e,t.host===s.host&&t.pathname===wd.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH}catch(o){}return!1}function n(e){o&&(o(wd.login.Errors.get("USER_CANCELLED")),o=null)}var i,a=this,s=wd.core.util.parseURL(wd.login.Constants.SERVER_HOST);return t.requestId=this.requestId_,t[wd.login.Constants.CLIENT_OPTION_REDIRECT_TO]=s.scheme+"://"+s.host+wd.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH,e+=/\?/.test(e)?"":"?",e+=wd.util.querystring(t),i=window.open(e,"_blank","location=no"),i&&goog.isFunction(i.addEventListener)?(i.addEventListener("loadstart",function(e){if(e&&e.url&&r(e.url)){var t=wd.login.transports.util.extractRedirectCompletionHash(e.url);i.removeEventListener("exit",n),i.close();var s="/auth/session",d=new wd.login.RequestInfo(null,null,{requestId:a.requestId_,requestKey:t});a.options_.requestWithCredential(s,d,o),o=null}}),void i.addEventListener("exit",n)):void o(wd.login.Errors.get("TRANSPORT_UNAVAILABLE"))},wd.login.transports.CordovaInAppBrowser.isAvailable=function(){return!NODE_CLIENT&&wd.login.util.environment.isMobileCordova()},wd.login.transports.CordovaInAppBrowser.prototype.classification=function(){return"redirect"},goog.provide("wd.login.AuthenticationManager"),goog.require("wd.constants"),goog.require("wd.core.storage"),goog.require("wd.core.util"),goog.require("wd.core.util.EventEmitter"),goog.require("wd.login.Constants"),goog.require("wd.login.Errors"),goog.require("wd.login.RequestInfo"),goog.require("wd.login.SessionManager"),goog.require("wd.login.transports.CordovaInAppBrowser"),goog.require("wd.login.transports.JSONP"),goog.require("wd.login.transports.NodeHttp"),goog.require("wd.login.transports.Popup"),goog.require("wd.login.transports.Redirect"),goog.require("wd.login.transports.XHR"),wd.login.AuthenticationManager=goog.defineClass(wd.core.util.EventEmitter,{constructor:function(e,t,o,r){wd.core.util.EventEmitter.call(this,["auth_status"]),this.repoInfo_=e,this.authConn_=t,this.unauthConn_=o,this.onAuthStatus_=r,this.sessionManager_=new wd.login.SessionManager(e,[wd.core.storage.PersistentStorage,wd.core.storage.SessionStorage]),this.authData_=null,this.redirectRestart_=!1,this.resumeSession()}}),wd.login.AuthenticationManager.prototype.getAuth=function(){return this.authData_||null},wd.login.AuthenticationManager.prototype.resumeSession=function(){var e=wd.core.storage.SessionStorage.get(wd.login.Constants.REDIR_REQUEST_ID_KEY),t=this;e&&this.finishOAuthRedirectLogin_();var o=this.sessionManager_.get();o&&o.token?(this.updateAuthStatus_(o),this.authConn_(o.token,function(e,r){t.authOnComplete_(e,r,!1,o.token,o)},function(e,o){t.authOnCancel_("resumeSession()",e,o)})):this.updateAuthStatus_(null)},wd.login.AuthenticationManager.prototype.authenticate=function(e,t,o,r,n){this.repoInfo_.isDemoHost()&&wd.core.util.warn("Wilddog authentication is not supported on demo Wilddogs (*.wilddogio-demo.com). To secure your Wilddog, create a production Wilddog at https://www.wilddog.com.");var i=this;this.authConn_(e,function(n,a){i.authOnComplete_(n,a,!0,e,t,o||{},r)},function(e,t){i.authOnCancel_("auth()",e,t,n)})},wd.login.AuthenticationManager.prototype.unauthenticate=function(e){var t=this;this.sessionManager_.clear(),t.updateAuthStatus_(null),this.unauthConn_(function(t,o){if("ok"===t)wd.core.util.callUserCallback(e,null);else{var r=(t||"error").toUpperCase(),n=r;o&&(n+=": "+o);var i=new Error(n);i.code=r,wd.core.util.callUserCallback(e,i)}})},wd.login.AuthenticationManager.prototype.authOnComplete_=function(e,t,o,r,n,i,a){if("ok"===e){if(o){var s=t.auth;n.auth=s,n.expires=t.expires,n.token=wd.util.jwt.isValidFormat(r)?r:"";var d=null;s&&wd.util.obj.contains(s,"uid")?d=wd.util.obj.get(s,"uid"):wd.util.obj.contains(n,"uid")&&(d=wd.util.obj.get(n,"uid")),n.uid=d;var l="custom";if(s&&wd.util.obj.contains(s,"provider")?l=wd.util.obj.get(s,"provider"):wd.util.obj.contains(n,"provider")&&(l=wd.util.obj.get(n,"provider")),n.provider=l,this.sessionManager_.clear(),wd.util.jwt.isValidFormat(r)){i=i||{};var g=wd.core.storage.PersistentStorage;"sessionOnly"===i[wd.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&(g=wd.core.storage.SessionStorage),"none"!==i[wd.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&this.sessionManager_.set(n,g)}this.updateAuthStatus_(n)}return void wd.core.util.callUserCallback(a,null,n)}this.handleBadAuthStatus_();var u=(e||"error").toUpperCase(),c=u;t&&(c+=": "+t);var p=new Error(c);p.code=u,wd.core.util.callUserCallback(a,p)},wd.login.AuthenticationManager.prototype.authOnCancel_=function(e,t,o,r){wd.core.util.warn(e+" was canceled: "+o),this.handleBadAuthStatus_();var n=new Error(o);n.code=t.toUpperCase(),wd.core.util.callUserCallback(r,n)},wd.login.AuthenticationManager.prototype.handleBadAuthStatus_=function(){this.sessionManager_.clear(),this.updateAuthStatus_(null)},wd.login.AuthenticationManager.prototype.authWithCredential=function(e,t,o,r){this.checkServerSettingsOrThrow();var n,i=new wd.login.RequestInfo(o||{},{},t||{});n=NODE_CLIENT?[wd.login.transports.NodeHttp]:[wd.login.transports.XHR,wd.login.transports.JSONP],this.authWithTransports_(n,"/auth/"+e,i,r)},wd.login.AuthenticationManager.prototype.authWithPopup=function(e,t,o){this.checkServerSettingsOrThrow();var r=[wd.login.transports.Popup,wd.login.transports.CordovaInAppBrowser],n=wd.login.RequestInfo.fromParams(t),i=625,a=625;return"anonymous"===e||"password"===e?void setTimeout(function(){wd.core.util.callUserCallback(o,wd.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0):(n.transportOptions.window_features="menubar=yes,modal=yes,alwaysRaised=yeslocation=yes,resizable=yes,scrollbars=yes,status=yes,height="+a+",width="+i+",top="+("object"==typeof screen?.5*(screen.height-a):0)+",left="+("object"==typeof screen?.5*(screen.width-i):0),n.transportOptions.relay_url=wd.login.transports.util.getPopupChannelUrl(this.repoInfo_.namespace),n.transportOptions.requestWithCredential=goog.bind(this.requestWithCredential,this),void this.authWithTransports_(r,"/auth/"+e,n,o))},wd.login.AuthenticationManager.prototype.authWithRedirect=function(e,t,o){this.checkServerSettingsOrThrow();var r=[wd.login.transports.Redirect],n=wd.login.RequestInfo.fromParams(t);return"anonymous"===e||"wilddog"===e?void wd.core.util.callUserCallback(o,wd.login.Errors.get("TRANSPORT_UNAVAILABLE")):(wd.core.storage.SessionStorage.set(wd.login.Constants.REDIR_CLIENT_OPTIONS_KEY,n.clientOptions),void this.authWithTransports_(r,"/auth/"+e,n,o))},wd.login.AuthenticationManager.prototype.finishOAuthRedirectLogin_=function(){var e=wd.core.storage.SessionStorage.get(wd.login.Constants.REDIR_REQUEST_ID_KEY);if(e){var t=wd.core.storage.SessionStorage.get(wd.login.Constants.REDIR_CLIENT_OPTIONS_KEY);
wd.core.storage.SessionStorage.remove(wd.login.Constants.REDIR_REQUEST_ID_KEY),wd.core.storage.SessionStorage.remove(wd.login.Constants.REDIR_CLIENT_OPTIONS_KEY);var o=[wd.login.transports.XHR,wd.login.transports.JSONP],r={requestId:e,requestKey:wd.login.transports.util.extractRedirectCompletionHash(document.location.hash)},n={},i=new wd.login.RequestInfo(t,n,r);this.redirectRestart_=!0,wd.login.transports.util.replaceRedirectCompletionHash(),this.authWithTransports_(o,"/auth/session",i,function(e){this.redirectRestart_=!1}.bind(this))}},wd.login.AuthenticationManager.prototype.createUser=function(e,t){this.checkServerSettingsOrThrow();var o="/users",r=wd.login.RequestInfo.fromParams(e);r.serverParams._method="POST",this.requestWithCredential(o,r,function(e,o){e?wd.core.util.callUserCallback(t,e):wd.core.util.callUserCallback(t,e,o)})},wd.login.AuthenticationManager.prototype.removeUser=function(e,t){var o=this;this.checkServerSettingsOrThrow();var r="/users/"+encodeURIComponent(e.email),n=wd.login.RequestInfo.fromParams(e);n.serverParams._method="DELETE",this.requestWithCredential(r,n,function(e,r){!e&&r&&r.uid&&o.authData_&&o.authData_.uid&&o.authData_.uid===r.uid&&o.unauthenticate(),wd.core.util.callUserCallback(t,e)})},wd.login.AuthenticationManager.prototype.changePassword=function(e,t){this.checkServerSettingsOrThrow();var o="/users/"+encodeURIComponent(e.email)+"/password",r=wd.login.RequestInfo.fromParams(e);r.serverParams._method="PUT",r.serverParams.password=e.newPassword,this.requestWithCredential(o,r,function(e,o){wd.core.util.callUserCallback(t,e)})},wd.login.AuthenticationManager.prototype.changeEmail=function(e,t){this.checkServerSettingsOrThrow();var o="/users/"+encodeURIComponent(e.oldEmail)+"/email",r=wd.login.RequestInfo.fromParams(e);r.serverParams._method="PUT",r.serverParams.email=e.newEmail,r.serverParams.password=e.password,this.requestWithCredential(o,r,function(e,o){wd.core.util.callUserCallback(t,e)})},wd.login.AuthenticationManager.prototype.resetPassword=function(e,t){this.checkServerSettingsOrThrow();var o="/users/"+encodeURIComponent(e.email)+"/password",r=wd.login.RequestInfo.fromParams(e);r.serverParams._method="POST",this.requestWithCredential(o,r,function(e,o){wd.core.util.callUserCallback(t,e)})},wd.login.AuthenticationManager.prototype.requestWithCredential=function(e,t,o){var r;r=NODE_CLIENT?[wd.login.transports.NodeHttp]:[wd.login.transports.XHR,wd.login.transports.JSONP],this.requestWithTransports_(r,e,t,o)},wd.login.AuthenticationManager.prototype.authWithTransports_=function(e,t,o,r){var n=this;this.requestWithTransports_(e,t,o,function(e,t){e||!(t&&t.token&&t.uid)?wd.core.util.callUserCallback(r,e||wd.login.Errors.get("UNKNOWN_ERROR")):(t=t,n.authenticate(t.token,t,o.clientOptions,function(e,t){e?wd.core.util.callUserCallback(r,e):wd.core.util.callUserCallback(r,null,t)}))})},wd.login.AuthenticationManager.prototype.requestWithTransports_=function(e,t,o,r){var n=goog.array.filter(e,function(e){return"function"==typeof e.isAvailable&&e.isAvailable()});if(0===n.length)return void setTimeout(function(){wd.core.util.callUserCallback(r,wd.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0);var i=n.shift(),a=new i(o.transportOptions),s=wd.util.obj.clone(o.serverParams);s.v=this.versionString(),s.transport=a.classification(),s.suppress_status_codes=!0;var d=wd.login.transports.util.getBaseUrl()+"/"+this.repoInfo_.namespace+t;a.open(d,s,function(e,t){if(e)wd.core.util.callUserCallback(r,e);else if(t&&t.error){var o=new Error(t.error.message);o.code=t.error.code,o.details=t.error.details,wd.core.util.callUserCallback(r,o)}else wd.core.util.callUserCallback(r,null,t)})},wd.login.AuthenticationManager.prototype.updateAuthStatus_=function(e){var t=null!==this.authData_||null!==e;this.authData_=e,t&&this.trigger("auth_status",e),this.onAuthStatus_(null!==e)},wd.login.AuthenticationManager.prototype.getInitialEvent=function(e){return wd.core.util.assert("auth_status"===e,'initial event must be of type "auth_status"'),this.redirectRestart_?null:[this.authData_]},wd.login.AuthenticationManager.prototype.versionString=function(){return(NODE_CLIENT?"node-":"js-")+CLIENT_VERSION},wd.login.AuthenticationManager.prototype.checkServerSettingsOrThrow=function(){if(this.repoInfo_.isCustomHost()&&wd.login.Constants.SERVER_HOST===wd.login.Constants.DEFAULT_SERVER_HOST)throw new Error("This custom Wilddog server ('"+this.repoInfo_.domain+"') does not support delegated login.")},goog.provide("wd.core.operation.Merge"),goog.require("wd.core.util"),wd.core.operation.Merge=function(e,t,o){this.type=wd.core.OperationType.MERGE,this.source=e,this.path=t,this.children=o},wd.core.operation.Merge.prototype.operationForChild=function(e){if(this.path.isEmpty()){var t=this.children.subtree(new wd.core.util.Path(e));return t.isEmpty()?null:t.value?new wd.core.operation.Overwrite(this.source,wd.core.util.Path.Empty,t.value):new wd.core.operation.Merge(this.source,wd.core.util.Path.Empty,t)}return wd.core.util.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new wd.core.operation.Merge(this.source,this.path.popFront(),this.children)},goog.DEBUG&&(wd.core.operation.Merge.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}),goog.provide("wd.core.operation.AckUserWrite"),wd.core.operation.AckUserWrite=function(e,t){this.type=wd.core.OperationType.ACK_USER_WRITE,this.source=wd.core.OperationSource.User,this.path=e,this.revert=t},wd.core.operation.AckUserWrite.prototype.operationForChild=function(e){return this.path.isEmpty()?this:new wd.core.operation.AckUserWrite(this.path.popFront(),this.revert)},goog.DEBUG&&(wd.core.operation.AckUserWrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" ack write revert="+this.revert+")"}),goog.provide("wd.core.operation.ListenComplete"),wd.core.operation.ListenComplete=function(e,t){this.type=wd.core.OperationType.LISTEN_COMPLETE,this.source=e,this.path=t},wd.core.operation.ListenComplete.prototype.operationForChild=function(e){return this.path.isEmpty()?new wd.core.operation.ListenComplete(this.source,wd.core.util.Path.Empty):new wd.core.operation.ListenComplete(this.source,this.path.popFront())},goog.DEBUG&&(wd.core.operation.ListenComplete.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" listen_complete)"}),goog.provide("wd.core.operation.Overwrite"),wd.core.operation.Overwrite=function(e,t,o){this.type=wd.core.OperationType.OVERWRITE,this.source=e,this.path=t,this.snap=o},wd.core.operation.Overwrite.prototype.operationForChild=function(e){return this.path.isEmpty()?new wd.core.operation.Overwrite(this.source,wd.core.util.Path.Empty,this.snap.getImmediateChild(e)):new wd.core.operation.Overwrite(this.source,this.path.popFront(),this.snap)},goog.DEBUG&&(wd.core.operation.Overwrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" overwrite: "+this.snap.toString()+")"}),goog.provide("wd.core.Operation"),goog.require("wd.core.operation.AckUserWrite"),goog.require("wd.core.operation.Merge"),goog.require("wd.core.operation.Overwrite"),goog.require("wd.core.operation.ListenComplete"),goog.require("wd.core.util"),wd.core.OperationType={OVERWRITE:0,MERGE:1,ACK_USER_WRITE:2,LISTEN_COMPLETE:3},wd.core.Operation=function(){},wd.core.Operation.prototype.source,wd.core.Operation.prototype.type,wd.core.Operation.prototype.path,wd.core.Operation.prototype.operationForChild=goog.abstractMethod,wd.core.OperationSource=function(e,t,o,r){this.fromUser=e,this.fromServer=t,this.queryId=o,this.tagged=r,wd.core.util.assert(!r||t,"Tagged queries must be from server.")},wd.core.OperationSource.User=new wd.core.OperationSource(!0,!1,null,!1),wd.core.OperationSource.Server=new wd.core.OperationSource(!1,!0,null,!1),wd.core.OperationSource.forServerTaggedQuery=function(e){return new wd.core.OperationSource(!1,!0,e,!0)},goog.DEBUG&&(wd.core.OperationSource.prototype.toString=function(){return this.fromUser?"user":this.tagged?"server(queryID="+this.queryId+")":"server"}),goog.provide("wd.core.view.CacheNode"),wd.core.view.CacheNode=function(e,t,o){this.node_=e,this.fullyInitialized_=t,this.filtered_=o},wd.core.view.CacheNode.prototype.isFullyInitialized=function(){return this.fullyInitialized_},wd.core.view.CacheNode.prototype.isFiltered=function(){return this.filtered_},wd.core.view.CacheNode.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},wd.core.view.CacheNode.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},wd.core.view.CacheNode.prototype.getNode=function(){return this.node_},goog.provide("wd.core.view.ViewCache"),goog.require("wd.core.view.CacheNode"),goog.require("wd.core.snap"),wd.core.view.ViewCache=function(e,t){this.eventCache_=e,this.serverCache_=t},wd.core.view.ViewCache.Empty=new wd.core.view.ViewCache(new wd.core.view.CacheNode(wd.core.snap.EMPTY_NODE,!1,!1),new wd.core.view.CacheNode(wd.core.snap.EMPTY_NODE,!1,!1)),wd.core.view.ViewCache.prototype.updateEventSnap=function(e,t,o){return new wd.core.view.ViewCache(new wd.core.view.CacheNode(e,t,o),this.serverCache_)},wd.core.view.ViewCache.prototype.updateServerSnap=function(e,t,o){return new wd.core.view.ViewCache(this.eventCache_,new wd.core.view.CacheNode(e,t,o))},wd.core.view.ViewCache.prototype.getEventCache=function(){return this.eventCache_},wd.core.view.ViewCache.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},wd.core.view.ViewCache.prototype.getServerCache=function(){return this.serverCache_},wd.core.view.ViewCache.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},goog.provide("wd.core.view.Event"),wd.core.view.Event=function(){},wd.core.view.Event.prototype.getPath,wd.core.view.Event.prototype.getEventType,wd.core.view.Event.prototype.getEventRunner,wd.core.view.Event.prototype.toString,wd.core.view.DataEvent=function(e,t,o,r){this.eventRegistration=t,this.snapshot=o,this.prevName=r,this.eventType=e},wd.core.view.DataEvent.prototype.getPath=function(){var e=this.snapshot.ref();return"value"===this.eventType?e.path:e.parent().path},wd.core.view.DataEvent.prototype.getEventType=function(){return this.eventType},wd.core.view.DataEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},wd.core.view.DataEvent.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+wd.util.json.stringify(this.snapshot.exportVal())},wd.core.view.CancelEvent=function(e,t,o){this.eventRegistration=e,this.error=t,this.path=o},wd.core.view.CancelEvent.prototype.getPath=function(){return this.path},wd.core.view.CancelEvent.prototype.getEventType=function(){return"cancel"},wd.core.view.CancelEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},wd.core.view.CancelEvent.prototype.toString=function(){return this.path.toString()+":cancel"},goog.provide("wd.core.view.Change"),wd.core.view.Change=function(e,t,o,r,n){this.type=e,this.snapshotNode=t,this.childName=o,this.oldSnap=r,this.prevName=n},wd.core.view.Change.valueChange=function(e){return new wd.core.view.Change(wd.core.view.Change.VALUE,e)},wd.core.view.Change.childAddedChange=function(e,t){return new wd.core.view.Change(wd.core.view.Change.CHILD_ADDED,t,e)},wd.core.view.Change.childRemovedChange=function(e,t){return new wd.core.view.Change(wd.core.view.Change.CHILD_REMOVED,t,e)},wd.core.view.Change.childChangedChange=function(e,t,o){return new wd.core.view.Change(wd.core.view.Change.CHILD_CHANGED,t,e,o)},wd.core.view.Change.childMovedChange=function(e,t){return new wd.core.view.Change(wd.core.view.Change.CHILD_MOVED,t,e)},wd.core.view.Change.prototype.changeWithPrevName=function(e){return new wd.core.view.Change(this.type,this.snapshotNode,this.childName,this.oldSnap,e)},wd.core.view.Change.CHILD_ADDED="child_added",wd.core.view.Change.CHILD_REMOVED="child_removed",wd.core.view.Change.CHILD_CHANGED="child_changed",wd.core.view.Change.CHILD_MOVED="child_moved",wd.core.view.Change.VALUE="value",goog.provide("wd.core.view.EventRegistration"),goog.require("wd.core.view.Change"),goog.require("wd.core.view.Event"),goog.require("wd.core.util"),wd.core.view.EventRegistration=function(){},wd.core.view.EventRegistration.prototype.respondsTo,wd.core.view.EventRegistration.prototype.createEvent,wd.core.view.EventRegistration.prototype.getEventRunner,wd.core.view.EventRegistration.prototype.createCancelEvent,wd.core.view.EventRegistration.prototype.matches,wd.core.view.EventRegistration.prototype.hasAnyCallback,wd.core.view.ValueEventRegistration=function(e,t,o){this.callback_=e,this.cancelCallback_=t,this.context_=o||null},wd.core.view.ValueEventRegistration.prototype.respondsTo=function(e){return"value"===e},wd.core.view.ValueEventRegistration.prototype.createEvent=function(e,t){var o=t.getQueryParams().getIndex();return new wd.core.view.DataEvent("value",this,new wd.api.DataSnapshot(e.snapshotNode,t.ref(),o))},wd.core.view.ValueEventRegistration.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){wd.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var o=this.cancelCallback_;return function(){o.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},wd.core.view.ValueEventRegistration.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new wd.core.view.CancelEvent(this,e,t):null},wd.core.view.ValueEventRegistration.prototype.matches=function(e){return e instanceof wd.core.view.ValueEventRegistration?e.callback_&&this.callback_?e.callback_===this.callback_&&e.context_===this.context_:!0:!1},wd.core.view.ValueEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callback_},wd.core.view.ChildEventRegistration=function(e,t,o){this.callbacks_=e,this.cancelCallback_=t,this.context_=o},wd.core.view.ChildEventRegistration.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,goog.object.containsKey(this.callbacks_,t)},wd.core.view.ChildEventRegistration.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new wd.core.view.CancelEvent(this,e,t):null},wd.core.view.ChildEventRegistration.prototype.createEvent=function(e,t){wd.core.util.assert(null!=e.childName,"Child events should have a childName.");var o=t.ref().child(e.childName),r=t.getQueryParams().getIndex();return new wd.core.view.DataEvent(e.type,this,new wd.api.DataSnapshot(e.snapshotNode,o,r),e.prevName)},wd.core.view.ChildEventRegistration.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){wd.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var o=this.cancelCallback_;return function(){o.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},wd.core.view.ChildEventRegistration.prototype.matches=function(e){if(e instanceof wd.core.view.ChildEventRegistration){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=goog.object.getCount(e.callbacks_),o=goog.object.getCount(this.callbacks_);if(t===o){if(1===t){var r=goog.object.getAnyKey(e.callbacks_),n=goog.object.getAnyKey(this.callbacks_);return!(n!==r||e.callbacks_[r]&&this.callbacks_[n]&&e.callbacks_[r]!==this.callbacks_[n])}return goog.object.every(this.callbacks_,function(t,o){return e.callbacks_[o]===t})}}}return!1},wd.core.view.ChildEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callbacks_},goog.provide("wd.core.view.EventGenerator"),goog.require("wd.core.snap.NamedNode"),goog.require("wd.core.util"),wd.core.view.EventGenerator=function(e){this.query_=e,this.index_=e.getQueryParams().getIndex()},wd.core.view.EventGenerator.prototype.generateEventsForChanges=function(e,t,o){var r=[],n=this,i=[];return goog.array.forEach(e,function(e){e.type===wd.core.view.Change.CHILD_CHANGED&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&i.push(wd.core.view.Change.childMovedChange(e.childName,e.snapshotNode))}),this.generateEventsForType_(r,wd.core.view.Change.CHILD_REMOVED,e,o,t),this.generateEventsForType_(r,wd.core.view.Change.CHILD_ADDED,e,o,t),this.generateEventsForType_(r,wd.core.view.Change.CHILD_MOVED,i,o,t),this.generateEventsForType_(r,wd.core.view.Change.CHILD_CHANGED,e,o,t),this.generateEventsForType_(r,wd.core.view.Change.VALUE,e,o,t),r},wd.core.view.EventGenerator.prototype.generateEventsForType_=function(e,t,o,r,n){var i=goog.array.filter(o,function(e){return e.type===t}),a=this;goog.array.sort(i,goog.bind(this.compareChanges_,this)),goog.array.forEach(i,function(t){var o=a.materializeSingleChange_(t,n);goog.array.forEach(r,function(r){r.respondsTo(t.type)&&e.push(r.createEvent(o,a.query_))})})},wd.core.view.EventGenerator.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type?e:(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_),e)},wd.core.view.EventGenerator.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw wd.core.util.assertionError("Should only compare child_ events.");var o=new wd.core.snap.NamedNode(e.childName,e.snapshotNode),r=new wd.core.snap.NamedNode(t.childName,t.snapshotNode);return this.index_.compare(o,r)},goog.provide("wd.core.view.CompleteChildSource"),wd.core.view.CompleteChildSource=function(){},wd.core.view.CompleteChildSource.prototype.getCompleteChild=function(e){},wd.core.view.CompleteChildSource.prototype.getChildAfterChild=function(e,t,o){},wd.core.view.NoCompleteChildSource_=function(){},wd.core.view.NoCompleteChildSource_.prototype.getCompleteChild=function(){return null},wd.core.view.NoCompleteChildSource_.prototype.getChildAfterChild=function(){return null},wd.core.view.NO_COMPLETE_CHILD_SOURCE=new wd.core.view.NoCompleteChildSource_,wd.core.view.WriteTreeCompleteChildSource=function(e,t,o){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=o},wd.core.view.WriteTreeCompleteChildSource.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var o=null!=this.optCompleteServerCache_?new wd.core.view.CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,o)},wd.core.view.WriteTreeCompleteChildSource.prototype.getChildAfterChild=function(e,t,o){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),n=this.writes_.calcIndexedSlice(r,t,1,o,e);return 0===n.length?null:n[0]},goog.provide("wd.core.view.ViewProcessor"),goog.require("wd.core.view.CompleteChildSource"),goog.require("wd.core.util"),wd.core.view.ProcessorResult=function(e,t){this.viewCache=e,this.changes=t},wd.core.view.ViewProcessor=function(e){this.filter_=e},wd.core.view.ViewProcessor.prototype.assertIndexed=function(e){wd.core.util.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),wd.core.util.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},wd.core.view.ViewProcessor.prototype.applyOperation=function(e,t,o,r){var n,i,a=new wd.core.view.ChildChangeAccumulator;if(t.type===wd.core.OperationType.OVERWRITE){var s=t;s.source.fromUser?n=this.applyUserOverwrite_(e,s.path,s.snap,o,r,a):(wd.core.util.assert(s.source.fromServer,"Unknown source."),i=s.source.tagged,n=this.applyServerOverwrite_(e,s.path,s.snap,o,r,i,a))}else if(t.type===wd.core.OperationType.MERGE){var d=t;d.source.fromUser?n=this.applyUserMerge_(e,d.path,d.children,o,r,a):(wd.core.util.assert(d.source.fromServer,"Unknown source."),i=d.source.tagged,n=this.applyServerMerge_(e,d.path,d.children,o,r,i,a))}else if(t.type===wd.core.OperationType.ACK_USER_WRITE){var l=t;n=l.revert?this.revertUserWrite_(e,l.path,o,r,a):this.ackUserWrite_(e,l.path,o,r,a)}else{if(t.type!==wd.core.OperationType.LISTEN_COMPLETE)throw wd.core.util.assertionError("Unknown operation type: "+t.type);n=this.listenComplete_(e,t.path,o,r,a)}var g=a.getChanges();return this.maybeAddValueEvent_(e,n,g),new wd.core.view.ProcessorResult(n,g)},wd.core.view.ViewProcessor.prototype.maybeAddValueEvent_=function(e,t,o){var r=t.getEventCache();if(r.isFullyInitialized()){var n=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=e.getCompleteEventSnap();(o.length>0||!e.getEventCache().isFullyInitialized()||n&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&o.push(wd.core.view.Change.valueChange(t.getCompleteEventSnap()))}},wd.core.view.ViewProcessor.prototype.generateEventCacheAfterServerEvent_=function(e,t,o,r,n){var i=e.getEventCache();if(null!=o.shadowingWrite(t))return e;var a,s;if(t.isEmpty())if(wd.core.util.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var d=e.getCompleteServerSnap(),l=d instanceof wd.core.snap.ChildrenNode?d:wd.core.snap.EMPTY_NODE,g=o.calcCompleteEventChildren(l);a=this.filter_.updateFullNode(e.getEventCache().getNode(),g,n)}else{var u=o.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),u,n)}else{var c=t.getFront();if(".priority"==c){wd.core.util.assert(1==t.getLength(),"Can't have a priority with additional path components");var p=i.getNode();s=e.getServerCache().getNode();var h=o.calcEventCacheAfterServerOverwrite(t,p,s);a=null!=h?this.filter_.updatePriority(p,h):i.getNode()}else{var w,f=t.popFront();if(i.isCompleteForChild(c)){s=e.getServerCache().getNode();var _=o.calcEventCacheAfterServerOverwrite(t,i.getNode(),s);w=null!=_?i.getNode().getImmediateChild(c).updateChild(f,_):i.getNode().getImmediateChild(c)}else w=o.calcCompleteChild(c,e.getServerCache());a=null!=w?this.filter_.updateChild(i.getNode(),c,w,r,n):i.getNode()}}return e.updateEventSnap(a,i.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},wd.core.view.ViewProcessor.prototype.applyServerOverwrite_=function(e,t,o,r,n,i,a){var s,d=e.getServerCache(),l=i?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())s=l.updateFullNode(d.getNode(),o,null);else if(l.filtersNodes()&&!d.isFiltered()){var g=d.getNode().updateChild(t,o);s=l.updateFullNode(d.getNode(),g,null)}else{var u=t.getFront();if(!d.isCompleteForPath(t)&&t.getLength()>1)return e;var c=d.getNode().getImmediateChild(u),p=c.updateChild(t.popFront(),o);s=".priority"==u?l.updatePriority(d.getNode(),p):l.updateChild(d.getNode(),u,p,wd.core.view.NO_COMPLETE_CHILD_SOURCE,null)}var h=e.updateServerSnap(s,d.isFullyInitialized()||t.isEmpty(),l.filtersNodes()),w=new wd.core.view.WriteTreeCompleteChildSource(r,h,n);return this.generateEventCacheAfterServerEvent_(h,t,r,w,a)},wd.core.view.ViewProcessor.prototype.applyUserOverwrite_=function(e,t,o,r,n,i){var a,s,d=e.getEventCache(),l=new wd.core.view.WriteTreeCompleteChildSource(r,e,n);if(t.isEmpty())s=this.filter_.updateFullNode(e.getEventCache().getNode(),o,i),a=e.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var g=t.getFront();if(".priority"===g)s=this.filter_.updatePriority(e.getEventCache().getNode(),o),a=e.updateEventSnap(s,d.isFullyInitialized(),d.isFiltered());else{var u,c=t.popFront(),p=d.getNode().getImmediateChild(g);if(c.isEmpty())u=o;else{var h=l.getCompleteChild(g);u=null!=h?".priority"===c.getBack()&&h.getChild(c.parent()).isEmpty()?h:h.updateChild(c,o):wd.core.snap.EMPTY_NODE}if(p.equals(u))a=e;else{var w=this.filter_.updateChild(d.getNode(),g,u,l,i);a=e.updateEventSnap(w,d.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},wd.core.view.ViewProcessor.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},wd.core.view.ViewProcessor.prototype.applyUserMerge_=function(e,t,o,r,n,i){var a=this,s=e;return o.foreach(function(o,d){var l=t.child(o);wd.core.view.ViewProcessor.cacheHasChild_(e,l.getFront())&&(s=a.applyUserOverwrite_(s,l,d,r,n,i))}),o.foreach(function(o,d){var l=t.child(o);wd.core.view.ViewProcessor.cacheHasChild_(e,l.getFront())||(s=a.applyUserOverwrite_(s,l,d,r,n,i))}),s},wd.core.view.ViewProcessor.prototype.applyMerge_=function(e,t){return t.foreach(function(t,o){e=e.updateChild(t,o)}),e},wd.core.view.ViewProcessor.prototype.applyServerMerge_=function(e,t,o,r,n,i,a){if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var s,d=e;s=t.isEmpty()?o:wd.core.util.ImmutableTree.Empty.setTree(t,o);var l=e.getServerCache().getNode(),g=this;return s.children.inorderTraversal(function(t,o){if(l.hasChild(t)){var s=e.getServerCache().getNode().getImmediateChild(t),u=g.applyMerge_(s,o);d=g.applyServerOverwrite_(d,new wd.core.util.Path(t),u,r,n,i,a)}}),s.children.inorderTraversal(function(t,o){var s=!e.getServerCache().isFullyInitialized()&&null==o.value;if(!l.hasChild(t)&&!s){var u=e.getServerCache().getNode().getImmediateChild(t),c=g.applyMerge_(u,o);d=g.applyServerOverwrite_(d,new wd.core.util.Path(t),c,r,n,i,a)}}),d},wd.core.view.ViewProcessor.prototype.ackUserWrite_=function(e,t,o,r,n){if(null!=o.shadowingWrite(t))return e;var i,a=new wd.core.view.WriteTreeCompleteChildSource(o,e,r),s=e.getEventCache().getNode(),d=s;if(e.getServerCache().isFullyInitialized()){if(t.isEmpty()){var l=o.calcCompleteEventCache(e.getCompleteServerSnap());d=this.filter_.updateFullNode(e.getEventCache().getNode(),l,n)}else if(".priority"===t.getFront()){var g=o.calcCompleteChild(t.getFront(),e.getServerCache());null==g||s.isEmpty()||s.getPriority().equals(g)||(d=this.filter_.updatePriority(s,g))}else{var u=t.getFront(),c=o.calcCompleteChild(u,e.getServerCache());null!=c&&(d=this.filter_.updateChild(e.getEventCache().getNode(),u,c,a,n))}i=!0}else if(e.getEventCache().isFullyInitialized()||t.isEmpty()){d=s;var p=e.getEventCache().getNode();if(!p.isLeafNode()){var h=this;p=p,p.forEachChild(wd.core.snap.PriorityIndex,function(t,r){var i=o.calcCompleteChild(t,e.getServerCache());null!=i&&(d=h.filter_.updateChild(d,t,i,a,n))})}i=e.getEventCache().isFullyInitialized()}else{var u=t.getFront();if(1==t.getLength()||e.getEventCache().isCompleteForChild(u)){var w=o.calcCompleteChild(u,e.getServerCache());null!=w&&(d=this.filter_.updateChild(s,u,w,a,n))}i=!1}return e.updateEventSnap(d,i,this.filter_.filtersNodes())},wd.core.view.ViewProcessor.prototype.revertUserWrite_=function(e,t,o,r,n){var i;if(null!=o.shadowingWrite(t))return e;var a,s=new wd.core.view.WriteTreeCompleteChildSource(o,e,r),d=e.getEventCache().getNode();if(t.isEmpty()||".priority"===t.getFront()){var l;if(e.getServerCache().isFullyInitialized())l=o.calcCompleteEventCache(e.getCompleteServerSnap());else{var g=e.getServerCache().getNode();wd.core.util.assert(g instanceof wd.core.snap.ChildrenNode,"serverChildren would be complete if leaf node"),l=o.calcCompleteEventChildren(g)}l=l,a=this.filter_.updateFullNode(d,l,n)}else{var u=t.getFront(),c=o.calcCompleteChild(u,e.getServerCache());null==c&&e.getServerCache().isCompleteForChild(u)&&(c=d.getImmediateChild(u)),a=null!=c?this.filter_.updateChild(d,u,c,s,n):e.getEventCache().getNode().hasChild(u)?this.filter_.updateChild(d,u,wd.core.snap.EMPTY_NODE,s,n):d,a.isEmpty()&&e.getServerCache().isFullyInitialized()&&(i=o.calcCompleteEventCache(e.getCompleteServerSnap()),i.isLeafNode()&&(a=this.filter_.updateFullNode(a,i,n)))}return i=e.getServerCache().isFullyInitialized()||null!=o.shadowingWrite(wd.core.util.Path.Empty),e.updateEventSnap(a,i,this.filter_.filtersNodes())},wd.core.view.ViewProcessor.prototype.listenComplete_=function(e,t,o,r,n){var i=e.getServerCache(),a=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(a,t,o,wd.core.view.NO_COMPLETE_CHILD_SOURCE,n)},goog.provide("wd.core.view.View"),goog.require("wd.core.view.EventGenerator"),goog.require("wd.core.view.ViewCache"),goog.require("wd.core.view.ViewProcessor"),goog.require("wd.core.util"),wd.core.view.View=function(e,t){this.query_=e;var o=e.getQueryParams(),r=new wd.core.view.filter.IndexedFilter(o.getIndex()),n=o.getNodeFilter();this.processor_=new wd.core.view.ViewProcessor(n);var i=t.getServerCache(),a=t.getEventCache(),s=r.updateFullNode(wd.core.snap.EMPTY_NODE,i.getNode(),null),d=n.updateFullNode(wd.core.snap.EMPTY_NODE,a.getNode(),null),l=new wd.core.view.CacheNode(s,i.isFullyInitialized(),r.filtersNodes()),g=new wd.core.view.CacheNode(d,a.isFullyInitialized(),n.filtersNodes());this.viewCache_=new wd.core.view.ViewCache(g,l),this.eventRegistrations_=[],this.eventGenerator_=new wd.core.view.EventGenerator(e)},wd.core.view.View.prototype.getQuery=function(){return this.query_},wd.core.view.View.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},wd.core.view.View.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},wd.core.view.View.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},wd.core.view.View.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},wd.core.view.View.prototype.removeEventRegistration=function(e,t){var o=[];if(t){wd.core.util.assert(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;goog.array.forEach(this.eventRegistrations_,function(e){t=t;var n=e.createCancelEvent(t,r);n&&o.push(n)})}if(e){for(var n=[],i=0;i<this.eventRegistrations_.length;++i){var a=this.eventRegistrations_[i];if(a.matches(e)){if(e.hasAnyCallback()){n=n.concat(this.eventRegistrations_.slice(i+1));break}}else n.push(a)}this.eventRegistrations_=n}else this.eventRegistrations_=[];return o},wd.core.view.View.prototype.applyOperation=function(e,t,o){e.type===wd.core.OperationType.MERGE&&null!==e.source.queryId&&(wd.core.util.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),wd.core.util.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,n=this.processor_.applyOperation(r,e,t,o);return this.processor_.assertIndexed(n.viewCache),wd.core.util.assert(n.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=n.viewCache,this.generateEventsForChanges_(n.changes,n.viewCache.getEventCache().getNode(),null)},wd.core.view.View.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),o=[];if(!t.getNode().isLeafNode()){var r=t.getNode();r.forEachChild(wd.core.snap.PriorityIndex,function(e,t){o.push(wd.core.view.Change.childAddedChange(e,t))})}return t.isFullyInitialized()&&o.push(wd.core.view.Change.valueChange(t.getNode())),this.generateEventsForChanges_(o,t.getNode(),e)},wd.core.view.View.prototype.generateEventsForChanges_=function(e,t,o){var r=o?[o]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},goog.provide("wd.core.util.ImmutableTree"),goog.require("wd.core.util"),goog.require("wd.core.util.Path"),goog.require("wd.core.util.SortedMap"),goog.require("wd.util.json"),goog.require("wd.util.obj"),goog.require("goog.object"),wd.core.util.ImmutableTree=goog.defineClass(null,{constructor:function(e,t){this.value=e,this.children=t||wd.core.util.ImmutableTree.EmptyChildren_},statics:{EmptyChildren_:new wd.core.util.SortedMap(wd.core.util.stringCompare),fromObject:function(e){
var t=wd.core.util.ImmutableTree.Empty;return goog.object.forEach(e,function(e,o){t=t.set(new wd.core.util.Path(o),e)}),t}},isEmpty:function(){return null===this.value&&this.children.isEmpty()},findRootMostMatchingPathAndValue:function(e,t){if(null!=this.value&&t(this.value))return{path:wd.core.util.Path.Empty,value:this.value};if(e.isEmpty())return null;var o=e.getFront(),r=this.children.get(o);if(null!==r){var n=r.findRootMostMatchingPathAndValue(e.popFront(),t);if(null!=n){var i=new wd.core.util.Path(o).child(n.path);return{path:i,value:n.value}}return null}return null},findRootMostValueAndPath:function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},subtree:function(e){if(e.isEmpty())return this;var t=e.getFront(),o=this.children.get(t);return null!==o?o.subtree(e.popFront()):wd.core.util.ImmutableTree.Empty},set:function(e,t){if(e.isEmpty())return new wd.core.util.ImmutableTree(t,this.children);var o=e.getFront(),r=this.children.get(o)||wd.core.util.ImmutableTree.Empty,n=r.set(e.popFront(),t),i=this.children.insert(o,n);return new wd.core.util.ImmutableTree(this.value,i)},remove:function(e){if(e.isEmpty())return this.children.isEmpty()?wd.core.util.ImmutableTree.Empty:new wd.core.util.ImmutableTree(null,this.children);var t=e.getFront(),o=this.children.get(t);if(o){var r,n=o.remove(e.popFront());return r=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&r.isEmpty()?wd.core.util.ImmutableTree.Empty:new wd.core.util.ImmutableTree(this.value,r)}return this},get:function(e){if(e.isEmpty())return this.value;var t=e.getFront(),o=this.children.get(t);return o?o.get(e.popFront()):null},setTree:function(e,t){if(e.isEmpty())return t;var o,r=e.getFront(),n=this.children.get(r)||wd.core.util.ImmutableTree.Empty,i=n.setTree(e.popFront(),t);return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new wd.core.util.ImmutableTree(this.value,o)},fold:function(e){return this.fold_(wd.core.util.Path.Empty,e)},fold_:function(e,t){var o={};return this.children.inorderTraversal(function(r,n){o[r]=n.fold_(e.child(r),t)}),t(e,this.value,o)},findOnPath:function(e,t){return this.findOnPath_(e,wd.core.util.Path.Empty,t)},findOnPath_:function(e,t,o){var r=this.value?o(t,this.value):!1;if(r)return r;if(e.isEmpty())return null;var n=e.getFront(),i=this.children.get(n);return i?i.findOnPath_(e.popFront(),t.child(n),o):null},foreachOnPathWhile:function(e,t){return this.foreachOnPathWhile_(e,wd.core.util.Path.Empty,t)},foreachOnPathWhile_:function(e,t,o){if(e.isEmpty())return t;var r=!0;if(this.value&&(r=o(t,this.value)),r===!0){var n=e.getFront(),i=this.children.get(n);return i?i.foreachOnPath_(e.popFront(),t.child(n),o):t}return t},foreachOnPath:function(e,t){return this.foreachOnPath_(e,wd.core.util.Path.Empty,t)},foreachOnPath_:function(e,t,o){if(e.isEmpty())return this;this.value&&o(t,this.value);var r=e.getFront(),n=this.children.get(r);return n?n.foreachOnPath_(e.popFront(),t.child(r),o):wd.core.util.ImmutableTree.Empty},foreach:function(e){this.foreach_(wd.core.util.Path.Empty,e)},foreach_:function(e,t){this.children.inorderTraversal(function(o,r){r.foreach_(e.child(o),t)}),this.value&&t(e,this.value)},foreachChild:function(e){this.children.inorderTraversal(function(t,o){o.value&&e(t,o.value)})}}),wd.core.util.ImmutableTree.Empty=new wd.core.util.ImmutableTree(null),goog.DEBUG&&(wd.core.util.ImmutableTree.prototype.toString=function(){var e={};return this.foreach(function(t,o){var r=t.toString();e[r]=o.toString()}),wd.util.json.stringify(e)}),goog.provide("wd.core.SyncPoint"),goog.require("wd.core.util"),goog.require("wd.core.util.ImmutableTree"),goog.require("wd.core.view.ViewCache"),goog.require("wd.core.view.EventRegistration"),goog.require("wd.core.view.View"),goog.require("goog.array"),wd.core.SyncPoint=function(){this.views_={}},wd.core.SyncPoint.prototype.isEmpty=function(){return goog.object.isEmpty(this.views_)},wd.core.SyncPoint.prototype.applyOperation=function(e,t,o){var r=e.source.queryId;if(null!==r){var n=wd.util.obj.get(this.views_,r);return wd.core.util.assert(null!=n,"SyncTree gave us an op for an invalid query."),n.applyOperation(e,t,o)}var i=[];return goog.object.forEach(this.views_,function(r){i=i.concat(r.applyOperation(e,t,o))}),i},wd.core.SyncPoint.prototype.addEventRegistration=function(e,t,o,r,n){var i=e.queryIdentifier(),a=wd.util.obj.get(this.views_,i);if(!a){var s=o.calcCompleteEventCache(n?r:null),d=!1;s?d=!0:r instanceof wd.core.snap.ChildrenNode?(s=o.calcCompleteEventChildren(r),d=!1):(s=wd.core.snap.EMPTY_NODE,d=!1);var l=new wd.core.view.ViewCache(new wd.core.view.CacheNode(s,d,!1),new wd.core.view.CacheNode(r,n,!1));a=new wd.core.view.View(e,l),this.views_[i]=a}return a.addEventRegistration(t),a.getInitialEvents(t)},wd.core.SyncPoint.prototype.removeEventRegistration=function(e,t,o){var r=e.queryIdentifier(),n=[],i=[],a=this.hasCompleteView();if("default"===r){var s=this;goog.object.forEach(this.views_,function(e,r){i=i.concat(e.removeEventRegistration(t,o)),e.isEmpty()&&(delete s.views_[r],e.getQuery().getQueryParams().loadsAllData()||n.push(e.getQuery()))})}else{var d=wd.util.obj.get(this.views_,r);d&&(i=i.concat(d.removeEventRegistration(t,o)),d.isEmpty()&&(delete this.views_[r],d.getQuery().getQueryParams().loadsAllData()||n.push(d.getQuery())))}return a&&!this.hasCompleteView()&&n.push(new Wilddog(e.repo,e.path)),{removed:n,events:i}},wd.core.SyncPoint.prototype.getQueryViews=function(){return goog.array.filter(goog.object.getValues(this.views_),function(e){return!e.getQuery().getQueryParams().loadsAllData()})},wd.core.SyncPoint.prototype.getCompleteServerCache=function(e){var t=null;return goog.object.forEach(this.views_,function(o){t=t||o.getCompleteServerCache(e)}),t},wd.core.SyncPoint.prototype.viewForQuery=function(e){var t=e.getQueryParams();if(t.loadsAllData())return this.getCompleteView();var o=e.queryIdentifier();return wd.util.obj.get(this.views_,o)},wd.core.SyncPoint.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},wd.core.SyncPoint.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},wd.core.SyncPoint.prototype.getCompleteView=function(){var e=goog.object.findValue(this.views_,function(e){return e.getQuery().getQueryParams().loadsAllData()});return e||null},goog.provide("wd.core.CompoundWrite"),goog.require("wd.core.snap.Node"),goog.require("wd.core.util"),goog.require("wd.core.util.ImmutableTree"),wd.core.CompoundWrite=function(e){this.writeTree_=e},wd.core.CompoundWrite.Empty=new wd.core.CompoundWrite(new wd.core.util.ImmutableTree(null)),wd.core.CompoundWrite.prototype.addWrite=function(e,t){if(e.isEmpty())return new wd.core.CompoundWrite(new wd.core.util.ImmutableTree(t));var o=this.writeTree_.findRootMostValueAndPath(e);if(null!=o){var r=o.path,n=o.value,i=wd.core.util.Path.relativePath(r,e);return n=n.updateChild(i,t),new wd.core.CompoundWrite(this.writeTree_.set(r,n))}var a=new wd.core.util.ImmutableTree(t),s=this.writeTree_.setTree(e,a);return new wd.core.CompoundWrite(s)},wd.core.CompoundWrite.prototype.addWrites=function(e,t){var o=this;return wd.util.obj.foreach(t,function(t,r){o=o.addWrite(e.child(t),r)}),o},wd.core.CompoundWrite.prototype.removeWrite=function(e){if(e.isEmpty())return wd.core.CompoundWrite.Empty;var t=this.writeTree_.setTree(e,wd.core.util.ImmutableTree.Empty);return new wd.core.CompoundWrite(t)},wd.core.CompoundWrite.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},wd.core.CompoundWrite.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(wd.core.util.Path.relativePath(t.path,e)):null},wd.core.CompoundWrite.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||(t=t,t.forEachChild(wd.core.snap.PriorityIndex,function(t,o){e.push(new wd.core.snap.NamedNode(t,o))})):this.writeTree_.children.inorderTraversal(function(t,o){null!=o.value&&e.push(new wd.core.snap.NamedNode(t,o.value))}),e},wd.core.CompoundWrite.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var t=this.getCompleteNode(e);return null!=t?new wd.core.CompoundWrite(new wd.core.util.ImmutableTree(t)):new wd.core.CompoundWrite(this.writeTree_.subtree(e))},wd.core.CompoundWrite.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},wd.core.CompoundWrite.prototype.apply=function(e){return wd.core.CompoundWrite.applySubtreeWrite_(wd.core.util.Path.Empty,this.writeTree_,e)},wd.core.CompoundWrite.applySubtreeWrite_=function(e,t,o){if(null!=t.value)return o.updateChild(e,t.value);var r=null;return t.children.inorderTraversal(function(t,n){".priority"===t?(wd.core.util.assert(null!==n.value,"Priority writes must always be leaf nodes"),r=n.value):o=wd.core.CompoundWrite.applySubtreeWrite_(e.child(t),n,o)}),o.getChild(e).isEmpty()||null===r||(o=o.updateChild(e.child(".priority"),r)),o},goog.provide("wd.core.WriteTree"),goog.require("wd.core.CompoundWrite"),goog.require("wd.core.util"),goog.require("wd.core.view.CacheNode"),wd.core.WriteRecord,wd.core.WriteTree=function(){this.visibleWrites_=wd.core.CompoundWrite.Empty,this.allWrites_=[],this.lastWriteId_=-1},wd.core.WriteTree.prototype.childWrites=function(e){return new wd.core.WriteTreeRef(e,this)},wd.core.WriteTree.prototype.addOverwrite=function(e,t,o,r){wd.core.util.assert(o>this.lastWriteId_,"Stacking an older write on top of newer ones"),goog.isDef(r)||(r=!0),this.allWrites_.push({path:e,snap:t,writeId:o,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=o},wd.core.WriteTree.prototype.addMerge=function(e,t,o){wd.core.util.assert(o>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:o,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=o},wd.core.WriteTree.prototype.removeWrite=function(e){var t=goog.array.findIndex(this.allWrites_,function(t){return t.writeId===e});wd.core.util.assert(t>=0,"removeWrite called with nonexistent writeId.");var o=this.allWrites_[t];this.allWrites_.splice(t,1);for(var r=o.visible,n=!1,i=this.allWrites_.length-1;r&&i>=0;){var a=this.allWrites_[i];a.visible&&(i>=t&&this.recordContainsPath_(a,o.path)?r=!1:o.path.contains(a.path)&&(n=!0)),i--}if(r){if(n)return this.resetTree_(),o.path;if(o.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(o.path);else{var s=o.children,d=this;goog.object.forEach(s,function(e,t){d.visibleWrites_=d.visibleWrites_.removeWrite(o.path.child(t))})}return o.path}return null},wd.core.WriteTree.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},wd.core.WriteTree.prototype.calcCompleteEventCache=function(e,t,o,r){if(o||r){var n=this.visibleWrites_.childCompoundWrite(e);if(!r&&n.isEmpty())return t;if(r||null!=t||n.hasCompleteWrite(wd.core.util.Path.Empty)){var i=function(t){return!(!t.visible&&!r||o&&goog.array.contains(o,t.writeId)||!t.path.contains(e)&&!e.contains(t.path))},a=wd.core.WriteTree.layerTree_(this.allWrites_,i,e);return l=t||wd.core.snap.EMPTY_NODE,a.apply(l)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var d=this.visibleWrites_.childCompoundWrite(e);if(d.isEmpty())return t;if(null!=t||d.hasCompleteWrite(wd.core.util.Path.Empty)){var l=t||wd.core.snap.EMPTY_NODE;return d.apply(l)}return null},wd.core.WriteTree.prototype.calcCompleteEventChildren=function(e,t){var o=wd.core.snap.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(wd.core.snap.PriorityIndex,function(e,t){o=o.updateImmediateChild(e,t)}),o;if(t){var n=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(wd.core.snap.PriorityIndex,function(e,t){var r=n.childCompoundWrite(new wd.core.util.Path(e)).apply(t);o=o.updateImmediateChild(e,r)}),goog.array.forEach(n.getCompleteChildren(),function(e){o=o.updateImmediateChild(e.name,e.node)}),o}return n=this.visibleWrites_.childCompoundWrite(e),goog.array.forEach(n.getCompleteChildren(),function(e){o=o.updateImmediateChild(e.name,e.node)}),o},wd.core.WriteTree.prototype.calcEventCacheAfterServerOverwrite=function(e,t,o,r){wd.core.util.assert(o||r,"Either existingEventSnap or existingServerSnap must exist");var n=e.child(t);if(this.visibleWrites_.hasCompleteWrite(n))return null;var i=this.visibleWrites_.childCompoundWrite(n);return i.isEmpty()?r.getChild(t):i.apply(r.getChild(t))},wd.core.WriteTree.prototype.calcCompleteChild=function(e,t,o){var r=e.child(t),n=this.visibleWrites_.getCompleteNode(r);if(null!=n)return n;if(o.isCompleteForChild(t)){var i=this.visibleWrites_.childCompoundWrite(r);return i.apply(o.getNode().getImmediateChild(t))}return null},wd.core.WriteTree.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},wd.core.WriteTree.prototype.calcIndexedSlice=function(e,t,o,r,n,i){var a,s=this.visibleWrites_.childCompoundWrite(e),d=s.getCompleteNode(wd.core.util.Path.Empty);if(null!=d)a=d;else{if(null==t)return[];a=s.apply(t)}if(a=a.withIndex(i),a.isEmpty()||a.isLeafNode())return[];for(var l=[],g=i.getCompare(),u=n?a.getReverseIteratorFrom(o,i):a.getIteratorFrom(o,i),c=u.getNext();c&&l.length<r;)0!==g(c,o)&&l.push(c),c=u.getNext();return l},wd.core.WriteTree.prototype.recordContainsPath_=function(e,t){return e.snap?e.path.contains(t):!!goog.object.findKey(e.children,function(o,r){return e.path.child(r).contains(t)})},wd.core.WriteTree.prototype.resetTree_=function(){this.visibleWrites_=wd.core.WriteTree.layerTree_(this.allWrites_,wd.core.WriteTree.DefaultFilter_,wd.core.util.Path.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},wd.core.WriteTree.DefaultFilter_=function(e){return e.visible},wd.core.WriteTree.layerTree_=function(e,t,o){for(var r=wd.core.CompoundWrite.Empty,n=0;n<e.length;++n){var i=e[n];if(t(i)){var a,s=i.path;if(i.snap)o.contains(s)?(a=wd.core.util.Path.relativePath(o,s),r=r.addWrite(a,i.snap)):s.contains(o)&&(a=wd.core.util.Path.relativePath(s,o),r=r.addWrite(wd.core.util.Path.Empty,i.snap.getChild(a)));else{if(!i.children)throw wd.core.util.assertionError("WriteRecord should have .snap or .children");if(o.contains(s))a=wd.core.util.Path.relativePath(o,s),r=r.addWrites(a,i.children);else if(s.contains(o))if(a=wd.core.util.Path.relativePath(s,o),a.isEmpty())r=r.addWrites(wd.core.util.Path.Empty,i.children);else{var d=wd.util.obj.get(i.children,a.getFront());if(d){var l=d.getChild(a.popFront());r=r.addWrite(wd.core.util.Path.Empty,l)}}}}}return r},wd.core.WriteTreeRef=function(e,t){this.treePath_=e,this.writeTree_=t},wd.core.WriteTreeRef.prototype.calcCompleteEventCache=function(e,t,o){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,o)},wd.core.WriteTreeRef.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},wd.core.WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite=function(e,t,o){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,o)},wd.core.WriteTreeRef.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},wd.core.WriteTreeRef.prototype.calcIndexedSlice=function(e,t,o,r,n){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,o,r,n)},wd.core.WriteTreeRef.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},wd.core.WriteTreeRef.prototype.child=function(e){return new wd.core.WriteTreeRef(this.treePath_.child(e),this.writeTree_)},goog.provide("wd.core.SyncTree"),goog.require("wd.core.Operation"),goog.require("wd.core.SyncPoint"),goog.require("wd.core.WriteTree"),goog.require("wd.core.util"),wd.core.ListenProvider,wd.core.SyncTree=function(e){this.syncPointTree_=wd.core.util.ImmutableTree.Empty,this.pendingWriteTree_=new wd.core.WriteTree,this.tagToQueryMap_={},this.queryToTagMap_={},this.listenProvider_=e},wd.core.SyncTree.prototype.applyUserOverwrite=function(e,t,o,r){return this.pendingWriteTree_.addOverwrite(e,t,o,r),r?this.applyOperationToSyncPoints_(new wd.core.operation.Overwrite(wd.core.OperationSource.User,e,t)):[]},wd.core.SyncTree.prototype.applyUserMerge=function(e,t,o){this.pendingWriteTree_.addMerge(e,t,o);var r=wd.core.util.ImmutableTree.fromObject(t);return this.applyOperationToSyncPoints_(new wd.core.operation.Merge(wd.core.OperationSource.User,e,r))},wd.core.SyncTree.prototype.ackUserWrite=function(e,t){t=t||!1;var o=this.pendingWriteTree_.removeWrite(e);return null==o?[]:this.applyOperationToSyncPoints_(new wd.core.operation.AckUserWrite(o,t))},wd.core.SyncTree.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new wd.core.operation.Overwrite(wd.core.OperationSource.Server,e,t))},wd.core.SyncTree.prototype.applyServerMerge=function(e,t){var o=wd.core.util.ImmutableTree.fromObject(t);return this.applyOperationToSyncPoints_(new wd.core.operation.Merge(wd.core.OperationSource.Server,e,o))},wd.core.SyncTree.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new wd.core.operation.ListenComplete(wd.core.OperationSource.Server,e))},wd.core.SyncTree.prototype.applyTaggedQueryOverwrite=function(e,t,o){var r=this.queryKeyForTag_(o);if(null!=r){var n=this.parseQueryKey_(r),i=n.path,a=n.queryId,s=wd.core.util.Path.relativePath(i,e),d=new wd.core.operation.Overwrite(wd.core.OperationSource.forServerTaggedQuery(a),s,t);return this.applyTaggedOperation_(i,a,d)}return[]},wd.core.SyncTree.prototype.applyTaggedQueryMerge=function(e,t,o){var r=this.queryKeyForTag_(o);if(r){var n=this.parseQueryKey_(r),i=n.path,a=n.queryId,s=wd.core.util.Path.relativePath(i,e),d=wd.core.util.ImmutableTree.fromObject(t),l=new wd.core.operation.Merge(wd.core.OperationSource.forServerTaggedQuery(a),s,d);return this.applyTaggedOperation_(i,a,l)}return[]},wd.core.SyncTree.prototype.applyTaggedListenComplete=function(e,t){var o=this.queryKeyForTag_(t);if(o){var r=this.parseQueryKey_(o),n=r.path,i=r.queryId,a=wd.core.util.Path.relativePath(n,e),s=new wd.core.operation.ListenComplete(wd.core.OperationSource.forServerTaggedQuery(i),a);return this.applyTaggedOperation_(n,i,s)}return[]},wd.core.SyncTree.prototype.addEventRegistration=function(e,t){var o=e.path,r=null,n=!1;this.syncPointTree_.foreachOnPathWhile(o,function(e,t){var i=wd.core.util.Path.relativePath(e,o);return r=t.getCompleteServerCache(i),n=n||t.hasCompleteView(),!r});var i=this.syncPointTree_.get(o);i?(n=n||i.hasCompleteView(),r=r||i.getCompleteServerCache(wd.core.util.Path.Empty)):(i=new wd.core.SyncPoint,this.syncPointTree_=this.syncPointTree_.set(o,i));var a;if(null!=r)a=!0;else{a=!1,r=wd.core.snap.EMPTY_NODE;var s=this.syncPointTree_.subtree(o);s.foreachChild(function(e,t){var o=t.getCompleteServerCache(wd.core.util.Path.Empty);o&&(r=r.updateImmediateChild(e,o))})}var d=i.viewExistsForQuery(e);if(!d&&!e.getQueryParams().loadsAllData()){var l=this.makeQueryKey_(e);wd.core.util.assert(!goog.object.containsKey(this.queryToTagMap_,l),"View does not exist, but we have a tag");var g=wd.core.SyncTree.getNextQueryTag_();this.queryToTagMap_[l]=g,this.tagToQueryMap_["_"+g]=l}var u=this.pendingWriteTree_.childWrites(o),c=i.addEventRegistration(e,t,u,r,a);if(!d&&!n){var p=i.viewForQuery(e);c=c.concat(this.setupListener_(e,p))}return c},wd.core.SyncTree.prototype.removeEventRegistration=function(e,t,o){var r=e.path,n=this.syncPointTree_.get(r),i=[];if(n&&("default"===e.queryIdentifier()||n.viewExistsForQuery(e))){var a=n.removeEventRegistration(e,t,o);n.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(r));var s=a.removed;i=a.events;var d=-1!==goog.array.findIndex(s,function(e){return e.getQueryParams().loadsAllData()}),l=this.syncPointTree_.findOnPath(r,function(e,t){return t.hasCompleteView()});if(d&&!l){var g=this.syncPointTree_.subtree(r);if(!g.isEmpty())for(var u=this.collectDistinctViewsForSubTree_(g),c=0;c<u.length;++c){var p=u[c],h=p.getQuery(),w=this.createListenerForView_(p);this.listenProvider_.startListening(h,this.tagForQuery_(h),w.hashFn,w.onComplete)}}if(!l&&s.length>0&&!o)if(d){var f=null;this.listenProvider_.stopListening(e,f)}else{var _=this;goog.array.forEach(s,function(e){var t=(e.queryIdentifier(),_.queryToTagMap_[_.makeQueryKey_(e)]);_.listenProvider_.stopListening(e,t)})}this.removeTags_(s)}return i},wd.core.SyncTree.prototype.calcCompleteEventCache=function(e,t){var o=!0,r=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(e,function(t,o){var r=wd.core.util.Path.relativePath(t,e),n=o.getCompleteServerCache(r);return n?n:void 0});return r.calcCompleteEventCache(e,n,t,o)},wd.core.SyncTree.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,o){if(t&&t.hasCompleteView()){var r=t.getCompleteView();return[r]}var n=[];return t&&(n=t.getQueryViews()),goog.object.forEach(o,function(e){n=n.concat(e)}),n})},wd.core.SyncTree.prototype.removeTags_=function(e){for(var t=0;t<e.length;++t){var o=e[t];if(!o.getQueryParams().loadsAllData()){var r=this.makeQueryKey_(o),n=this.queryToTagMap_[r];delete this.queryToTagMap_[r],delete this.tagToQueryMap_["_"+n]}}},wd.core.SyncTree.prototype.setupListener_=function(e,t){var o=e.path,r=this.tagForQuery_(e),n=this.createListenerForView_(t),i=this.listenProvider_.startListening(e,r,n.hashFn,n.onComplete),a=this.syncPointTree_.subtree(o);if(r)wd.core.util.assert(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(e,t,o){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(goog.array.map(t.getQueryViews(),function(e){return e.getQuery()}))),goog.object.forEach(o,function(e){r=r.concat(e)}),r}),d=0;d<s.length;++d){var l=s[d];this.listenProvider_.stopListening(l,this.tagForQuery_(l))}return i},wd.core.SyncTree.prototype.createListenerForView_=function(e){var t=this,o=e.getQuery(),r=this.tagForQuery_(o);return{hashFn:function(){var t=e.getServerCache()||wd.core.snap.EMPTY_NODE;return t.hash()},onComplete:function(e,n){if("ok"===e)return r?t.applyTaggedListenComplete(o.path,r):t.applyListenComplete(o.path);var i=wd.core.util.errorForServerCode(e);return t.removeEventRegistration(o,null,i)}}},wd.core.SyncTree.prototype.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},wd.core.SyncTree.prototype.parseQueryKey_=function(e){var t=e.indexOf("$");return wd.core.util.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new wd.core.util.Path(e.substr(0,t))}},wd.core.SyncTree.prototype.queryKeyForTag_=function(e){return goog.object.get(this.tagToQueryMap_,"_"+e)},wd.core.SyncTree.prototype.tagForQuery_=function(e){var t=this.makeQueryKey_(e);return wd.util.obj.get(this.queryToTagMap_,t)},wd.core.SyncTree.nextQueryTag_=1,wd.core.SyncTree.getNextQueryTag_=function(){return wd.core.SyncTree.nextQueryTag_++},wd.core.SyncTree.prototype.applyTaggedOperation_=function(e,t,o){var r=this.syncPointTree_.get(e);wd.core.util.assert(r,"Missing sync point for query tag that we're tracking");var n=this.pendingWriteTree_.childWrites(e);return r.applyOperation(o,n,null)},wd.core.SyncTree.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(wd.core.util.Path.Empty))},wd.core.SyncTree.prototype.applyOperationHelper_=function(e,t,o,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,o,r);var n=t.get(wd.core.util.Path.Empty);null==o&&null!=n&&(o=n.getCompleteServerCache(wd.core.util.Path.Empty));var i=[],a=e.path.getFront(),s=e.operationForChild(a),d=t.children.get(a);if(d&&s){var l=o?o.getImmediateChild(a):null,g=r.child(a);i=i.concat(this.applyOperationHelper_(s,d,l,g))}return n&&(i=i.concat(n.applyOperation(e,r,o))),i},wd.core.SyncTree.prototype.applyOperationDescendantsHelper_=function(e,t,o,r){var n=t.get(wd.core.util.Path.Empty);null==o&&null!=n&&(o=n.getCompleteServerCache(wd.core.util.Path.Empty));var i=[],a=this;return t.children.inorderTraversal(function(t,n){var s=o?o.getImmediateChild(t):null,d=r.child(t),l=e.operationForChild(t);l&&(i=i.concat(a.applyOperationDescendantsHelper_(l,n,s,d)))}),n&&(i=i.concat(n.applyOperation(e,r,o))),i},goog.provide("wd.core.util.CountedSet"),goog.require("wd.core.util"),goog.require("wd.util.obj"),goog.require("goog.object"),wd.core.util.CountedSet=goog.defineClass(null,{constructor:function(){this.set={}},add:function(e,t){this.set[e]=null!==t?t:!0},contains:function(e){return wd.util.obj.contains(this.set,e)},get:function(e){return this.contains(e)?this.set[e]:void 0},remove:function(e){delete this.set[e]},clear:function(){this.set={}},isEmpty:function(){return goog.object.isEmpty(this.set)},count:function(){return goog.object.getCount(this.set)},each:function(e){goog.object.forEach(this.set,function(t,o){e(o,t)})},keys:function(){var e=[];return goog.object.forEach(this.set,function(t,o){e.push(o)}),e}}),goog.provide("wd.core.SparseSnapshotTree"),goog.require("wd.core.snap.Node"),goog.require("wd.core.snap.PriorityIndex"),goog.require("wd.core.util.CountedSet"),goog.require("wd.core.util.Path"),wd.core.SparseSnapshotTree=function(){this.value_=null,this.children_=null},wd.core.SparseSnapshotTree.prototype.find=function(e){if(null!=this.value_)return this.value_.getChild(e);if(e.isEmpty()||null==this.children_)return null;var t=e.getFront();if(e=e.popFront(),this.children_.contains(t)){var o=this.children_.get(t);return o.find(e)}return null},wd.core.SparseSnapshotTree.prototype.remember=function(e,t){if(e.isEmpty())this.value_=t,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,t);else{null==this.children_&&(this.children_=new wd.core.util.CountedSet);var o=e.getFront();this.children_.contains(o)||this.children_.add(o,new wd.core.SparseSnapshotTree);var r=this.children_.get(o);e=e.popFront(),r.remember(e,t)}},wd.core.SparseSnapshotTree.prototype.forget=function(e){if(e.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var t=this.value_;this.value_=null;var o=this;return t.forEachChild(wd.core.snap.PriorityIndex,function(e,t){o.remember(new wd.core.util.Path(e),t)}),this.forget(e)}if(null!==this.children_){var r=e.getFront();if(e=e.popFront(),this.children_.contains(r)){var n=this.children_.get(r).forget(e);n&&this.children_.remove(r)}return this.children_.isEmpty()?(this.children_=null,!0):!1}return!0},wd.core.SparseSnapshotTree.prototype.forEachTree=function(e,t){null!==this.value_?t(e,this.value_):this.forEachChild(function(o,r){var n=new wd.core.util.Path(e.toString()+"/"+o);r.forEachTree(n,t)})},wd.core.SparseSnapshotTree.prototype.forEachChild=function(e){null!==this.children_&&this.children_.each(function(t,o){e(t,o)})},goog.provide("wd.realtime.Constants"),wd.realtime.Constants={PROTOCOL_VERSION:"1.0",VERSION_PARAM:"v",SESSION_PARAM:"s",REFERER_PARAM:"r",FORGE_REF:"f",FORGE_DOMAIN:"wilddogio.com"},goog.provide("wd.realtime.SocketIo"),wd.realtime.SocketIo=require("socket.io-client"),goog.provide("wd.realtime.SocketIoConnection"),goog.require("wd.constants"),goog.require("wd.core.stats.StatsManager"),goog.require("wd.core.storage"),goog.require("wd.core.util"),goog.require("wd.realtime.Constants"),goog.require("wd.realtime.SocketIo"),goog.require("wd.util.json");var WEBSOCKET_KEEPALIVE_INTERVAL=45e3;wd.realtime.SocketIoConnection=function(e,t,o){this.connId=e,this.log_=wd.core.util.logWrapper(this.connId),this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.stats_=wd.core.stats.StatsManager.getCollection(t),this.connURL=(t.secure?"https://":"http://")+t.internalHost+"?"+wd.realtime.Constants.VERSION_PARAM+"="+wd.realtime.Constants.PROTOCOL_VERSION,!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(wd.realtime.Constants.FORGE_DOMAIN)&&(this.connURL=this.connURL+"&"+wd.realtime.Constants.REFERER_PARAM+"="+wd.realtime.Constants.FORGE_REF),t.needsQueryParam()&&(this.connURL=this.connURL+"&ns="+t.namespace),o&&(this.connURL=this.connURL+"&"+wd.realtime.Constants.SESSION_PARAM+"="+o)},wd.realtime.SocketIoConnection.prototype.open=function(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1;try{this.mySock=wd.realtime.SocketIo(this.connURL,{path:"/.ws",multiplex:"false","force new connection":!0})}catch(o){this.log_("Error instantiating socket.io ");var r=o.message||o.data;return r&&this.log_(r),void this.onClosed_()}var n=this;this.mySock.on("connect",function(){n.log_("Websocket connected."),n.everConnected_=!0}),this.mySock.on("disconnect",function(){n.log_("Socketio connection was disconnected."),n.mySock=null,n.onClosed_()}),this.mySock.on("wd",function(e){n.handleIncomingMessage(e)}),this.mySock.on("error",function(e){n.log_("Socketio error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()})},wd.realtime.SocketIoConnection.prototype.start=function(){},wd.realtime.SocketIoConnection.forceDisallow=function(){wd.realtime.SocketIoConnection.forceDisallow_=!0},wd.realtime.SocketIoConnection.isAvailable=function(){return!0},wd.realtime.SocketIoConnection.previouslyFailed=function(){return wd.core.storage.PersistentStorage.isInMemoryStorage||wd.core.storage.PersistentStorage.get("previous_websocket_failure")===!0},wd.realtime.SocketIoConnection.prototype.markConnectionHealthy=function(){wd.core.storage.PersistentStorage.remove("previous_websocket_failure")},wd.realtime.SocketIoConnection.prototype.handleIncomingMessage=function(e){null!==this.mySock&&this.onMessage(e)},wd.realtime.SocketIoConnection.prototype.send=function(e){this.mySock.emit("wd",e)},wd.realtime.SocketIoConnection.prototype.shutdown_=function(){this.isClosed_=!0,null!=this.mySock&&this.mySock.disconnect()},wd.realtime.SocketIoConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},wd.realtime.SocketIoConnection.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},wd.realtime.SocketIoConnection.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.mySock.send("0"),e.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))},goog.provide("wd.realtime.TransportManager"),goog.require("wd.constants"),goog.require("wd.realtime.SocketIoConnection"),wd.realtime.TransportManager=function(e){this.initTransports_(e)},wd.realtime.TransportManager.ALL_TRANSPORTS=[wd.realtime.SocketIoConnection],wd.realtime.TransportManager.prototype.initTransports_=function(e){var t=this.transports_=[];wd.core.util.each(wd.realtime.TransportManager.ALL_TRANSPORTS,function(e,o){o&&o.isAvailable()&&t.push(o)})},wd.realtime.TransportManager.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},wd.realtime.TransportManager.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},goog.provide("wd.realtime.Connection"),goog.require("wd.core.storage"),goog.require("wd.core.util"),goog.require("wd.realtime.Constants"),goog.require("wd.realtime.TransportManager");var UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10240,BYTES_RECEIVED_HEALTHY_OVERRIDE=102400,REALTIME_STATE_CONNECTING=0,REALTIME_STATE_CONNECTED=1,REALTIME_STATE_DISCONNECTED=2,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";wd.realtime.Connection=function(e,t,o,r,n,i){this.id=e,
this.log_=wd.core.util.logWrapper("c:"+this.id+":"),this.onMessage_=o,this.onReady_=r,this.onDisconnect_=n,this.onKill_=i,this.repoInfo_=t,this.pendingDataMessages=[],this.connectionCount=0,this.transportManager_=new wd.realtime.TransportManager(t),this.state_=REALTIME_STATE_CONNECTING,this.log_("Connection created"),this.start_()},wd.realtime.Connection.prototype.start_=function(){var e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.conn_),o=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1;var r=this;setTimeout(function(){r.conn_&&r.conn_.open(t,o)},Math.floor(0));var n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=setTimeout(function(){r.healthyTimeout_=null,r.isHealthy_||(r.conn_&&r.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(r.log_("Connection exceeded healthy timeout but has received "+r.conn_.bytesReceived+" bytes.  Marking connection healthy."),r.isHealthy_=!0,r.conn_.markConnectionHealthy()):r.conn_&&r.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?r.log_("Connection exceeded healthy timeout but has sent "+r.conn_.bytesSent+" bytes.  Leaving connection alive."):(r.log_("Closing unhealthy connection after timeout."),r.close()))},Math.floor(n)))},wd.realtime.Connection.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},wd.realtime.Connection.prototype.disconnReceiver_=function(e){var t=this;return function(o){e===t.conn_?t.onConnectionLost_(o):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},wd.realtime.Connection.prototype.connReceiver_=function(e){var t=this;return function(o){t.state_!=REALTIME_STATE_DISCONNECTED&&(e===t.rx_?t.onPrimaryMessageReceived_(o):e===t.secondaryConn_?t.onSecondaryMessageReceived_(o):t.log_("message on old connection"))}},wd.realtime.Connection.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},wd.realtime.Connection.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},wd.realtime.Connection.prototype.onSecondaryControl_=function(e){if(MESSAGE_TYPE in e){var t=e[MESSAGE_TYPE];t===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():t===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},wd.realtime.Connection.prototype.onSecondaryMessageReceived_=function(e){var t=wd.core.util.requireKey("t",e),o=wd.core.util.requireKey("d",e);if("c"==t)this.onSecondaryControl_(o);else{if("d"!=t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(o)}},wd.realtime.Connection.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))},wd.realtime.Connection.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},wd.realtime.Connection.prototype.onPrimaryMessageReceived_=function(e){var t=wd.core.util.requireKey("t",e),o=wd.core.util.requireKey("d",e);"c"==t?this.onControl_(o):"d"==t&&this.onDataMessage_(o)},wd.realtime.Connection.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},wd.realtime.Connection.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},wd.realtime.Connection.prototype.onControl_=function(e){var t=wd.core.util.requireKey(MESSAGE_TYPE,e);if(MESSAGE_DATA in e){var o=e[MESSAGE_DATA];if(t===SERVER_HELLO)this.onHandshake_(o);else if(t===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===CONTROL_SHUTDOWN?this.onConnectionShutdown_(o):t===CONTROL_RESET?this.onReset_(o):t===CONTROL_ERROR?wd.core.util.error("Server Error: "+o):t===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):wd.core.util.error("Unknown control packet command: "+t)}},wd.realtime.Connection.prototype.onHandshake_=function(e){var t=e.ts,o=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),this.state_==REALTIME_STATE_CONNECTING&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),wd.realtime.Constants.PROTOCOL_VERSION!==o&&wd.core.util.warn("Protocol version mismatch detected"),this.tryStartUpgrade_())},wd.realtime.Connection.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},wd.realtime.Connection.prototype.startUpgrade_=function(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),o=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,o);var r=this;setTimeout(function(){r.secondaryConn_&&(r.log_("Timed out trying to upgrade."),r.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))},wd.realtime.Connection.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),this.state_===REALTIME_STATE_CONNECTED?this.close():(this.closeConnections_(),this.start_())},wd.realtime.Connection.prototype.onConnectionEstablished_=function(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=REALTIME_STATE_CONNECTED,this.onReady_&&(this.onReady_(t),this.onReady_=null);var o=this;0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeout(function(){o.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))},wd.realtime.Connection.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||this.state_!==REALTIME_STATE_CONNECTED||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))},wd.realtime.Connection.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()},wd.realtime.Connection.prototype.onConnectionLost_=function(e){this.conn_=null,e||this.state_!==REALTIME_STATE_CONNECTING?this.state_===REALTIME_STATE_CONNECTED&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(wd.core.storage.PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},wd.realtime.Connection.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},wd.realtime.Connection.prototype.sendData_=function(e){if(this.state_!==REALTIME_STATE_CONNECTED)throw"Connection is not connected";this.tx_.send(e)},wd.realtime.Connection.prototype.close=function(){this.state_!==REALTIME_STATE_DISCONNECTED&&(this.log_("Closing realtime connection."),this.state_=REALTIME_STATE_DISCONNECTED,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},wd.realtime.Connection.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},goog.provide("wd.core.util.VisibilityMonitor"),goog.require("wd.core.util"),goog.require("wd.core.util.EventEmitter"),wd.core.util.VisibilityMonitor=goog.defineClass(wd.core.util.EventEmitter,{constructor:function(){wd.core.util.EventEmitter.call(this,["visible"]);var e,t;if("undefined"!=typeof document&&"undefined"!=typeof document.addEventListener&&("undefined"!=typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!=typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!=typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!=typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t){var o=this;document.addEventListener(t,function(){var t=!document[e];t!==o.visible_&&(o.visible_=t,o.trigger("visible",t))},!1)}},getInitialEvent:function(e){return wd.core.util.assert("visible"===e,"Unknown event type: "+e),[this.visible_]}}),goog.addSingletonGetter(wd.core.util.VisibilityMonitor),goog.provide("wd.core.ServerActions"),goog.provide("wd.core.util.OnlineMonitor"),goog.require("wd.core.util"),goog.require("wd.core.util.EventEmitter"),wd.core.util.OnlineMonitor=goog.defineClass(wd.core.util.EventEmitter,{constructor:function(){if(wd.core.util.EventEmitter.call(this,["online"]),this.online_=!0,"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener){var e=this;window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)}},getInitialEvent:function(e){return wd.core.util.assert("online"===e,"Unknown event type: "+e),[this.online_]},currentlyOnline:function(){return this.online_}}),goog.addSingletonGetter(wd.core.util.OnlineMonitor),goog.provide("wd.core.PersistentConnection"),goog.require("wd.core.ServerActions"),goog.require("wd.core.util"),goog.require("wd.core.util.OnlineMonitor"),goog.require("wd.core.util.VisibilityMonitor"),goog.require("wd.login.util.environment"),goog.require("wd.realtime.Connection"),goog.require("wd.util.json"),goog.require("wd.util.jwt");var RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=3e5,RECONNECT_MAX_DELAY_FOR_ADMINS=3e4,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4;wd.core.PersistentConnection=function(e,t,o,r){this.id=wd.core.PersistentConnection.nextPersistentConnectionId_++,this.log_=wd.core.util.logWrapper("p:"+this.id+":"),this.interrupted_=!1,this.killed_=!1,this.listens_={},this.outstandingPuts_=[],this.outstandingPutCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.onDataUpdate_=t,this.onConnectStatus_=o,this.onServerInfoUpdate_=r,this.repoInfo_=e,this.securityDebugCallback_=null,this.requestCBHash_={},this.requestNumber_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,this.scheduleConnect_(0),wd.core.util.VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("wd.ocal")&&wd.core.util.OnlineMonitor.getInstance().on("online",this.onOnline_,this)},wd.core.PersistentConnection.nextPersistentConnectionId_=0,wd.core.PersistentConnection.nextConnectionId_=0,wd.core.PersistentConnection.prototype.sendRequest=function(e,t,o){var r=++this.requestNumber_,n={r:r,a:e,b:t};this.log_(wd.util.json.stringify(n)),wd.core.util.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(n),o&&(this.requestCBHash_[r]=o)},wd.core.PersistentConnection.prototype.listen=function(e,t,o,r){var n=e.queryIdentifier(),i=e.path.toString();this.log_("Listen called for "+i+" "+n),this.listens_[i]=this.listens_[i]||{},wd.core.util.assert(!this.listens_[i][n],"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:o};this.listens_[i][n]=a,this.connected_&&this.sendListen_(a)},wd.core.PersistentConnection.prototype.sendListen_=function(e){var t=e.query,o=t.path.toString(),r=t.queryIdentifier(),n=this;this.log_("Listen on "+o+" for "+r);var i={p:o},a="q";e.tag&&(i.q=t.queryObject(),i.t=e.tag),i.h=e.hashFn(),this.sendRequest(a,i,function(i){var a=i.d,s=i.s;n.warnOnListenWarnings_(a,t);var d=n.listens_[o]&&n.listens_[o][r];d===e&&(n.log_("listen response",i),"ok"!==s&&n.removeListen_(o,r),e.onComplete&&e.onComplete(s,a))})},wd.core.PersistentConnection.prototype.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&wd.util.obj.contains(e,"w")){var o=wd.util.obj.get(e,"w");if(goog.isArray(o)&&goog.array.contains(o,"no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',n=t.path.toString();wd.core.util.warn("Using an unspecified index. Consider adding "+r+" at "+n+" to your security rules for better performance")}}},wd.core.PersistentConnection.prototype.auth=function(e,t,o){this.credential_={cred:e,firstRequestSent:!1,callback:t,cancelCallback:o},this.log_("Authenticating using credential: "+e),this.tryAuth(),this.reduceReconnectDelayIfAdminCredential_(e)},wd.core.PersistentConnection.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t=40==e.length;(t||wd.util.jwt.isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)},wd.core.PersistentConnection.prototype.unauth=function(e){delete this.credential_,this.connected_&&this.sendRequest("unauth",{},function(t){var o=t.s,r=t.d;e(o,r)})},wd.core.PersistentConnection.prototype.tryAuth=function(){var e=this.credential_,t=this;if(this.connected_&&e){var o={cred:e.cred};this.sendRequest("auth",o,function(o){var r=o.s,n=o.d||"error";"ok"!==r&&t.credential_===e&&delete t.credential_,e.firstRequestSent?"ok"!==r&&e.cancelCallback&&e.cancelCallback(r,n):(e.firstRequestSent=!0,e.callback&&e.callback(r,n))})}},wd.core.PersistentConnection.prototype.unlisten=function(e,t){var o=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+o+" "+r);var n=this.removeListen_(o,r);n&&this.connected_&&this.sendUnlisten_(o,r,e.queryObject(),t)},wd.core.PersistentConnection.prototype.sendUnlisten_=function(e,t,o,r){this.log_("Unlisten on "+e+" for "+t);var n={p:e},i="n";r&&(n.q=o,n.t=r),this.sendRequest(i,n)},wd.core.PersistentConnection.prototype.onDisconnectPut=function(e,t,o){this.connected_?this.sendOnDisconnect_("o",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:o})},wd.core.PersistentConnection.prototype.onDisconnectMerge=function(e,t,o){this.connected_?this.sendOnDisconnect_("om",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:o})},wd.core.PersistentConnection.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},wd.core.PersistentConnection.prototype.sendOnDisconnect_=function(e,t,o,r){var n=this,i={p:t,d:o};n.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},wd.core.PersistentConnection.prototype.put=function(e,t,o,r){this.putInternal("p",e,t,o,r)},wd.core.PersistentConnection.prototype.merge=function(e,t,o,r){this.putInternal("m",e,t,o,r)},wd.core.PersistentConnection.prototype.putInternal=function(e,t,o,r,n){var i={p:t,d:o};goog.isDef(n)&&(i.h=n),this.outstandingPuts_.push({action:e,request:i,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)},wd.core.PersistentConnection.prototype.sendPut_=function(e){var t=this,o=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(o,r,function(r){t.log_(o+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),n&&n(r.s,r.d)})},wd.core.PersistentConnection.prototype.reportStats=function(e){if(this.connected_){var t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,function(e){var t=e.s;if("ok"!==t){var o=e.d;this.log_("reportStats","Error sending stats: "+o)}})}},wd.core.PersistentConnection.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+wd.util.json.stringify(e));var t=e.r,o=this.requestCBHash_[t];o&&(delete this.requestCBHash_[t],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},wd.core.PersistentConnection.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):wd.core.util.error("Unrecognized action received from server: "+wd.util.json.stringify(e)+"\nAre you using the latest client?")},wd.core.PersistentConnection.prototype.onReady_=function(e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},wd.core.PersistentConnection.prototype.scheduleConnect_=function(e){wd.core.util.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_);var t=this;this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},wd.core.PersistentConnection.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},wd.core.PersistentConnection.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},wd.core.PersistentConnection.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){var e=(new Date).getTime()-this.lastConnectionEstablishedTime_;e>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,o=Math.max(0,this.reconnectDelay_-t);o=Math.random()*o,this.log_("Trying to reconnect in "+o+"ms"),this.scheduleConnect_(o),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)},wd.core.PersistentConnection.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=goog.bind(this.onDataMessage_,this),t=goog.bind(this.onReady_,this),o=goog.bind(this.onRealtimeDisconnect_,this),r=this.id+":"+wd.core.PersistentConnection.nextConnectionId_++,n=this;this.realtime_=new wd.realtime.Connection(r,this.repoInfo_,e,t,o,function(e){wd.core.util.warn(e+" ("+n.repoInfo_.toString()+")"),n.killed_=!0})}},wd.core.PersistentConnection.prototype.interrupt=function(){this.interrupted_=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},wd.core.PersistentConnection.prototype.resume=function(){this.interrupted_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)},wd.core.PersistentConnection.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},wd.core.PersistentConnection.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},wd.core.PersistentConnection.prototype.onListenRevoked_=function(e,t){var o;o=t?goog.array.map(t,function(e){return wd.core.util.ObjectToUniqueKey(e)}).join("$"):"default";var r=this.removeListen_(e,o);r&&r.onComplete&&r.onComplete("permission_denied")},wd.core.PersistentConnection.prototype.removeListen_=function(e,t){var o,r=new wd.core.util.Path(e).toString();return goog.isDef(this.listens_[r])?(o=this.listens_[r][t],delete this.listens_[r][t],0===goog.object.getCount(this.listens_[r])&&delete this.listens_[r]):o=void 0,o},wd.core.PersistentConnection.prototype.onAuthRevoked_=function(e,t){var o=this.credential_;delete this.credential_,o&&o.cancelCallback&&o.cancelCallback(e,t)},wd.core.PersistentConnection.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&"undefined"!=typeof console&&console.log("WILDDOG: "+e.msg.replace("\n","\nWILDDOG: "))},wd.core.PersistentConnection.prototype.restoreState_=function(){this.tryAuth();var e=this;goog.object.forEach(this.listens_,function(t,o){goog.object.forEach(t,function(t){e.sendListen_(t)})});for(var t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){var o=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(o.action,o.pathString,o.data,o.onComplete)}},wd.core.PersistentConnection.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+CLIENT_VERSION.replace(/\./g,"-")]=1,wd.login.util.environment.isMobileCordova()&&(e["framework.cordova"]=1),this.reportStats(e)},wd.core.PersistentConnection.prototype.shouldReconnect_=function(){var e=wd.core.util.OnlineMonitor.getInstance().currentlyOnline();return!this.killed_&&!this.interrupted_&&e},goog.provide("wd.core.util.Tree"),goog.require("wd.core.util"),goog.require("wd.core.util.Path"),goog.require("wd.util.obj"),goog.require("goog.object"),wd.core.util.TreeNode=goog.defineClass(null,{constructor:function(){this.children={},this.childCount=0,this.value=null}}),wd.core.util.Tree=goog.defineClass(null,{constructor:function(e,t,o){this.name_=e?e:"",this.parent_=t?t:null,this.node_=o?o:new wd.core.util.TreeNode},subTree:function(e){for(var t,o=e instanceof wd.core.util.Path?e:new wd.core.util.Path(e),r=this;null!==(t=o.getFront());){var n=wd.util.obj.get(r.node_.children,t)||new wd.core.util.TreeNode;r=new wd.core.util.Tree(t,r,n),o=o.popFront()}return r},getValue:function(){return this.node_.value},setValue:function(e){wd.core.util.assert("undefined"!=typeof e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},clear:function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},hasChildren:function(){return this.node_.childCount>0},isEmpty:function(){return null===this.getValue()&&!this.hasChildren()},forEachChild:function(e){var t=this;goog.object.forEach(this.node_.children,function(o,r){e(new wd.core.util.Tree(r,t,o))})},forEachDescendant:function(e,t,o){t&&!o&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,o)}),t&&o&&e(this)},forEachAncestor:function(e,t){for(var o=t?this:this.parent();null!==o;){if(e(o))return!0;o=o.parent()}return!1},forEachImmediateDescendantWithValue:function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},path:function(){return new wd.core.util.Path(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},name:function(){return this.name_},parent:function(){return this.parent_},updateParents_:function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},updateChild_:function(e,t){var o=t.isEmpty(),r=wd.util.obj.contains(this.node_.children,e);o&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):o||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())}}),goog.provide("wd.core.Repo"),goog.require("wd.api.DataSnapshot"),goog.require("wd.core.PersistentConnection"),goog.require("wd.core.ReadonlyRestClient"),goog.require("wd.core.SnapshotHolder"),goog.require("wd.core.SparseSnapshotTree"),goog.require("wd.core.SyncTree"),goog.require("wd.core.stats.StatsCollection"),goog.require("wd.core.stats.StatsListener"),goog.require("wd.core.stats.StatsManager"),goog.require("wd.core.stats.StatsReporter"),goog.require("wd.core.util"),goog.require("wd.core.util.ServerValues"),goog.require("wd.core.util.Tree"),goog.require("wd.core.view.EventQueue"),goog.require("wd.login.AuthenticationManager"),goog.require("wd.util.json"),goog.require("wd.util.jwt"),goog.require("goog.string"),wd.core.Repo=function(e,t){this.repoInfo_=e,this.stats_=wd.core.stats.StatsManager.getCollection(e),this.eventQueue_=new wd.core.view.EventQueue,this.nextWriteId_=1,this.persistentConnection_=null,this.server_,t||wd.core.util.beingCrawled()?(this.server_=new wd.core.ReadonlyRestClient(this.repoInfo_,goog.bind(this.onDataUpdate_,this)),setTimeout(goog.bind(this.onConnectStatus_,this,!0),0)):(this.persistentConnection_=new wd.core.PersistentConnection(this.repoInfo_,goog.bind(this.onDataUpdate_,this),goog.bind(this.onConnectStatus_,this),goog.bind(this.onServerInfoUpdate_,this)),this.server_=this.persistentConnection_),this.statsReporter_=wd.core.stats.StatsManager.getOrCreateReporter(e,goog.bind(function(){return new wd.core.stats.StatsReporter(this.stats_,this.server_)},this)),this.transactions_init_(),this.infoData_=new wd.core.SnapshotHolder;var o=this;this.infoSyncTree_=new wd.core.SyncTree({startListening:function(e,t,r,n){var i=[],a=o.infoData_.getNode(e.path);return a.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(e.path,a),setTimeout(function(){n("ok")},0)),i},stopListening:goog.nullFunction}),this.updateInfo_("connected",!1),this.onDisconnect_=new wd.core.SparseSnapshotTree,this.auth=new wd.login.AuthenticationManager(e,goog.bind(this.server_.auth,this.server_),goog.bind(this.server_.unauth,this.server_),goog.bind(this.onAuthStatus_,this)),this.dataUpdateCount=0,this.interceptServerDataCallback_=null,this.serverSyncTree_=new wd.core.SyncTree({startListening:function(e,t,r,n){return o.server_.listen(e,r,t,function(t,r){var i=n(t,r);o.eventQueue_.raiseEventsForChangedPath(e.path,i)}),[]},stopListening:function(e,t){o.server_.unlisten(e,t)}})},wd.core.Repo.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},wd.core.Repo.prototype.name=function(){return this.repoInfo_.namespace},wd.core.Repo.prototype.serverTime=function(){var e=this.infoData_.getNode(new wd.core.util.Path(".info/serverTimeOffset")),t=e.val()||0;return(new Date).getTime()+t},wd.core.Repo.prototype.generateServerValues=function(){return wd.core.util.ServerValues.generateWithValues({timestamp:this.serverTime()})},wd.core.Repo.prototype.onDataUpdate_=function(e,t,o,r){this.dataUpdateCount++;var n=new wd.core.util.Path(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var i=[];if(r)if(o){var a=goog.object.map(t,function(e){return wd.core.snap.NodeFromJSON(e)});i=this.serverSyncTree_.applyTaggedQueryMerge(n,a,r)}else{var s=wd.core.snap.NodeFromJSON(t);i=this.serverSyncTree_.applyTaggedQueryOverwrite(n,s,r)}else if(o){var d=goog.object.map(t,function(e){return wd.core.snap.NodeFromJSON(e)});i=this.serverSyncTree_.applyServerMerge(n,d)}else{var l=wd.core.snap.NodeFromJSON(t);i=this.serverSyncTree_.applyServerOverwrite(n,l)}var g=n;i.length>0&&(g=this.rerunTransactions_(n)),this.eventQueue_.raiseEventsForChangedPath(g,i)},wd.core.Repo.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},wd.core.Repo.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),e===!1&&this.runOnDisconnectEvents_()},wd.core.Repo.prototype.onServerInfoUpdate_=function(e){var t=this;wd.core.util.each(e,function(e,o){t.updateInfo_(o,e)})},wd.core.Repo.prototype.onAuthStatus_=function(e){this.updateInfo_("authenticated",e)},wd.core.Repo.prototype.updateInfo_=function(e,t){var o=new wd.core.util.Path("/.info/"+e),r=wd.core.snap.NodeFromJSON(t);this.infoData_.updateSnapshot(o,r);var n=this.infoSyncTree_.applyServerOverwrite(o,r);this.eventQueue_.raiseEventsForChangedPath(o,n)},wd.core.Repo.prototype.getNextWriteId_=function(){return this.nextWriteId_++},wd.core.Repo.prototype.setWithPriority=function(e,t,o,r){this.log_("set",{path:e.toString(),value:t,priority:o});var n=this.generateServerValues(),i=wd.core.snap.NodeFromJSON(t,o),a=wd.core.util.ServerValues.resolveDeferredValueSnapshot(i,n),s=this.getNextWriteId_(),d=this.serverSyncTree_.applyUserOverwrite(e,a,s,!0);this.eventQueue_.queueEvents(d);var l=this;this.server_.put(e.toString(),i.val(!0),function(t,o){var n="ok"===t;n||wd.core.util.warn("set at "+e+" failed: "+t);var i=l.serverSyncTree_.ackUserWrite(s,!n);l.eventQueue_.raiseEventsForChangedPath(e,i),l.callOnCompleteCallback(r,t,o)});var g=this.abortTransactions_(e);this.rerunTransactions_(g),this.eventQueue_.raiseEventsForChangedPath(g,[])},wd.core.Repo.prototype.update=function(e,t,o){this.log_("update",{path:e.toString(),value:t});var r=!0,n=this.generateServerValues(),i={};if(goog.object.forEach(t,function(e,t){r=!1;var o=wd.core.snap.NodeFromJSON(e);i[t]=wd.core.util.ServerValues.resolveDeferredValueSnapshot(o,n)}),r)wd.core.util.log("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(o,"ok");else{var a=this.getNextWriteId_(),s=this.serverSyncTree_.applyUserMerge(e,i,a);this.eventQueue_.queueEvents(s);var d=this;this.server_.merge(e.toString(),t,function(t,r){var n="ok"===t;n||wd.core.util.warn("update at "+e+" failed: "+t);var i=d.serverSyncTree_.ackUserWrite(a,!n),s=e;i.length>0&&(s=d.rerunTransactions_(e)),d.eventQueue_.raiseEventsForChangedPath(s,i),d.callOnCompleteCallback(o,t,r)});var l=this.abortTransactions_(e);this.rerunTransactions_(l),this.eventQueue_.raiseEventsForChangedPath(e,[])}},wd.core.Repo.prototype.runOnDisconnectEvents_=function(){this.log_("onDisconnectEvents");var e=this,t=this.generateServerValues(),o=wd.core.util.ServerValues.resolveDeferredValueTree(this.onDisconnect_,t),r=[];o.forEachTree(wd.core.util.Path.Empty,function(t,o){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,o));var n=e.abortTransactions_(t);e.rerunTransactions_(n)}),this.onDisconnect_=new wd.core.SparseSnapshotTree,this.eventQueue_.raiseEventsForChangedPath(wd.core.util.Path.Empty,r)},wd.core.Repo.prototype.onDisconnectCancel=function(e,t){var o=this;this.server_.onDisconnectCancel(e.toString(),function(r,n){"ok"===r&&o.onDisconnect_.forget(e),o.callOnCompleteCallback(t,r,n)})},wd.core.Repo.prototype.onDisconnectSet=function(e,t,o){var r=this,n=wd.core.snap.NodeFromJSON(t);this.server_.onDisconnectPut(e.toString(),n.val(!0),function(t,i){
"ok"===t&&r.onDisconnect_.remember(e,n),r.callOnCompleteCallback(o,t,i)})},wd.core.Repo.prototype.onDisconnectSetWithPriority=function(e,t,o,r){var n=this,i=wd.core.snap.NodeFromJSON(t,o);this.server_.onDisconnectPut(e.toString(),i.val(!0),function(t,o){"ok"===t&&n.onDisconnect_.remember(e,i),n.callOnCompleteCallback(r,t,o)})},wd.core.Repo.prototype.onDisconnectUpdate=function(e,t,o){var r=!0;for(var n in t)r=!1;if(r)return wd.core.util.log("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(o,"ok");var i=this;this.server_.onDisconnectMerge(e.toString(),t,function(r,n){if("ok"===r)for(var a in t){var s=wd.core.snap.NodeFromJSON(t[a]);i.onDisconnect_.remember(e.child(a),s)}i.callOnCompleteCallback(o,r,n)})},wd.core.Repo.prototype.addEventCallbackForQuery=function(e,t){var o;o=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,o)},wd.core.Repo.prototype.removeEventCallbackForQuery=function(e,t){var o;o=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,o)},wd.core.Repo.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt()},wd.core.Repo.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume()},wd.core.Repo.prototype.stats=function(e){if("undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new wd.core.stats.StatsListener(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var o=goog.array.reduce(goog.object.getKeys(t),function(e,t,o,r){return Math.max(t.length,e)},0);for(var r in t){for(var n=t[r],i=r.length;o+2>i;i++)r+=" ";console.log(r+n)}}},wd.core.Repo.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},wd.core.Repo.prototype.log_=function(e){var t="";this.persistentConnection_&&(t=this.persistentConnection_.id+":"),wd.core.util.log(t,arguments)},wd.core.Repo.prototype.callOnCompleteCallback=function(e,t,o){e&&wd.core.util.exceptionGuard(function(){if("ok"==t)e(null);else{var r=(t||"error").toUpperCase(),n=r;o&&(n+=": "+o);var i=new Error(n);i.code=r,e(i)}})},goog.provide("wd.api.TEST_ACCESS"),goog.require("wd.core.PersistentConnection"),wd.api.TEST_ACCESS.DataConnection=wd.core.PersistentConnection,goog.exportProperty(wd.api.TEST_ACCESS,"DataConnection",wd.api.TEST_ACCESS.DataConnection),wd.core.PersistentConnection.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},goog.exportProperty(wd.api.TEST_ACCESS.DataConnection.prototype,"simpleListen",wd.api.TEST_ACCESS.DataConnection.prototype.simpleListen),wd.core.PersistentConnection.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},goog.exportProperty(wd.api.TEST_ACCESS.DataConnection.prototype,"echo",wd.api.TEST_ACCESS.DataConnection.prototype.echo),goog.exportProperty(wd.core.PersistentConnection.prototype,"interrupt",wd.core.PersistentConnection.prototype.interrupt),wd.api.TEST_ACCESS.RealTimeConnection=wd.realtime.Connection,goog.exportProperty(wd.api.TEST_ACCESS,"RealTimeConnection",wd.api.TEST_ACCESS.RealTimeConnection),goog.exportProperty(wd.realtime.Connection.prototype,"sendRequest",wd.realtime.Connection.prototype.sendRequest),goog.exportProperty(wd.realtime.Connection.prototype,"close",wd.realtime.Connection.prototype.close),wd.api.TEST_ACCESS.hijackHash=function(e){var t=wd.core.PersistentConnection.prototype.put;return wd.core.PersistentConnection.prototype.put=function(o,r,n,i){goog.isDef(i)&&(i=e()),t.call(this,o,r,n,i)},function(){wd.core.PersistentConnection.prototype.put=t}},goog.exportProperty(wd.api.TEST_ACCESS,"hijackHash",wd.api.TEST_ACCESS.hijackHash),wd.api.TEST_ACCESS.ConnectionTarget=wd.core.RepoInfo,goog.exportProperty(wd.api.TEST_ACCESS,"ConnectionTarget",wd.api.TEST_ACCESS.ConnectionTarget),wd.api.TEST_ACCESS.queryIdentifier=function(e){return e.queryIdentifier()},goog.exportProperty(wd.api.TEST_ACCESS,"queryIdentifier",wd.api.TEST_ACCESS.queryIdentifier),wd.api.TEST_ACCESS.listens=function(e){return e.repo.persistentConnection_.listens_},goog.exportProperty(wd.api.TEST_ACCESS,"listens",wd.api.TEST_ACCESS.listens),wd.api.TEST_ACCESS.forceRestClient=function(e){e.forceRestClient()},goog.exportProperty(wd.api.TEST_ACCESS,"forceRestClient",wd.api.TEST_ACCESS.forceRestClient),goog.provide("wd.core.Repo_transaction"),goog.require("wd.core.Repo"),goog.require("wd.core.snap.PriorityIndex"),goog.require("wd.core.util"),wd.core.TransactionStatus={RUN:1,SENT:2,COMPLETED:3,SENT_NEEDS_ABORT:4,NEEDS_ABORT:5},wd.core.Repo.MAX_TRANSACTION_RETRIES_=25,wd.core.Transaction,wd.core.Repo.prototype.transactions_init_=function(){this.transactionQueueTree_=new wd.core.util.Tree},wd.core.Repo.prototype.startTransaction=function(e,t,o,r){this.log_("transaction on "+e);var n=function(){},i=new Wilddog(this,e);i.on("value",n);var a=function(){i.off("value",n)},s={path:e,update:t,onComplete:o,status:null,order:wd.core.util.LUIDGenerator(),applyLocally:r,retryCount:0,unwatcher:a,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},d=this.getLatestState_(e);s.currentInputSnapshot=d;var l=s.update(d.val());if(goog.isDef(l)){wd.core.util.validation.validateWilddogData("transaction failed: Data returned ",l,s.path),s.status=wd.core.TransactionStatus.RUN;var g=this.transactionQueueTree_.subTree(e),u=g.getValue()||[];u.push(s),g.setValue(u);var c;if("object"==typeof l&&null!==l&&wd.util.obj.contains(l,".priority"))c=wd.util.obj.get(l,".priority"),wd.core.util.assert(wd.core.util.validation.isValidPriority(c),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{var p=this.serverSyncTree_.calcCompleteEventCache(e)||wd.core.snap.EMPTY_NODE;c=p.getPriority().val()}c=c;var h=this.generateServerValues(),w=wd.core.snap.NodeFromJSON(l,c),f=wd.core.util.ServerValues.resolveDeferredValueSnapshot(w,h);s.currentOutputSnapshotRaw=w,s.currentOutputSnapshotResolved=f,s.currentWriteId=this.getNextWriteId_();var _=this.serverSyncTree_.applyUserOverwrite(e,f,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,_),this.sendReadyTransactions_()}else if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var v=new wd.api.DataSnapshot(s.currentInputSnapshot,new Wilddog(this,s.path),wd.core.snap.PriorityIndex);s.onComplete(null,!1,v)}},wd.core.Repo.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||wd.core.snap.EMPTY_NODE},wd.core.Repo.prototype.sendReadyTransactions_=function(e){var t=e||this.transactionQueueTree_;if(e||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var o=this.buildTransactionQueue_(t);wd.core.util.assert(o.length>0,"Sending zero length transaction queue");var r=goog.array.every(o,function(e){return e.status===wd.core.TransactionStatus.RUN});r&&this.sendTransactionQueue_(t.path(),o)}else if(t.hasChildren()){var n=this;t.forEachChild(function(e){n.sendReadyTransactions_(e)})}},wd.core.Repo.prototype.sendTransactionQueue_=function(e,t){for(var o=goog.array.map(t,function(e){return e.currentWriteId}),r=this.getLatestState_(e,o),n=r,i=r.hash(),a=0;a<t.length;a++){var s=t[a];wd.core.util.assert(s.status===wd.core.TransactionStatus.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=wd.core.TransactionStatus.SENT,s.retryCount++;var d=wd.core.util.Path.relativePath(e,s.path);n=n.updateChild(d,s.currentOutputSnapshotRaw)}var l=n.val(!0),g=e,u=this;this.server_.put(g.toString(),l,function(o){u.log_("transaction put response",{path:g.toString(),status:o});var r=[];if("ok"===o){var n=[];for(a=0;a<t.length;a++){if(t[a].status=wd.core.TransactionStatus.COMPLETED,r=r.concat(u.serverSyncTree_.ackUserWrite(t[a].currentWriteId)),t[a].onComplete){var i=t[a].currentOutputSnapshotResolved,s=new Wilddog(u,t[a].path),d=new wd.api.DataSnapshot(i,s,wd.core.snap.PriorityIndex);n.push(goog.bind(t[a].onComplete,null,null,!0,d))}t[a].unwatcher()}for(u.pruneCompletedTransactionsBelowNode_(u.transactionQueueTree_.subTree(e)),u.sendReadyTransactions_(),u.eventQueue_.raiseEventsForChangedPath(e,r),a=0;a<n.length;a++)wd.core.util.exceptionGuard(n[a])}else{if("datastale"===o)for(a=0;a<t.length;a++)t[a].status===wd.core.TransactionStatus.SENT_NEEDS_ABORT?t[a].status=wd.core.TransactionStatus.NEEDS_ABORT:t[a].status=wd.core.TransactionStatus.RUN;else for(wd.core.util.warn("transaction at "+g.toString()+" failed: "+o),a=0;a<t.length;a++)t[a].status=wd.core.TransactionStatus.NEEDS_ABORT,t[a].abortReason=o;u.rerunTransactions_(e)}},i)},wd.core.Repo.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),o=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,o),o},wd.core.Repo.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var o=[],r=[],n=goog.array.map(e,function(e){return e.currentWriteId}),i=0;i<e.length;i++){var a,s=e[i],d=wd.core.util.Path.relativePath(t,s.path),l=!1;if(wd.core.util.assert(null!==d,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===wd.core.TransactionStatus.NEEDS_ABORT)l=!0,a=s.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===wd.core.TransactionStatus.RUN)if(s.retryCount>=wd.core.Repo.MAX_TRANSACTION_RETRIES_)l=!0,a="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var g=this.getLatestState_(s.path,n);s.currentInputSnapshot=g;var u=e[i].update(g.val());if(goog.isDef(u)){wd.core.util.validation.validateWilddogData("transaction failed: Data returned ",u,s.path);var c=wd.core.snap.NodeFromJSON(u),p="object"==typeof u&&null!=u&&wd.util.obj.contains(u,".priority");p||(c=c.updatePriority(g.getPriority()));var h=s.currentWriteId,w=this.generateServerValues(),f=wd.core.util.ServerValues.resolveDeferredValueSnapshot(c,w);s.currentOutputSnapshotRaw=c,s.currentOutputSnapshotResolved=f,s.currentWriteId=this.getNextWriteId_(),goog.array.remove(n,h),r=r.concat(this.serverSyncTree_.applyUserOverwrite(s.path,f,s.currentWriteId,s.applyLocally)),r=r.concat(this.serverSyncTree_.ackUserWrite(h,!0))}else l=!0,a="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,r),r=[],l&&(e[i].status=wd.core.TransactionStatus.COMPLETED,function(e){setTimeout(e,Math.floor(0))}(e[i].unwatcher),e[i].onComplete))if("nodata"===a){var _=new Wilddog(this,e[i].path),v=e[i].currentInputSnapshot,y=new wd.api.DataSnapshot(v,_,wd.core.snap.PriorityIndex);o.push(goog.bind(e[i].onComplete,null,null,!1,y))}else o.push(goog.bind(e[i].onComplete,null,new Error(a),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),i=0;i<o.length;i++)wd.core.util.exceptionGuard(o[i]);this.sendReadyTransactions_()}},wd.core.Repo.prototype.getAncestorTransactionNode_=function(e){for(var t,o=this.transactionQueueTree_;null!==(t=e.getFront())&&null===o.getValue();)o=o.subTree(t),e=e.popFront();return o},wd.core.Repo.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort(function(e,t){return e.order-t.order}),t},wd.core.Repo.prototype.aggregateTransactionQueuesForNode_=function(e,t){var o=e.getValue();if(null!==o)for(var r=0;r<o.length;r++)t.push(o[r]);var n=this;e.forEachChild(function(e){n.aggregateTransactionQueuesForNode_(e,t)})},wd.core.Repo.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=e.getValue();if(t){for(var o=0,r=0;r<t.length;r++)t[r].status!==wd.core.TransactionStatus.COMPLETED&&(t[o]=t[r],o++);t.length=o,e.setValue(t.length>0?t:null)}var n=this;e.forEachChild(function(e){n.pruneCompletedTransactionsBelowNode_(e)})},wd.core.Repo.prototype.abortTransactions_=function(e){var t=this.getAncestorTransactionNode_(e).path(),o=this.transactionQueueTree_.subTree(e),r=this;return o.forEachAncestor(function(e){r.abortTransactionsOnNode_(e)}),this.abortTransactionsOnNode_(o),o.forEachDescendant(function(e){r.abortTransactionsOnNode_(e)}),t},wd.core.Repo.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var o=[],r=[],n=-1,i=0;i<t.length;i++)if(t[i].status===wd.core.TransactionStatus.SENT_NEEDS_ABORT);else if(t[i].status===wd.core.TransactionStatus.SENT)wd.core.util.assert(n===i-1,"All SENT items should be at beginning of queue."),n=i,t[i].status=wd.core.TransactionStatus.SENT_NEEDS_ABORT,t[i].abortReason="set";else if(wd.core.util.assert(t[i].status===wd.core.TransactionStatus.RUN,"Unexpected transaction status in abort"),t[i].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[i].currentWriteId,!0)),t[i].onComplete){var a=null;o.push(goog.bind(t[i].onComplete,null,new Error("set"),!1,a))}for(-1===n?e.setValue(null):t.length=n+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r),i=0;i<o.length;i++)wd.core.util.exceptionGuard(o[i])}},goog.provide("wd.core.RepoManager"),goog.require("wd.core.Repo"),goog.require("wd.core.Repo_transaction"),goog.require("wd.util.obj"),wd.core.RepoManager=function(){this.repos_={},this.useRestClient_=!1},goog.addSingletonGetter(wd.core.RepoManager),wd.core.RepoManager.prototype.interrupt=function(){for(var e in this.repos_)this.repos_[e].interrupt()},goog.exportProperty(wd.core.RepoManager.prototype,"interrupt",wd.core.RepoManager.prototype.interrupt),wd.core.RepoManager.prototype.resume=function(){for(var e in this.repos_)this.repos_[e].resume()},goog.exportProperty(wd.core.RepoManager.prototype,"resume",wd.core.RepoManager.prototype.resume),wd.core.RepoManager.prototype.getRepo=function(e){var t=e.toString(),o=wd.util.obj.get(this.repos_,t);return o||(o=new wd.core.Repo(e,this.useRestClient_),this.repos_[t]=o),o},wd.core.RepoManager.prototype.forceRestClient=function(){this.useRestClient_=!0},goog.provide("wd.core.util.nextPushId"),goog.require("wd.core.util"),wd.core.util.nextPushId=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",t=0,o=[];return function(r){var n=r===t;t=r;for(var i=new Array(8),a=7;a>=0;a--)i[a]=e.charAt(r%64),r=Math.floor(r/64);wd.core.util.assert(0===r,"Cannot push at time == 0");var s=i.join("");if(n){for(a=11;a>=0&&63===o[a];a--)o[a]=0;o[a]++}else for(a=0;12>a;a++)o[a]=Math.floor(64*Math.random());for(a=0;12>a;a++)s+=e.charAt(o[a]);return wd.core.util.assert(20===s.length,"nextPushId: Length should be 20."),s}}(),goog.provide("wd.core.view.filter.IndexedFilter"),goog.require("wd.core.util"),wd.core.view.filter.IndexedFilter=function(e){this.index_=e},wd.core.view.filter.IndexedFilter.prototype.updateChild=function(e,t,o,r,n){var i=wd.core.view.Change;wd.core.util.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.equals(o)?e:(null!=n&&(o.isEmpty()?e.hasChild(t)?n.trackChildChange(i.childRemovedChange(t,a)):wd.core.util.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?n.trackChildChange(i.childAddedChange(t,o)):n.trackChildChange(i.childChangedChange(t,o,a))),e.isLeafNode()&&o.isEmpty()?e:e.updateImmediateChild(t,o).withIndex(this.index_))},wd.core.view.filter.IndexedFilter.prototype.updateFullNode=function(e,t,o){var r=wd.core.view.Change;return null!=o&&(e.isLeafNode()||e.forEachChild(wd.core.snap.PriorityIndex,function(e,n){t.hasChild(e)||o.trackChildChange(r.childRemovedChange(e,n))}),t.isLeafNode()||t.forEachChild(wd.core.snap.PriorityIndex,function(t,n){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(n)||o.trackChildChange(r.childChangedChange(t,n,i))}else o.trackChildChange(r.childAddedChange(t,n))})),t.withIndex(this.index_)},wd.core.view.filter.IndexedFilter.prototype.updatePriority=function(e,t){return e.isEmpty()?wd.core.snap.EMPTY_NODE:e.updatePriority(t)},wd.core.view.filter.IndexedFilter.prototype.filtersNodes=function(){return!1},wd.core.view.filter.IndexedFilter.prototype.getIndexedFilter=function(){return this},wd.core.view.filter.IndexedFilter.prototype.getIndex=function(){return this.index_},goog.provide("wd.core.view.filter.RangedFilter"),goog.require("wd.core.view.filter.IndexedFilter"),wd.core.view.filter.RangedFilter=function(e){this.indexedFilter_=new wd.core.view.filter.IndexedFilter(e.getIndex()),this.index_=e.getIndex(),this.startPost_=this.getStartPost_(e),this.endPost_=this.getEndPost_(e)},wd.core.view.filter.RangedFilter.prototype.getStartPost=function(){return this.startPost_},wd.core.view.filter.RangedFilter.prototype.getEndPost=function(){return this.endPost_},wd.core.view.filter.RangedFilter.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},wd.core.view.filter.RangedFilter.prototype.updateChild=function(e,t,o,r,n){return this.matches(new wd.core.snap.NamedNode(t,o))||(o=wd.core.snap.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,o,r,n)},wd.core.view.filter.RangedFilter.prototype.updateFullNode=function(e,t,o){t.isLeafNode()&&(t=wd.core.snap.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(wd.core.snap.EMPTY_NODE);var n=this;return t.forEachChild(wd.core.snap.PriorityIndex,function(e,t){n.matches(new wd.core.snap.NamedNode(e,t))||(r=r.updateImmediateChild(e,wd.core.snap.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,o)},wd.core.view.filter.RangedFilter.prototype.updatePriority=function(e,t){return e},wd.core.view.filter.RangedFilter.prototype.filtersNodes=function(){return!0},wd.core.view.filter.RangedFilter.prototype.getIndexedFilter=function(){return this.indexedFilter_},wd.core.view.filter.RangedFilter.prototype.getIndex=function(){return this.index_},wd.core.view.filter.RangedFilter.prototype.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},wd.core.view.filter.RangedFilter.prototype.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},goog.provide("wd.core.view.filter.LimitedFilter"),goog.require("wd.core.snap.NamedNode"),goog.require("wd.core.view.filter.RangedFilter"),goog.require("wd.core.util"),wd.core.view.filter.LimitedFilter=function(e){this.rangedFilter_=new wd.core.view.filter.RangedFilter(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()},wd.core.view.filter.LimitedFilter.prototype.updateChild=function(e,t,o,r,n){return this.rangedFilter_.matches(new wd.core.snap.NamedNode(t,o))||(o=wd.core.snap.EMPTY_NODE),e.getImmediateChild(t).equals(o)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,o,r,n):this.fullLimitUpdateChild_(e,t,o,r,n)},wd.core.view.filter.LimitedFilter.prototype.updateFullNode=function(e,t,o){var r;if(t.isLeafNode()||t.isEmpty())r=wd.core.snap.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=wd.core.snap.EMPTY_NODE.withIndex(this.index_);var n;t=t,n=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var i=0;n.hasNext()&&i<this.limit_;){var a,s=n.getNext();if(a=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0,!a)break;r=r.updateImmediateChild(s.name,s.node),i++}}else{r=t.withIndex(this.index_),r=r.updatePriority(wd.core.snap.EMPTY_NODE);var d,l,g;if(this.reverse_){n=r.getReverseIterator(this.index_),d=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost();var u=this.index_.getCompare();g=function(e,t){return u(t,e)}}else n=r.getIterator(this.index_),d=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),g=this.index_.getCompare();i=0;for(var c=!1;n.hasNext();)s=n.getNext(),!c&&g(d,s)<=0&&(c=!0),a=c&&i<this.limit_&&g(s,l)<=0,a?i++:r=r.updateImmediateChild(s.name,wd.core.snap.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,o)},wd.core.view.filter.LimitedFilter.prototype.updatePriority=function(e,t){return e},wd.core.view.filter.LimitedFilter.prototype.filtersNodes=function(){return!0},wd.core.view.filter.LimitedFilter.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},wd.core.view.filter.LimitedFilter.prototype.getIndex=function(){return this.index_},wd.core.view.filter.LimitedFilter.prototype.fullLimitUpdateChild_=function(e,t,o,r,n){var i,a=wd.core.view.Change;if(this.reverse_){var s=this.index_.getCompare();i=function(e,t){return s(t,e)}}else i=this.index_.getCompare();var d=e;wd.core.util.assert(d.numChildren()==this.limit_,"");var l=new wd.core.snap.NamedNode(t,o),g=this.reverse_?d.getFirstChild(this.index_):d.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(d.hasChild(t)){var c=d.getImmediateChild(t),p=r.getChildAfterChild(this.index_,g,this.reverse_);null!=p&&p.name==t&&(p=r.getChildAfterChild(this.index_,p,this.reverse_));var h=null==p?1:i(p,l),w=u&&!o.isEmpty()&&h>=0;if(w)return null!=n&&n.trackChildChange(a.childChangedChange(t,o,c)),d.updateImmediateChild(t,o);null!=n&&n.trackChildChange(a.childRemovedChange(t,c));var f=d.updateImmediateChild(t,wd.core.snap.EMPTY_NODE),_=null!=p&&this.rangedFilter_.matches(p);return _?(null!=n&&n.trackChildChange(a.childAddedChange(p.name,p.node)),f.updateImmediateChild(p.name,p.node)):f}return o.isEmpty()?e:u&&i(g,l)>=0?(null!=n&&(n.trackChildChange(a.childRemovedChange(g.name,g.node)),n.trackChildChange(a.childAddedChange(t,o))),d.updateImmediateChild(t,o).updateImmediateChild(g.name,wd.core.snap.EMPTY_NODE)):e},goog.provide("wd.core.view.ChildChangeAccumulator"),goog.require("wd.core.util"),wd.core.view.ChildChangeAccumulator=function(){this.changeMap_={}},wd.core.view.ChildChangeAccumulator.prototype.trackChildChange=function(e){var t=wd.core.view.Change,o=e.type,r=e.childName;wd.core.util.assert(o==wd.core.view.Change.CHILD_ADDED||o==wd.core.view.Change.CHILD_CHANGED||o==wd.core.view.Change.CHILD_REMOVED,"Only child changes supported for tracking"),wd.core.util.assert(".priority"!==r,"Only non-priority child changes can be tracked.");var n=wd.util.obj.get(this.changeMap_,r);if(n){var i=n.type;if(o==t.CHILD_ADDED&&i==t.CHILD_REMOVED)this.changeMap_[r]=t.childChangedChange(r,e.snapshotNode,n.snapshotNode);else if(o==t.CHILD_REMOVED&&i==t.CHILD_ADDED)delete this.changeMap_[r];else if(o==t.CHILD_REMOVED&&i==t.CHILD_CHANGED)this.changeMap_[r]=t.childRemovedChange(r,n.oldSnap);else if(o==t.CHILD_CHANGED&&i==t.CHILD_ADDED)this.changeMap_[r]=t.childAddedChange(r,e.snapshotNode);else{if(o!=t.CHILD_CHANGED||i!=t.CHILD_CHANGED)throw wd.core.util.assertionError("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap_[r]=t.childChangedChange(r,e.snapshotNode,n.oldSnap)}}else this.changeMap_[r]=e},wd.core.view.ChildChangeAccumulator.prototype.getChanges=function(){return goog.object.getValues(this.changeMap_)},goog.provide("wd.core.view.filter.NodeFilter"),goog.require("wd.core.view.ChildChangeAccumulator"),goog.require("wd.core.view.CompleteChildSource"),wd.core.view.filter.NodeFilter=function(){},wd.core.view.filter.NodeFilter.prototype.updateChild=function(e,t,o,r,n){},wd.core.view.filter.NodeFilter.prototype.updateFullNode=function(e,t,o){},wd.core.view.filter.NodeFilter.prototype.updatePriority=function(e,t){},wd.core.view.filter.NodeFilter.prototype.filtersNodes=function(){},wd.core.view.filter.NodeFilter.prototype.getIndexedFilter=function(){},wd.core.view.filter.NodeFilter.prototype.getIndex=function(){},goog.provide("wd.core.view.QueryParams"),goog.require("wd.core.snap.Index"),goog.require("wd.core.snap.PriorityIndex"),goog.require("wd.core.util"),goog.require("wd.core.view.filter.IndexedFilter"),goog.require("wd.core.view.filter.LimitedFilter"),goog.require("wd.core.view.filter.NodeFilter"),goog.require("wd.core.view.filter.RangedFilter"),wd.core.view.QueryParams=function(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=wd.core.snap.PriorityIndex},wd.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},wd.core.view.QueryParams.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},wd.core.view.QueryParams.DEFAULT=new wd.core.view.QueryParams,wd.core.view.QueryParams.prototype.hasStart=function(){return this.startSet_},wd.core.view.QueryParams.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===wd.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},wd.core.view.QueryParams.prototype.getIndexStartValue=function(){return wd.core.util.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},wd.core.view.QueryParams.prototype.getIndexStartName=function(){return wd.core.util.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:wd.core.util.MIN_NAME},wd.core.view.QueryParams.prototype.hasEnd=function(){return this.endSet_},wd.core.view.QueryParams.prototype.getIndexEndValue=function(){return wd.core.util.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},wd.core.view.QueryParams.prototype.getIndexEndName=function(){return wd.core.util.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:wd.core.util.MAX_NAME},wd.core.view.QueryParams.prototype.hasLimit=function(){return this.limitSet_},wd.core.view.QueryParams.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},wd.core.view.QueryParams.prototype.getLimit=function(){return wd.core.util.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},wd.core.view.QueryParams.prototype.getIndex=function(){return this.index_},wd.core.view.QueryParams.prototype.copy_=function(){var e=new wd.core.view.QueryParams;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e},wd.core.view.QueryParams.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},wd.core.view.QueryParams.prototype.limitToFirst=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=wd.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,t},wd.core.view.QueryParams.prototype.limitToLast=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=wd.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,t},wd.core.view.QueryParams.prototype.startAt=function(e,t){var o=this.copy_();return o.startSet_=!0,goog.isDef(e)||(e=null),o.indexStartValue_=e,null!=t?(o.startNameSet_=!0,o.indexStartName_=t):(o.startNameSet_=!1,o.indexStartName_=""),o},wd.core.view.QueryParams.prototype.endAt=function(e,t){var o=this.copy_();return o.endSet_=!0,goog.isDef(e)||(e=null),o.indexEndValue_=e,goog.isDef(t)?(o.endNameSet_=!0,o.indexEndName_=t):(o.startEndSet_=!1,o.indexEndName_=""),o},wd.core.view.QueryParams.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},wd.core.view.QueryParams.prototype.getQueryObject=function(){var e=wd.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_,t={};if(this.startSet_&&(t[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(t[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(t[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(t[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){t[e.LIMIT]=this.limit_;var o=this.viewFrom_;""===o&&(o=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),t[e.VIEW_FROM]=o}return this.index_!==wd.core.snap.PriorityIndex&&(t[e.INDEX]=this.index_.toString()),t},wd.core.view.QueryParams.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},wd.core.view.QueryParams.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==wd.core.snap.PriorityIndex},wd.core.view.QueryParams.prototype.getNodeFilter=function(){return this.loadsAllData()?new wd.core.view.filter.IndexedFilter(this.getIndex()):this.hasLimit()?new wd.core.view.filter.LimitedFilter(this):new wd.core.view.filter.RangedFilter(this)},wd.core.view.QueryParams.prototype.toRestQueryStringParameters=function(){var e=wd.core.view.QueryParams.REST_QUERY_CONSTANTS_,t={};if(this.isDefault())return t;var o;return this.index_===wd.core.snap.PriorityIndex?o=e.PRIORITY_INDEX:this.index_===wd.core.snap.ValueIndex?o=e.VALUE_INDEX:this.index_===wd.core.snap.KeyIndex?o=e.KEY_INDEX:(wd.core.util.assert(this.index_ instanceof wd.core.snap.SubKeyIndex,"Unrecognized index type!"),o=this.index_.toString()),t[e.ORDER_BY]=wd.util.json.stringify(o),this.startSet_&&(t[e.START_AT]=wd.util.json.stringify(this.indexStartValue_),this.startNameSet_&&(t[e.START_AT]+=","+wd.util.json.stringify(this.indexStartName_))),this.endSet_&&(t[e.END_AT]=wd.util.json.stringify(this.indexEndValue_),this.endNameSet_&&(t[e.END_AT]+=","+wd.util.json.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?t[e.LIMIT_TO_FIRST]=this.limit_:t[e.LIMIT_TO_LAST]=this.limit_),t},goog.DEBUG&&(wd.core.view.QueryParams.prototype.toString=function(){return wd.util.json.stringify(this.getQueryObject())}),goog.provide("wd.api.Query"),goog.require("wd.api.DataSnapshot"),goog.require("wd.core.snap"),goog.require("wd.core.util"),goog.require("wd.core.util.validation"),goog.require("wd.core.view.EventRegistration"),goog.require("wd.core.view.QueryParams"),goog.require("wd.util.json"),goog.require("wd.util.validation"),wd.api.Query=function(e,t,o,r){this.repo=e,this.path=t,this.queryParams_=o,this.orderByCalled_=r},wd.api.Query.prototype.validateQueryEndpoints_=function(e){var t=null,o=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(o=e.getIndexEndValue()),e.getIndex()===wd.core.snap.KeyIndex){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",n="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){var i=e.getIndexStartName();if(i!=wd.core.util.MIN_NAME)throw new Error(r);if("string"!=typeof t)throw new Error(n)}if(e.hasEnd()){var a=e.getIndexEndName();if(a!=wd.core.util.MAX_NAME)throw new Error(r);if("string"!=typeof o)throw new Error(n)}}else if(e.getIndex()===wd.core.snap.PriorityIndex){if(null!=t&&!wd.core.util.validation.isValidPriority(t)||null!=o&&!wd.core.util.validation.isValidPriority(o))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(wd.core.util.assert(e.getIndex()instanceof wd.core.snap.SubKeyIndex||e.getIndex()===wd.core.snap.ValueIndex,"unknown index type."),null!=t&&"object"==typeof t||null!=o&&"object"==typeof o)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},wd.api.Query.prototype.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.");
},wd.api.Query.prototype.validateNoPreviousOrderByCall_=function(e){if(this.orderByCalled_===!0)throw new Error(e+": You can't combine multiple orderBy calls.")},wd.api.Query.prototype.getQueryParams=function(){return this.queryParams_},wd.api.Query.prototype.ref=function(){return wd.util.validation.validateArgCount("Query.ref",0,0,arguments.length),new Wilddog(this.repo,this.path)},goog.exportProperty(wd.api.Query.prototype,"ref",wd.api.Query.prototype.ref),wd.api.Query.prototype.on=function(e,t,o,r){wd.util.validation.validateArgCount("Query.on",2,4,arguments.length),wd.core.util.validation.validateEventType("Query.on",1,e,!1),wd.util.validation.validateCallback("Query.on",2,t,!1);var n=this.getCancelAndContextArgs_("Query.on",o,r);if("value"===e)this.onValueEvent(t,n.cancel,n.context);else{var i={};i[e]=t,this.onChildEvent(i,n.cancel,n.context)}return t},goog.exportProperty(wd.api.Query.prototype,"on",wd.api.Query.prototype.on),wd.api.Query.prototype.onValueEvent=function(e,t,o){var r=new wd.core.view.ValueEventRegistration(e,t||null,o||null);this.repo.addEventCallbackForQuery(this,r)},wd.api.Query.prototype.onChildEvent=function(e,t,o){var r=new wd.core.view.ChildEventRegistration(e,t,o);this.repo.addEventCallbackForQuery(this,r)},wd.api.Query.prototype.off=function(e,t,o){wd.util.validation.validateArgCount("Query.off",0,3,arguments.length),wd.core.util.validation.validateEventType("Query.off",1,e,!0),wd.util.validation.validateCallback("Query.off",2,t,!0),wd.util.validation.validateContextObject("Query.off",3,o,!0);var r=null,n=null;if("value"===e){var i=t||null;r=new wd.core.view.ValueEventRegistration(i,null,o||null)}else e&&(t&&(n={},n[e]=t),r=new wd.core.view.ChildEventRegistration(n,null,o||null));this.repo.removeEventCallbackForQuery(this,r)},goog.exportProperty(wd.api.Query.prototype,"off",wd.api.Query.prototype.off),wd.api.Query.prototype.once=function(e,t){wd.util.validation.validateArgCount("Query.once",2,4,arguments.length),wd.core.util.validation.validateEventType("Query.once",1,e,!1),wd.util.validation.validateCallback("Query.once",2,t,!1);var o=this.getCancelAndContextArgs_("Query.once",arguments[2],arguments[3]),r=this,n=!0,i=function(a){n&&(n=!1,r.off(e,i),goog.bind(t,o.context)(a))};this.on(e,i,function(t){r.off(e,i),o.cancel&&goog.bind(o.cancel,o.context)(t)})},goog.exportProperty(wd.api.Query.prototype,"once",wd.api.Query.prototype.once),wd.api.Query.prototype.limit=function(e){if(wd.core.util.warn("Query.limit() being deprecated. Please use Query.limitToFirst() or Query.limitToLast() instead."),wd.util.validation.validateArgCount("Query.limit",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||0>=e)throw new Error("Query.limit: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limit: Limit was already set (by another call to limit, limitToFirst, orlimitToLast.");var t=this.queryParams_.limit(e);return this.validateLimit_(t),new wd.api.Query(this.repo,this.path,t,this.orderByCalled_)},goog.exportProperty(wd.api.Query.prototype,"limit",wd.api.Query.prototype.limit),wd.api.Query.prototype.limitToFirst=function(e){if(wd.util.validation.validateArgCount("Query.limitToFirst",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||0>=e)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new wd.api.Query(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},goog.exportProperty(wd.api.Query.prototype,"limitToFirst",wd.api.Query.prototype.limitToFirst),wd.api.Query.prototype.limitToLast=function(e){if(wd.util.validation.validateArgCount("Query.limitToLast",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||0>=e)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new wd.api.Query(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},goog.exportProperty(wd.api.Query.prototype,"limitToLast",wd.api.Query.prototype.limitToLast),wd.api.Query.prototype.orderByChild=function(e){if(wd.util.validation.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');wd.core.util.validation.validateKey("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var t=new wd.core.snap.SubKeyIndex(e),o=this.queryParams_.orderBy(t);return this.validateQueryEndpoints_(o),new wd.api.Query(this.repo,this.path,o,!0)},goog.exportProperty(wd.api.Query.prototype,"orderByChild",wd.api.Query.prototype.orderByChild),wd.api.Query.prototype.orderByKey=function(){wd.util.validation.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(wd.core.snap.KeyIndex);return this.validateQueryEndpoints_(e),new wd.api.Query(this.repo,this.path,e,!0)},goog.exportProperty(wd.api.Query.prototype,"orderByKey",wd.api.Query.prototype.orderByKey),wd.api.Query.prototype.orderByPriority=function(){wd.util.validation.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(wd.core.snap.PriorityIndex);return this.validateQueryEndpoints_(e),new wd.api.Query(this.repo,this.path,e,!0)},goog.exportProperty(wd.api.Query.prototype,"orderByPriority",wd.api.Query.prototype.orderByPriority),wd.api.Query.prototype.orderByValue=function(){wd.util.validation.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(wd.core.snap.ValueIndex);return this.validateQueryEndpoints_(e),new wd.api.Query(this.repo,this.path,e,!0)},goog.exportProperty(wd.api.Query.prototype,"orderByValue",wd.api.Query.prototype.orderByValue),wd.api.Query.prototype.startAt=function(e,t){wd.util.validation.validateArgCount("Query.startAt",0,2,arguments.length),wd.core.util.validation.validateWilddogDataArg("Query.startAt",1,e,this.path,!0),wd.core.util.validation.validateKey("Query.startAt",2,t,!0);var o=this.queryParams_.startAt(e,t);if(this.validateLimit_(o),this.validateQueryEndpoints_(o),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return goog.isDef(e)||(e=null,t=null),new wd.api.Query(this.repo,this.path,o,this.orderByCalled_)},goog.exportProperty(wd.api.Query.prototype,"startAt",wd.api.Query.prototype.startAt),wd.api.Query.prototype.endAt=function(e,t){wd.util.validation.validateArgCount("Query.endAt",0,2,arguments.length),wd.core.util.validation.validateWilddogDataArg("Query.endAt",1,e,this.path,!0),wd.core.util.validation.validateKey("Query.endAt",2,t,!0);var o=this.queryParams_.endAt(e,t);if(this.validateLimit_(o),this.validateQueryEndpoints_(o),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new wd.api.Query(this.repo,this.path,o,this.orderByCalled_)},goog.exportProperty(wd.api.Query.prototype,"endAt",wd.api.Query.prototype.endAt),wd.api.Query.prototype.equalTo=function(e,t){if(wd.util.validation.validateArgCount("Query.equalTo",1,2,arguments.length),wd.core.util.validation.validateWilddogDataArg("Query.equalTo",1,e,this.path,!1),wd.core.util.validation.validateKey("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to endAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},goog.exportProperty(wd.api.Query.prototype,"equalTo",wd.api.Query.prototype.equalTo),wd.api.Query.prototype.toString=function(){return wd.util.validation.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},goog.exportProperty(wd.api.Query.prototype,"toString",wd.api.Query.prototype.toString),wd.api.Query.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},wd.api.Query.prototype.queryIdentifier=function(){var e=this.queryObject(),t=wd.core.util.ObjectToUniqueKey(e);return"{}"===t?"default":t},wd.api.Query.prototype.getCancelAndContextArgs_=function(e,t,o){var r={cancel:null,context:null};if(t&&o)r.cancel=t,wd.util.validation.validateCallback(e,3,r.cancel,!0),r.context=o,wd.util.validation.validateContextObject(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(wd.util.validation.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},goog.provide("wd.api.OnDisconnect"),goog.require("wd.constants"),goog.require("wd.core.Repo"),goog.require("wd.core.util.validation"),goog.require("wd.util.validation"),wd.api.OnDisconnect=function(e,t){this.repo_=e,this.path_=t},wd.api.OnDisconnect.prototype.cancel=function(e){wd.util.validation.validateArgCount("Wilddog.onDisconnect().cancel",0,1,arguments.length),wd.util.validation.validateCallback("Wilddog.onDisconnect().cancel",1,e,!0),this.repo_.onDisconnectCancel(this.path_,e||null)},goog.exportProperty(wd.api.OnDisconnect.prototype,"cancel",wd.api.OnDisconnect.prototype.cancel),wd.api.OnDisconnect.prototype.remove=function(e){wd.util.validation.validateArgCount("Wilddog.onDisconnect().remove",0,1,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.onDisconnect().remove",this.path_),wd.util.validation.validateCallback("Wilddog.onDisconnect().remove",1,e,!0),this.repo_.onDisconnectSet(this.path_,null,e)},goog.exportProperty(wd.api.OnDisconnect.prototype,"remove",wd.api.OnDisconnect.prototype.remove),wd.api.OnDisconnect.prototype.set=function(e,t){wd.util.validation.validateArgCount("Wilddog.onDisconnect().set",1,2,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.onDisconnect().set",this.path_),wd.core.util.validation.validateWilddogDataArg("Wilddog.onDisconnect().set",1,e,this.path_,!1),wd.util.validation.validateCallback("Wilddog.onDisconnect().set",2,t,!0),this.repo_.onDisconnectSet(this.path_,e,t)},goog.exportProperty(wd.api.OnDisconnect.prototype,"set",wd.api.OnDisconnect.prototype.set),wd.api.OnDisconnect.prototype.setWithPriority=function(e,t,o){wd.util.validation.validateArgCount("Wilddog.onDisconnect().setWithPriority",2,3,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.onDisconnect().setWithPriority",this.path_),wd.core.util.validation.validateWilddogDataArg("Wilddog.onDisconnect().setWithPriority",1,e,this.path_,!1),wd.core.util.validation.validatePriority("Wilddog.onDisconnect().setWithPriority",2,t,!1),wd.util.validation.validateCallback("Wilddog.onDisconnect().setWithPriority",3,o,!0),this.repo_.onDisconnectSetWithPriority(this.path_,e,t,o)},goog.exportProperty(wd.api.OnDisconnect.prototype,"setWithPriority",wd.api.OnDisconnect.prototype.setWithPriority),wd.api.OnDisconnect.prototype.update=function(e,t){if(wd.util.validation.validateArgCount("Wilddog.onDisconnect().update",1,2,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.onDisconnect().update",this.path_),goog.isArray(e)){for(var o={},r=0;r<e.length;++r)o[""+r]=e[r];e=o,wd.core.util.warn("Passing an Array to Wilddog.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}wd.core.util.validation.validateWilddogMergeDataArg("Wilddog.onDisconnect().update",1,e,this.path_,!1),wd.util.validation.validateCallback("Wilddog.onDisconnect().update",2,t,!0),this.repo_.onDisconnectUpdate(this.path_,e,t)},goog.exportProperty(wd.api.OnDisconnect.prototype,"update",wd.api.OnDisconnect.prototype.update),goog.provide("wd.login.transports.PopupReceiver"),goog.require("wd.login.Constants"),goog.require("wd.login.Transport"),goog.require("wd.login.transports.util"),goog.require("wd.login.util.environment"),goog.require("wd.util.json"),wd.login.transports.PopupReceiver=function(e){var t=this;if(this.cb=e,this.targetOrigin="*",wd.login.util.environment.isModernIE()?this.messageTarget=this.inboundTarget=wd.login.transports.util.findRelay():(this.messageTarget=window.opener,this.inboundTarget=window),!t.messageTarget)throw"Unable to find relay frame";wd.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onMessage_,this)),wd.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onDie_,this));try{this.doPost_({a:"ready"})}catch(o){wd.login.transports.util.addListener(this.messageTarget,"load",function(e){t.doPost_({a:"ready"})})}wd.login.transports.util.addListener(window,"unload",goog.bind(this.onUnload_,this))},wd.login.transports.PopupReceiver.prototype.doPost_=function(e){e=wd.util.json.stringify(e),wd.login.util.environment.isModernIE()?this.messageTarget.doPost(e,this.targetOrigin):this.messageTarget.postMessage(e,this.targetOrigin)},wd.login.transports.PopupReceiver.prototype.onMessage_=function(e){var t,o=this;try{t=wd.util.json.eval(e.data)}catch(r){}t&&"request"===t.a&&(wd.login.transports.util.removeListener(window,"message",this.onMessage_),this.targetOrigin=e.origin,this.cb&&setTimeout(function(){o.cb(o.targetOrigin,t.d,function(e,t){o.autoClose=!t,o.cb=void 0,o.doPost_({a:"response",d:e,forceKeepWindowOpen:t})})},0))},wd.login.transports.PopupReceiver.prototype.onUnload_=function(){try{wd.login.transports.util.removeListener(this.inboundTarget,"message",this.onDie_)}catch(e){}this.cb&&(this.doPost_({a:"error",d:"unknown closed window"}),this.cb=void 0);try{window.close()}catch(e){}},wd.login.transports.PopupReceiver.prototype.onDie_=function(e){if(this.autoClose&&e.data===wd.login.Constants.POPUP_CLOSE_CMD)try{window.close()}catch(t){}},goog.provide("wd.api.INTERNAL"),goog.require("wd.core.PersistentConnection"),goog.require("wd.login.transports.PopupReceiver"),goog.require("wd.login.Constants"),wd.api.INTERNAL={},wd.api.INTERNAL.forceLongPolling=function(){wd.realtime.WebSocketConnection.forceDisallow(),wd.realtime.BrowserPollConnection.forceAllow()},goog.exportProperty(wd.api.INTERNAL,"forceLongPolling",wd.api.INTERNAL.forceLongPolling),wd.api.INTERNAL.forceWebSockets=function(){wd.realtime.BrowserPollConnection.forceDisallow()},goog.exportProperty(wd.api.INTERNAL,"forceWebSockets",wd.api.INTERNAL.forceWebSockets),wd.api.INTERNAL.setSecurityDebugCallback=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},goog.exportProperty(wd.api.INTERNAL,"setSecurityDebugCallback",wd.api.INTERNAL.setSecurityDebugCallback),wd.api.INTERNAL.stats=function(e,t){e.repo.stats(t)},goog.exportProperty(wd.api.INTERNAL,"stats",wd.api.INTERNAL.stats),wd.api.INTERNAL.statsIncrementCounter=function(e,t){e.repo.statsIncrementCounter(t)},goog.exportProperty(wd.api.INTERNAL,"statsIncrementCounter",wd.api.INTERNAL.statsIncrementCounter),wd.api.INTERNAL.dataUpdateCount=function(e){return e.repo.dataUpdateCount},goog.exportProperty(wd.api.INTERNAL,"dataUpdateCount",wd.api.INTERNAL.dataUpdateCount),wd.api.INTERNAL.interceptServerData=function(e,t){return e.repo.interceptServerData_(t)},goog.exportProperty(wd.api.INTERNAL,"interceptServerData",wd.api.INTERNAL.interceptServerData),wd.api.INTERNAL.onLoginPopupOpen=function(e){new wd.login.transports.PopupReceiver(e)},goog.exportProperty(wd.api.INTERNAL,"onPopupOpen",wd.api.INTERNAL.onLoginPopupOpen),wd.api.INTERNAL.setAuthenticationServer=function(e){wd.login.Constants.SERVER_HOST=e},goog.exportProperty(wd.api.INTERNAL,"setAuthenticationServer",wd.api.INTERNAL.setAuthenticationServer),goog.provide("Wilddog"),goog.require("wd.api.INTERNAL"),goog.require("wd.api.OnDisconnect"),goog.require("wd.api.Query"),goog.require("wd.api.TEST_ACCESS"),goog.require("wd.constants"),goog.require("wd.core.Repo"),goog.require("wd.core.RepoManager"),goog.require("wd.core.storage"),goog.require("wd.core.util"),goog.require("wd.core.util.nextPushId"),goog.require("wd.core.util.validation"),goog.require("goog.string"),Wilddog=function(e,t){var o,r,n;if(e instanceof wd.core.Repo)o=e,r=t;else{wd.util.validation.validateArgCount("new Wilddog",1,2,arguments.length);var i=wd.core.util.parseRepoInfo(arguments[0]),a=i.repoInfo;if(wd.core.util.validation.validateUrl("new Wilddog",1,i),t)if(t instanceof wd.core.RepoManager)n=t;else{if(!goog.isString(t))throw new Error("Expected a valid Wilddog.Context for second argument to new Wilddog()");n=wd.core.RepoManager.getInstance(),a.persistenceKey=t}else n=wd.core.RepoManager.getInstance();o=n.getRepo(a),r=i.path}wd.api.Query.call(this,o,r,wd.core.view.QueryParams.DEFAULT,!1)},goog.inherits(Wilddog,wd.api.Query),NODE_CLIENT&&(console.log(module),module.exports=Wilddog),Wilddog.prototype.name=function(){return wd.core.util.warn("Wilddog.name() being deprecated. Please use Wilddog.key() instead."),wd.util.validation.validateArgCount("Wilddog.name",0,0,arguments.length),this.key()},Wilddog.prototype.key=function(){return wd.util.validation.validateArgCount("Wilddog.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Wilddog.prototype.child=function(e){return wd.util.validation.validateArgCount("Wilddog.child",1,1,arguments.length),goog.isNumber(e)?e=String(e):e instanceof wd.core.util.Path||(null===this.path.getFront()?wd.core.util.validation.validateRootPathString("Wilddog.child",1,e,!1):wd.core.util.validation.validatePathString("Wilddog.child",1,e,!1)),new Wilddog(this.repo,this.path.child(e))},Wilddog.prototype.parent=function(){wd.util.validation.validateArgCount("Wilddog.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new Wilddog(this.repo,e)},Wilddog.prototype.root=function(){wd.util.validation.validateArgCount("Wilddog.ref",0,0,arguments.length);for(var e=this;null!==e.parent();)e=e.parent();return e},Wilddog.prototype.set=function(e,t){wd.util.validation.validateArgCount("Wilddog.set",1,2,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.set",this.path),wd.core.util.validation.validateWilddogDataArg("Wilddog.set",1,e,this.path,!1),wd.util.validation.validateCallback("Wilddog.set",2,t,!0),this.repo.setWithPriority(this.path,e,null,t||null)},Wilddog.prototype.update=function(e,t){if(wd.util.validation.validateArgCount("Wilddog.update",1,2,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.update",this.path),goog.isArray(e)){for(var o={},r=0;r<e.length;++r)o[""+r]=e[r];e=o,wd.core.util.warn("Passing an Array to Wilddog.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}wd.core.util.validation.validateWilddogMergeDataArg("Wilddog.update",1,e,this.path,!1),wd.util.validation.validateCallback("Wilddog.update",2,t,!0),this.repo.update(this.path,e,t||null)},Wilddog.prototype.setWithPriority=function(e,t,o){if(wd.util.validation.validateArgCount("Wilddog.setWithPriority",2,3,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.setWithPriority",this.path),wd.core.util.validation.validateWilddogDataArg("Wilddog.setWithPriority",1,e,this.path,!1),wd.core.util.validation.validatePriority("Wilddog.setWithPriority",2,t,!1),wd.util.validation.validateCallback("Wilddog.setWithPriority",3,o,!0),".length"===this.key()||".keys"===this.key())throw"Wilddog.setWithPriority failed: "+this.key()+" is a read-only object.";this.repo.setWithPriority(this.path,e,t,o||null)},Wilddog.prototype.remove=function(e){wd.util.validation.validateArgCount("Wilddog.remove",0,1,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.remove",this.path),wd.util.validation.validateCallback("Wilddog.remove",1,e,!0),this.set(null,e)},Wilddog.prototype.transaction=function(e,t,o){if(wd.util.validation.validateArgCount("Wilddog.transaction",1,3,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.transaction",this.path),wd.util.validation.validateCallback("Wilddog.transaction",1,e,!1),wd.util.validation.validateCallback("Wilddog.transaction",2,t,!0),wd.core.util.validation.validateBoolean("Wilddog.transaction",3,o,!0),".length"===this.key()||".keys"===this.key())throw"Wilddog.transaction failed: "+this.key()+" is a read-only object.";"undefined"==typeof o&&(o=!0),this.repo.startTransaction(this.path,e,t||null,o)},Wilddog.prototype.setPriority=function(e,t){wd.util.validation.validateArgCount("Wilddog.setPriority",1,2,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.setPriority",this.path),wd.core.util.validation.validatePriority("Wilddog.setPriority",1,e,!1),wd.util.validation.validateCallback("Wilddog.setPriority",2,t,!0),this.repo.setWithPriority(this.path.child(".priority"),e,null,t)},Wilddog.prototype.push=function(e,t){wd.util.validation.validateArgCount("Wilddog.push",0,2,arguments.length),wd.core.util.validation.validateWritablePath("Wilddog.push",this.path),wd.core.util.validation.validateWilddogDataArg("Wilddog.push",1,e,this.path,!0),wd.util.validation.validateCallback("Wilddog.push",2,t,!0);var o=this.repo.serverTime(),r=wd.core.util.nextPushId(o),n=this.child(r);return"undefined"!=typeof e&&null!==e&&n.set(e,t),n},Wilddog.prototype.onDisconnect=function(){return wd.core.util.validation.validateWritablePath("Wilddog.onDisconnect",this.path),new wd.api.OnDisconnect(this.repo,this.path)},Wilddog.prototype.auth=function(e,t,o){wd.core.util.warn("WilddogRef.auth() being deprecated. Please use WilddogRef.authWithCustomToken() instead."),wd.util.validation.validateArgCount("Wilddog.auth",1,3,arguments.length),wd.core.util.validation.validateCredential("Wilddog.auth",1,e,!1),wd.util.validation.validateCallback("Wilddog.auth",2,t,!0),wd.util.validation.validateCallback("Wilddog.auth",3,t,!0);var r={};r[wd.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="none",this.repo.auth.authenticate(e,{},r,t,o)},Wilddog.prototype.unauth=function(e){wd.util.validation.validateArgCount("Wilddog.unauth",0,1,arguments.length),wd.util.validation.validateCallback("Wilddog.unauth",1,e,!0),this.repo.auth.unauthenticate(e)},Wilddog.prototype.getAuth=function(){return wd.util.validation.validateArgCount("Wilddog.getAuth",0,0,arguments.length),this.repo.auth.getAuth()},Wilddog.prototype.onAuth=function(e,t){wd.util.validation.validateArgCount("Wilddog.onAuth",1,2,arguments.length),wd.util.validation.validateCallback("Wilddog.onAuth",1,e,!1),wd.util.validation.validateContextObject("Wilddog.onAuth",2,t,!0),this.repo.auth.on("auth_status",e,t)},Wilddog.prototype.offAuth=function(e,t){wd.util.validation.validateArgCount("Wilddog.offAuth",1,2,arguments.length),wd.util.validation.validateCallback("Wilddog.offAuth",1,e,!1),wd.util.validation.validateContextObject("Wilddog.offAuth",2,t,!0),this.repo.auth.off("auth_status",e,t)},Wilddog.prototype.authWithCustomToken=function(e,t,o){wd.util.validation.validateArgCount("Wilddog.authWithCustomToken",2,3,arguments.length),wd.core.util.validation.validateCredential("Wilddog.authWithCustomToken",1,e,!1),wd.util.validation.validateCallback("Wilddog.authWithCustomToken",2,t,!1),wd.core.util.validation.validateObject("Wilddog.authWithCustomToken",3,o,!0),this.repo.auth.authenticate(e,{},o||{},t)},Wilddog.prototype.authWithOAuthPopup=function(e,t,o){wd.util.validation.validateArgCount("Wilddog.authWithOAuthPopup",2,3,arguments.length),wd.core.util.validation.validateString("Wilddog.authWithOAuthPopup",1,e,!1),wd.util.validation.validateCallback("Wilddog.authWithOAuthPopup",2,t,!1),wd.core.util.validation.validateObject("Wilddog.authWithOAuthPopup",3,o,!0),this.repo.auth.authWithPopup(e,o,t)},Wilddog.prototype.authWithOAuthRedirect=function(e,t,o){wd.util.validation.validateArgCount("Wilddog.authWithOAuthRedirect",2,3,arguments.length),wd.core.util.validation.validateString("Wilddog.authWithOAuthRedirect",1,e,!1),wd.util.validation.validateCallback("Wilddog.authWithOAuthRedirect",2,t,!1),wd.core.util.validation.validateObject("Wilddog.authWithOAuthRedirect",3,o,!0),this.repo.auth.authWithRedirect(e,o,t)},Wilddog.prototype.authWithOAuthToken=function(e,t,o,r){wd.util.validation.validateArgCount("Wilddog.authWithOAuthToken",3,4,arguments.length),wd.core.util.validation.validateString("Wilddog.authWithOAuthToken",1,e,!1),wd.util.validation.validateCallback("Wilddog.authWithOAuthToken",3,o,!1),wd.core.util.validation.validateObject("Wilddog.authWithOAuthToken",4,r,!0),goog.isString(t)?(wd.core.util.validation.validateString("Wilddog.authWithOAuthToken",2,t,!1),this.repo.auth.authWithCredential(e+"/token",{access_token:t},r,o)):(wd.core.util.validation.validateObject("Wilddog.authWithOAuthToken",2,t,!1),this.repo.auth.authWithCredential(e+"/token",t,r,o))},Wilddog.prototype.authAnonymously=function(e,t){wd.util.validation.validateArgCount("Wilddog.authAnonymously",1,2,arguments.length),wd.util.validation.validateCallback("Wilddog.authAnonymously",1,e,!1),wd.core.util.validation.validateObject("Wilddog.authAnonymously",2,t,!0),this.repo.auth.authWithCredential("anonymous",{},t,e)},Wilddog.prototype.authWithPassword=function(e,t,o){wd.util.validation.validateArgCount("Wilddog.authWithPassword",2,3,arguments.length),wd.core.util.validation.validateObject("Wilddog.authWithPassword",1,e,!1),wd.core.util.validation.validateObjectContainsKey("Wilddog.authWithPassword",1,e,"email",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.authWithPassword",1,e,"password",!1,"string"),wd.util.validation.validateCallback("Wilddog.authAnonymously",2,t,!1),wd.core.util.validation.validateObject("Wilddog.authAnonymously",3,o,!0),this.repo.auth.authWithCredential("password",e,o,t)},Wilddog.prototype.createUser=function(e,t){wd.util.validation.validateArgCount("Wilddog.createUser",2,2,arguments.length),wd.core.util.validation.validateObject("Wilddog.createUser",1,e,!1),wd.core.util.validation.validateObjectContainsKey("Wilddog.createUser",1,e,"email",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.createUser",1,e,"password",!1,"string"),wd.util.validation.validateCallback("Wilddog.createUser",2,t,!1),this.repo.auth.createUser(e,t)},Wilddog.prototype.removeUser=function(e,t){wd.util.validation.validateArgCount("Wilddog.removeUser",2,2,arguments.length),wd.core.util.validation.validateObject("Wilddog.removeUser",1,e,!1),wd.core.util.validation.validateObjectContainsKey("Wilddog.removeUser",1,e,"email",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.removeUser",1,e,"password",!1,"string"),wd.util.validation.validateCallback("Wilddog.removeUser",2,t,!1),this.repo.auth.removeUser(e,t)},Wilddog.prototype.changePassword=function(e,t){wd.util.validation.validateArgCount("Wilddog.changePassword",2,2,arguments.length),wd.core.util.validation.validateObject("Wilddog.changePassword",1,e,!1),wd.core.util.validation.validateObjectContainsKey("Wilddog.changePassword",1,e,"email",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.changePassword",1,e,"oldPassword",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.changePassword",1,e,"newPassword",!1,"string"),wd.util.validation.validateCallback("Wilddog.changePassword",2,t,!1),this.repo.auth.changePassword(e,t)},Wilddog.prototype.changeEmail=function(e,t){wd.util.validation.validateArgCount("Wilddog.changeEmail",2,2,arguments.length),wd.core.util.validation.validateObject("Wilddog.changeEmail",1,e,!1),wd.core.util.validation.validateObjectContainsKey("Wilddog.changeEmail",1,e,"oldEmail",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.changeEmail",1,e,"newEmail",!1,"string"),wd.core.util.validation.validateObjectContainsKey("Wilddog.changeEmail",1,e,"password",!1,"string"),wd.util.validation.validateCallback("Wilddog.changeEmail",2,t,!1),this.repo.auth.changeEmail(e,t)},Wilddog.prototype.resetPassword=function(e,t){wd.util.validation.validateArgCount("Wilddog.resetPassword",2,2,arguments.length),wd.core.util.validation.validateObject("Wilddog.resetPassword",1,e,!1),wd.core.util.validation.validateObjectContainsKey("Wilddog.resetPassword",1,e,"email",!1,"string"),wd.util.validation.validateCallback("Wilddog.resetPassword",2,t,!1),this.repo.auth.resetPassword(e,t)},Wilddog.goOffline=function(){wd.util.validation.validateArgCount("Wilddog.goOffline",0,0,arguments.length),wd.core.RepoManager.getInstance().interrupt()},Wilddog.goOnline=function(){wd.util.validation.validateArgCount("Wilddog.goOnline",0,0,arguments.length),wd.core.RepoManager.getInstance().resume()},Wilddog.enableLogging=function(e,t){wd.core.util.assert(!t||e===!0||e===!1,"Can't turn on custom loggers persistently."),e===!0?("undefined"!=typeof console&&("function"==typeof console.log?wd.core.util.logger=goog.bind(console.log,console):"object"==typeof console.log&&(wd.core.util.logger=function(e){console.log(e)})),t&&wd.core.storage.SessionStorage.set("logging_enabled",!0)):e?wd.core.util.logger=e:(wd.core.util.logger=null,wd.core.storage.SessionStorage.remove("logging_enabled"))},Wilddog.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Wilddog.SDK_VERSION=CLIENT_VERSION,Wilddog.INTERNAL=wd.api.INTERNAL,Wilddog.Context=wd.core.RepoManager,Wilddog.TEST_ACCESS=wd.api.TEST_ACCESS,Wilddog.SDK_VERSION="0.4.4","undefined"!=typeof window&&(window.Wilddog=Wilddog),Wilddog.prototype.name=Wilddog.prototype.name,Wilddog.prototype.key=Wilddog.prototype.key,Wilddog.prototype.child=Wilddog.prototype.child,Wilddog.prototype.parent=Wilddog.prototype.parent,Wilddog.prototype.root=Wilddog.prototype.root,Wilddog.prototype.set=Wilddog.prototype.set,Wilddog.prototype.update=Wilddog.prototype.update,Wilddog.prototype.setPriority=Wilddog.prototype.setPriority,Wilddog.prototype.setWithPriority=Wilddog.prototype.setWithPriority,Wilddog.prototype.remove=Wilddog.prototype.remove,Wilddog.prototype.transaction=Wilddog.prototype.transaction,Wilddog.prototype.push=Wilddog.prototype.push,Wilddog.prototype.onDisconnect=Wilddog.prototype.onDisconnect,Wilddog.prototype.auth=Wilddog.prototype.auth,Wilddog.prototype.unauth=Wilddog.prototype.unauth,Wilddog.prototype.getAuth=Wilddog.prototype.getAuth,Wilddog.prototype.onAuth=Wilddog.prototype.onAuth,Wilddog.prototype.offAuth=Wilddog.prototype.offAuth,Wilddog.prototype.authWithCustomToken=Wilddog.prototype.authWithCustomToken,Wilddog.prototype.authWithOAuthPopup=Wilddog.prototype.authWithOAuthPopup,Wilddog.prototype.authWithOAuthRedirect=Wilddog.prototype.authWithOAuthRedirect,Wilddog.prototype.authWithOAuthToken=Wilddog.prototype.authWithOAuthToken,Wilddog.prototype.authAnonymously=Wilddog.prototype.authAnonymously,Wilddog.prototype.authWithPassword=Wilddog.prototype.authWithPassword,Wilddog.prototype.createUser=Wilddog.prototype.createUser,Wilddog.prototype.removeUser=Wilddog.prototype.removeUser,Wilddog.prototype.changeEmail=Wilddog.prototype.changeEmail,Wilddog.prototype.changePassword=Wilddog.prototype.changePassword,Wilddog.prototype.resetPassword=Wilddog.prototype.resetPassword,Wilddog.goOnline=Wilddog.goOnline,Wilddog.goOffline=Wilddog.goOffline,Wilddog.ServerValue=Wilddog.ServerValue,Wilddog.INTERNAL=Wilddog.INTERNAL},ns.wrapper(ns.goog,ns.wd)}({goog:{},wd:{}});